è¿™ 10 é“é¢˜ç›®æ¶µç›–äº† **API Gateway è¯·æ±‚é…é¢**ã€**VMware è¿ç§»**ã€**ECS æ•°æ®åŠ å¯† (Field-Level Encryption)**ã€**VPC DNS è§£æ**ã€**Redshift å¹¶å‘æ‰©å±•**ã€**S3 ä¸ªäººæ–‡ä»¶å¤¹æƒé™ä¸å®¡è®¡**ã€**ECR ç»„ç»‡è®¿é—®ä¸ç”Ÿå‘½å‘¨æœŸ**ã€**AWS Backup è·¨è´¦æˆ·ç®¡ç†**ã€**è·¨è´¦æˆ· AssumeRole æƒé™é“¾**ã€**Storage Gateway å½’æ¡£**ã€‚

ç‰¹åˆ«æ˜¯ **Q309 (AssumeRole Permissions)** å’Œ **Q306 (S3 Home Directory + Audit)** æ˜¯ IAM å’Œ S3 çš„æ ¸å¿ƒè€ƒç‚¹ã€‚

è®©æˆ‘ä»¬å¼€å¯ **é€é¢˜ç§’æ€æ¨¡å¼**ï¼

---

#### ğŸ“ [301/529] Lambda API é…é¢ç®¡ç† (Usage Plans)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **éœ€æ±‚ï¼š** ä¸ºæ¯ä¸ªå®¢æˆ·è®¾ç½®ç‰¹å®šæ—¶é—´æ®µå†…çš„ **Request Quota** (è¯·æ±‚é…é¢)ã€‚
* **ç‰¹ç‚¹ï¼š** å®¢æˆ·é…é¢ä¸åŒï¼ˆæœ‰çš„æ›´é«˜ï¼‰ã€‚
* **ç›®æ ‡ï¼š** Meet requirementsã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **API Gateway ç±»å‹ï¼š**
    * **HTTP API (B):** åªæ”¯æŒ **Throttling** (é€Ÿç‡é™åˆ¶ï¼Œå¦‚ RPS)ï¼Œ**ä¸æ”¯æŒ** Usage Plan (ä½¿ç”¨è®¡åˆ’) ä¸­çš„ **Quota** (é…é¢ï¼Œå¦‚æ¯å¤© 1000 æ¬¡)ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®åŒºåˆ«ã€‚
    * **REST API (A):** åŸç”Ÿæ”¯æŒ **Usage Plans**ï¼Œå¯ä»¥é…ç½® Throttling å’Œ **Quota**ã€‚
* **é…é¢å®ç°ï¼š**
    * åˆ›å»º Usage Planï¼Œè®¾ç½® Quotaã€‚
    * åˆ›å»º **API Key** åˆ†å‘ç»™å®¢æˆ·ï¼Œå¹¶å…³è”åˆ° Usage Planã€‚
    * $\rightarrow$ **é€‰ä¸­ A**ã€‚
* **æ’é™¤æ³•ï¼š**
    * B (HTTP API): ä¸æ”¯æŒ Quotaã€‚
    * C (Lambda Alias/URL): Lambda è‡ªèº«æ²¡æœ‰æŒ‰å®¢æˆ·çš„é…é¢åŠŸèƒ½ï¼Œåªæœ‰å¹¶å‘é™åˆ¶ï¼ˆConcurrencyï¼‰ã€‚Concurrency æ˜¯ç¬æ—¶å¹¶å‘æ•°ï¼Œä¸æ˜¯â€œç‰¹å®šæ—¶é—´æ®µå†…çš„è¯·æ±‚æ€»æ•°â€ï¼ˆQuotaï¼‰ã€‚
    * D (WAF + ALB): WAF å¯ä»¥åš Rate-based rule (Throttling)ï¼Œä½†åš Quota (å¦‚æ¯æœˆ 100ä¸‡æ¬¡) å¾ˆéš¾ï¼ˆWAF ç»Ÿè®¡çª—å£è¾ƒçŸ­ï¼Œä¸”é…ç½®å‡ ç™¾ä¸ªå®¢æˆ·çš„è§„åˆ™å¾ˆéº»çƒ¦ï¼‰ã€‚API Gateway Usage Plan æ˜¯ä¸“é—¨å¹²è¿™ä¸ªçš„ã€‚
* **é”å®š Aã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ A)**
* **REST API Usage Plans:** ä¸“é—¨ç”¨äºç®¡ç† API äº§å“çš„é…é¢å’Œé€Ÿç‡é™åˆ¶ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** API Gateway REST API ä¸ HTTP API åœ¨é…é¢ç®¡ç†ä¸Šçš„åŒºåˆ«ã€‚

---

#### ğŸ“ [302/529] VMware è¿ç§» (Snowball vs DataSync vs MGN)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **æºç«¯ï¼š** 120 VMs (VMware), 10TB NFSã€‚
* **è¿æ¥ï¼š** **10 Gbps DX**ã€‚
* **ç›®æ ‡ï¼š** Migrate to AWS in **Least time**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **è™šæ‹Ÿæœºè¿ç§»ï¼š**
    * **VM Import/Export (A/D):** æ—§å·¥å…·ï¼Œéœ€è¦å¯¼å‡ºé•œåƒå†ä¸Šä¼ ï¼Œæ…¢ä¸”ä¸æ”¯æŒå¢é‡åŒæ­¥ï¼Œåœæœºæ—¶é—´é•¿ã€‚
    * **AWS Application Migration Service (MGN) (B/D):** (å‰èº« CloudEndure)ã€‚æ”¯æŒå—çº§å¤åˆ¶ï¼ŒæŒç»­åŒæ­¥ï¼Œåœæœºæ—¶é—´æçŸ­ã€‚è¿™æ˜¯è¿ç§» VM çš„é¦–é€‰ã€‚D é€‰é¡¹è¯´ç”¨ MGN è¿ç§»åˆ° Transfer Familyï¼Ÿé‚£æ˜¯ä¼ æ–‡ä»¶çš„ï¼Œä¸æ˜¯è¿ VM çš„ã€‚B é€‰é¡¹ç”¨ MGN è¿ VMï¼Œæ­£ç¡®ã€‚
* **NFS æ•°æ®è¿ç§»ï¼š**
    * 10TB æ•°æ®ï¼Œ10Gbps ä¸“çº¿ã€‚ç†è®ºä¼ è¾“æ—¶é—´ï¼š10TB / 1.25GB/s $\approx$ 8000ç§’ $\approx$ 2.2 å°æ—¶ã€‚
    * **DataSync (B/C):** åœ¨çº¿ä¼ è¾“ï¼Œåˆ©ç”¨ 10Gbps ä¸“çº¿ï¼Œé€Ÿåº¦æå¿«ã€‚
    * **Snowball (A/D):** å¿«é€’å°±è¦å‡ å¤©ã€‚å¯¹äº 10TB æ•°æ®ä¸”æœ‰ 10G ä¸“çº¿çš„æƒ…å†µï¼Œ**åœ¨çº¿ä¼ è¾“æ¯”ç‰©ç†å¿«é€’å¿«å¾—å¤š**ã€‚
* **å­˜å‚¨ç›®æ ‡ï¼š**
    * æœ¬åœ°æ˜¯ NFSï¼Œä¸Šäº‘å¯¹åº” **EFS** (B) æˆ– FSxã€‚FSx for Lustre (C) æ˜¯ HPC ç”¨çš„ï¼Œè™½ç„¶ä¹Ÿæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œä½† EFS æ˜¯é€šç”¨ NFS çš„å¯¹åº”ç‰©ã€‚æ›´é‡è¦çš„æ˜¯ C é€‰é¡¹è¯´ "Recreate VMs... Install packages"ï¼Œè¿™æ˜¯ Re-platforming ç”šè‡³ Re-architectingï¼Œæ¯” MGN (Lift & Shift) æ…¢å¾—å¤šã€‚
* **ç»“è®ºï¼š** B é€‰é¡¹ï¼ˆMGN è¿ VM + DataSync è¿ NFS åˆ° EFSï¼‰åˆ©ç”¨äº†é«˜é€Ÿä¸“çº¿å’Œç°ä»£è¿ç§»å·¥å…·ï¼Œé€Ÿåº¦æœ€å¿«ã€‚
* **é”å®š Bã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ B)**
* **MGN:** å¿«é€Ÿè¿ç§» VMã€‚
* **DataSync over 10G DX:** å¿«é€Ÿè¿ç§»æ•°æ®ï¼ˆæ¯” Snowball å¿«ï¼‰ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** è¿ç§»å·¥å…·é€‰å‹ä¸ä¼ è¾“æ–¹å¼çš„æ—¶é—´ä¼°ç®— (10TB + 10G DX = Online)ã€‚

---

#### ğŸ“ [303/529] ECS æ•æ„Ÿæ•°æ®å­—æ®µçº§åŠ å¯† (Field-Level Encryption)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **æ¶æ„ï¼š** CloudFront $\rightarrow$ ALB $\rightarrow$ ECSã€‚
* **éœ€æ±‚ï¼š** Sensitive data encrypted **in transit** (throughout app stack). Only **Data Processing Microservice** can decrypt. (åªæœ‰ç‰¹å®šå¾®æœåŠ¡èƒ½è§£å¯†ï¼ŒALB æˆ–å…¶ä»–å¾®æœåŠ¡ä¸èƒ½è§£å¯†)ã€‚
* **æŠ€æœ¯ï¼š** **Field-Level Encryption** (å­—æ®µçº§åŠ å¯†)ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **CloudFront Field-Level Encryption:**
    * å…è®¸ä½ åœ¨è¾¹ç¼˜ï¼ˆCloudFrontï¼‰åŠ å¯†ç‰¹å®šçš„ POST å­—æ®µï¼ˆå¦‚ä¿¡ç”¨å¡å·ï¼‰ã€‚
    * ä½¿ç”¨ **Public Key** (RSA) åŠ å¯†ã€‚
    * åªæœ‰æ‹¥æœ‰ **Private Key** çš„åç«¯æœåŠ¡æ‰èƒ½è§£å¯†ã€‚
* **å¯†é’¥ç±»å‹ï¼š**
    * éå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼‰ã€‚
    * KMS å¯¹ç§°å¯†é’¥ (A/C) ä¸é€‚ç”¨è¿™ç§â€œè¾¹ç¼˜åŠ å¯†ï¼Œç‰¹å®šåç«¯è§£å¯†â€çš„è§£è€¦åœºæ™¯ï¼ˆé€šå¸¸ CloudFront FLE è¦æ±‚ä¸Šä¼  RSA å…¬é’¥ï¼‰ã€‚
* **é…ç½®ï¼š**
    * ä¸Šä¼  RSA **Public Key** åˆ° CloudFrontã€‚ $\rightarrow$ **é€‰ä¸­ B**ã€‚
    * åç«¯å¾®æœåŠ¡æŒæœ‰ **Private Key** è¿›è¡Œè§£å¯†ã€‚
* **æ’é™¤æ³•ï¼š**
    * C/D (Lambda@Edge): è™½ç„¶å¯ä»¥è‡ªå·±å†™ä»£ç åŠ å¯†ï¼Œä½†è¿™å¢åŠ äº†å»¶è¿Ÿå’Œç»´æŠ¤æˆæœ¬ã€‚CloudFront åŸç”Ÿæ”¯æŒ FLEï¼Œé…ç½®å³ç”¨ã€‚ä¸” D æ˜¯ç”¨ç§é’¥åŠ å¯†ï¼Ÿé‚£æ˜¯ç­¾åï¼Œä¸æ˜¯åŠ å¯†ã€‚åŠ å¯†æ˜¯ç”¨å…¬é’¥ã€‚
* **é”å®š Bã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ B)**
* **CloudFront Field-Level Encryption:** ä½¿ç”¨ RSA å…¬é’¥åœ¨è¾¹ç¼˜åŠ å¯†æ•æ„Ÿå­—æ®µï¼Œç¡®ä¿æ•°æ®åœ¨ç©¿è¿‡æ•´ä¸ªå †æ ˆï¼ˆALB, ä¸­é—´ä»¶ï¼‰æ—¶éƒ½æ˜¯å¯†æ–‡ï¼Œåªæœ‰æŒæœ‰ç§é’¥çš„æœ€ç»ˆæœåŠ¡èƒ½è§£å¯†ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** CloudFront å­—æ®µçº§åŠ å¯†çš„å·¥ä½œåŸç† (RSA)ã€‚

---

#### ğŸ“ [304/529] VPC DNS è§£æ (Private Hosted Zone)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **VPC CIDR:** `10.24.34.0/24`.
* **DNS Resolver:** `10.24.34.2` (VPC CIDR + 2, é€™æ˜¯ AWS DNS Server çš„ä¿ç•™åœ°å€)ã€‚
* **éœ€æ±‚ï¼š**
    1.  Use **Private Hosted Zone** (PHZ)ã€‚
    2.  Instances with public IP get **Public Hostnames**ã€‚
* **å…³é”®å±æ€§ï¼š**
    * `enableDnsSupport`: å¿…é¡»ä¸º trueï¼Œå¦åˆ™æ— æ³•è§£æã€‚
    * `enableDnsHostnames`: å¿…é¡»ä¸º trueï¼Œå¦åˆ™æ²¡æœ‰å…¬æœ‰ä¸»æœºåã€‚
    * **DHCP Options Set:** é»˜è®¤æ˜¯ `AmazonProvidedDNS`ã€‚å¦‚æœ VPC CIDR æ˜¯ `10.24.34.0/24`ï¼Œ`AmazonProvidedDNS` è§£æåˆ°çš„å°±æ˜¯ `10.24.34.2`ã€‚æ˜¾å¼å†™ IP ä¹Ÿå¯ä»¥ï¼Œä½† `AmazonProvidedDNS` æ›´æ ‡å‡†ã€‚
* **é€‰é¡¹å¯¹æ¯”ï¼š**
    * é€‰é¡¹ C/D: Deactivate `enableDnsSupport` æˆ– `enableDnsHostnames`ï¼Ÿè¿™ç›´æ¥è¿åäº†éœ€æ±‚ï¼ˆæ— æ³•è§£ææˆ–æ— ä¸»æœºåï¼‰ã€‚æ’é™¤ã€‚
    * é€‰é¡¹ A: DHCP option `domain-name-servers=10.24.34.2`ã€‚è¿™æ˜¯ AWS DNS çš„ IPã€‚ä½†æ˜¯ A é€‰é¡¹æ²¡æœ‰æŠŠ PHZ å…³è”åˆ° VPCï¼ˆæˆ–è€…éšå«äº†ï¼Ÿï¼‰ã€‚
    * é€‰é¡¹ B:
        * Create PHZ, **Associate with VPC** (å¿…é¡»å…³è”æ‰èƒ½è§£æ)ã€‚
        * Activate `enableDnsSupport` & `enableDnsHostnames` (æ»¡è¶³éœ€æ±‚)ã€‚
        * Create DHCP Options `AmazonProvidedDNS`ã€‚
        * è¿™æ˜¯æœ€å®Œæ•´ã€æœ€æ ‡å‡†çš„é…ç½®ã€‚
    * **A vs B:** A æ‰‹å†™ IP `10.24.34.2` ä¹Ÿæ˜¯å¯¹çš„ï¼Œä½† B çš„ `Associate with VPC` æ­¥éª¤æ˜¯ PHZ ç”Ÿæ•ˆçš„å…³é”®ã€‚å¦‚æœåªåˆ›å»ºä¸å…³è”ï¼ŒVPC é‡Œçš„å®ä¾‹è§£æä¸åˆ° PHZ çš„è®°å½•ã€‚ä¸” `AmazonProvidedDNS` æ˜¯æ›´æ¨èçš„å†™æ³•ã€‚
    * **é”å®š Bã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ B)**
* **enableDnsHostnames:** ç”Ÿæˆå…¬æœ‰ä¸»æœºåã€‚
* **Associate PHZ:** è®© VPC èƒ½å¤Ÿè§£æç§æœ‰åŸŸåã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** VPC DNS å±æ€§é…ç½®ä¸ Private Hosted Zone çš„å…³è”ã€‚

---

#### ğŸ“ [305/529] Redshift çªå‘æŸ¥è¯¢æ‰©å±• (Concurrency Scaling)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **ç°çŠ¶ï¼š** Reserved Nodes (é¢„ç•™èŠ‚ç‚¹) é›†ç¾¤ã€‚
* **é—®é¢˜ï¼š** Unexpected spikes (æ„å¤–é«˜å³°)ï¼ŒCPU é«˜ã€‚
* **éœ€æ±‚ï¼š** Serve reads and writes at all times (ä¿æŒå¯ç”¨)ã€‚
* **ç›®æ ‡ï¼š** **Most cost-effective**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **åŠŸèƒ½ç‰¹æ€§ï¼š**
    * **Concurrency Scaling (å¹¶å‘æ‰©å±•):** Amazon Redshift çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå½“ä¸»é›†ç¾¤ç¹å¿™æ—¶ï¼Œè‡ªåŠ¨æ·»åŠ ç¬æ—¶é›†ç¾¤æ¥å¤„ç†å¹¶å‘æŸ¥è¯¢ã€‚
    * **å…è´¹é¢åº¦ï¼š** æ¯ 24 å°æ—¶ä¸»é›†ç¾¤è¿è¡Œæ—¶é—´ï¼Œèµ é€ 1 å°æ—¶å¹¶å‘æ‰©å±•é¢åº¦ã€‚è¿™ä½¿å¾—å®ƒéå¸¸ **Cost-effective**ï¼ˆå¯¹äºé—´æ­‡æ€§é«˜å³°ï¼Œé€šå¸¸æ˜¯å…è´¹çš„ï¼‰ã€‚
    * **Resize (B/C):** è°ƒæ•´é›†ç¾¤å¤§å°ï¼ˆClassic æˆ– Elasticï¼‰éœ€è¦æ—¶é—´ï¼ˆå‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ï¼Œä¸”ä¼šä¸­æ–­è¿æ¥æˆ–å˜æˆåªè¯»ï¼ˆClassicï¼‰ï¼Œæˆ–è€…æˆæœ¬è¾ƒé«˜ï¼ˆå¢åŠ èŠ‚ç‚¹ï¼‰ã€‚å¯¹äºâ€œæ„å¤–é«˜å³°â€ï¼Œå¹¶å‘æ‰©å±•æ˜¯ç§’çº§å“åº”ä¸”å¯¹ç”¨æˆ·é€æ˜çš„ã€‚
    * A (EMR): è¿ç§»æ•°æ®å» EMR æŸ¥ï¼Ÿå¤ªæ…¢å¤ªå¤æ‚ã€‚
* **é”å®š Dã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ D)**
* **Concurrency Scaling:** è‡ªåŠ¨åº”å¯¹æŸ¥è¯¢å¹¶å‘é«˜å³°ï¼Œåˆ©ç”¨å…è´¹é¢åº¦é™ä½æˆæœ¬ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** Redshift åº”å¯¹çªå‘æŸ¥è¯¢è´Ÿè½½çš„åŠŸèƒ½ (Concurrency Scaling)ã€‚

---

#### ğŸ“ [306/529] S3 ä¸ªäººæ–‡ä»¶å¤¹æƒé™ä¸å®¡è®¡ (Home Directory + Athena)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **ç”¨æˆ·ï¼š** 100 ç§‘å­¦å®¶ï¼ŒIAM User Groupã€‚
* **éœ€æ±‚ï¼š**
    1.  Each has **personal folder** (ä¸ªäººæ–‡ä»¶å¤¹)ï¼Œä¸èƒ½äº’è®¿ã€‚
    2.  Strict audit reporting (ä¸¥æ ¼å®¡è®¡æŠ¥å‘Šï¼šè°è®¿é—®äº†ä»€ä¹ˆ)ã€‚
* **ç›®æ ‡ï¼š** Turnkey solution, **Minimize operational overhead**ã€‚
* **é€‰æ‹©ï¼š** 2 ä¸ªæ­¥éª¤ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **æƒé™æ§åˆ¶ (ä¸ªäººæ–‡ä»¶å¤¹):**
    * ä¸ºæ¯ä¸ªç”¨æˆ·å†™ä¸€ä¸ª Policyï¼Ÿ100 ä¸ªç”¨æˆ·å¤ªç´¯ã€‚
    * **åŠ¨æ€ç­–ç•¥å˜é‡ (A):** ä½¿ç”¨ `${aws:username}` å˜é‡ã€‚å†™ä¸€ä¸ªé€šç”¨çš„ IAM Policyï¼Œå…è®¸è®¿é—® `s3://bucket/${aws:username}/*`ã€‚åº”ç”¨ç»™ Groupã€‚è¿™æ ·æ¯ä¸ªäººåªèƒ½è®¿é—®è‡ªå·±çš„åŒåæ–‡ä»¶å¤¹ã€‚è¿™æ˜¯æœ€ä½³å®è·µã€‚
    * $\rightarrow$ **é€‰ä¸­ A**ã€‚
    * (D æ˜¯ Bucket Policyï¼Œè™½ç„¶ä¹Ÿèƒ½ç”¨å˜é‡ï¼Œä½†é€šå¸¸è¿™ç§ç”¨æˆ·æƒé™åœ¨ IAM Policy é‡Œé…æ›´æ–¹ä¾¿ç®¡ç† Group)ã€‚
* **å®¡è®¡æŠ¥å‘Š:**
    * **CloudTrail (B/E):** è®°å½• API è°ƒç”¨ï¼ˆåŒ…æ‹¬ S3 Data Eventsï¼‰ã€‚è¿™æ˜¯å®¡è®¡çš„åŸºç¡€ã€‚
    * **Access Logs (C):** ä¹Ÿå¯ä»¥ï¼Œä½† CloudTrail ä¿¡æ¯æ›´ä¸°å¯Œï¼ˆèº«ä»½ä¿¡æ¯æ›´æ˜ç¡®ï¼‰ã€‚é¢˜ç›®è¦æ±‚â€œWho accessed whatâ€ã€‚
    * **æŸ¥è¯¢å·¥å…·:**
        * **Athena (B):** å¯ä»¥ç›´æ¥æŸ¥è¯¢ S3 ä¸­çš„ CloudTrail æ—¥å¿—ã€‚
        * **Athena CloudWatch Connector (E):** æ²¡å¿…è¦æŠŠæ—¥å¿—å‘åˆ° CloudWatch å†ç”¨ Connector æŸ¥ï¼Œç›´æ¥æŸ¥ S3 æœ€ç®€å•ã€‚
    * $\rightarrow$ **é€‰ä¸­ B**ã€‚
* **é”å®š A, Bã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ A, B)**
* **IAM Policy Variable:** å®ç°åŠ¨æ€çš„â€œä¸»ç›®å½•â€æƒé™éš”ç¦»ã€‚
* **CloudTrail + Athena:** æ ‡å‡†çš„ Serverless å®¡è®¡æ—¥å¿—åˆ†ææ–¹æ¡ˆã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** S3 ä¸»ç›®å½•æƒé™æ¨¡å¼ä¸ CloudTrail æ•°æ®äº‹ä»¶å®¡è®¡ã€‚

---

#### ğŸ“ [307/529] ECR ç»„ç»‡çº§è®¿é—®ä¸ç”Ÿå‘½å‘¨æœŸ (Repo Policy + Lifecycle)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **åœºæ™¯ï¼š** ç»„ç»‡å†…å¤šè´¦æˆ·è®¿é—® ECRã€‚
* **éœ€æ±‚ï¼š**
    1.  Only accounts within Org can access (ä»…ç»„ç»‡å†…è´¦æˆ·å¯è®¿é—®)ã€‚
    2.  Retain all tagged, retain **last 5 untagged** (ä¿ç•™æ‰€æœ‰æ‰“æ ‡ï¼Œä¿ç•™æœ€è¿‘5ä¸ªæœªæ‰“æ ‡)ã€‚
* **ç›®æ ‡ï¼š** **Minimize operational overhead**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **è®¿é—®æ§åˆ¶ï¼š**
    * **ECR Repository Policy:** å¯ä»¥é…ç½®æƒé™ã€‚
    * è¦å…è®¸æ•´ä¸ªç»„ç»‡ï¼Œä½¿ç”¨æ¡ä»¶é”® `aws:PrincipalOrgID`ã€‚è¿™æ ·ä¸éœ€è¦åˆ—å‡ºå‡ ç™¾ä¸ªè´¦æˆ· IDï¼Œä¸”è‡ªåŠ¨æ”¯æŒæ–°è´¦æˆ·ã€‚
    * **Private Repo (A):** æ­£å¸¸ä½¿ç”¨ç§æœ‰åº“ã€‚é…ç½® Policy å…è®¸ `Principal: *` ä¸” `Condition: aws:PrincipalOrgID = xxx`ã€‚ $\rightarrow$ **é€‰ä¸­ A**ã€‚
    * (B æ˜¯ Public Repoï¼Ÿä¼ä¸šå†…éƒ¨é•œåƒé€šå¸¸ç”¨ Private)ã€‚
* **ç”Ÿå‘½å‘¨æœŸï¼š**
    * **ECR Lifecycle Policy:** åŸç”Ÿæ”¯æŒè§„åˆ™ "expire untagged images, count > 5"ã€‚è¿™å®Œå…¨ç¬¦åˆéœ€æ±‚ï¼Œæ— éœ€å†™ Lambdaã€‚
    * $\rightarrow$ **é€‰ä¸­ A**ã€‚
    * (C/D ç”¨ EventBridge + Lambda åˆ é•œåƒï¼ŸECR è‡ªå¸¦ Lifecycle Policyï¼Œé€ è½®å­æ˜¯å¤šä½™çš„)ã€‚
* **é”å®š Aã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ A)**
* **aws:PrincipalOrgID:** ç®€åŒ–ç»„ç»‡çº§æˆæƒã€‚
* **ECR Lifecycle Policy:** è‡ªåŠ¨åŒ–æ¸…ç†é•œåƒã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** ECR çš„æƒé™ç­–ç•¥ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

---

#### ğŸ“ [308/529] RDS è·¨è´¦æˆ·å¤‡ä»½ç®¡ç† (AWS Backup)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **éœ€æ±‚ï¼š** RDS å¿«ç…§ï¼Œæ¯ 6 å°æ—¶ä¸€æ¬¡ï¼Œä¿ç•™ 30 å¤©ã€‚
* **èŒƒå›´ï¼š** Organization (æ‰€æœ‰è´¦æˆ·)ã€‚
* **è§†å›¾ï¼š** **Consolidated view** of backup health (ç»Ÿä¸€è§†å›¾)ã€‚
* **ç›®æ ‡ï¼š** **Least operational overhead**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **å·¥å…·é€‰å‹ï¼š**
    * **AWS Backup (A):** ä¸“ä¸ºè·¨è´¦æˆ·ã€è·¨æœåŠ¡å¤‡ä»½è®¾è®¡ã€‚æ”¯æŒ **Cross-account management** (é€šè¿‡ Organizations)ã€‚æ”¯æŒåœ¨ç®¡ç†è´¦æˆ·æŸ¥çœ‹æ‰€æœ‰å¤‡ä»½ä»»åŠ¡çŠ¶æ€ï¼ˆç»Ÿä¸€è§†å›¾ï¼‰ã€‚
    * **RDS åŸç”Ÿå¤‡ä»½ (B):** RDS è‡ªåŠ¨å¤‡ä»½ä¸æ”¯æŒè·¨è´¦æˆ·é›†ä¸­ç®¡ç†è§†å›¾ï¼Œä¹Ÿä¸èƒ½è½»æ˜“è®¾ç½®â€œæ¯ 6 å°æ—¶â€ï¼ˆRDS è‡ªåŠ¨å¤‡ä»½æ˜¯è¿ç»­çš„ï¼Œå¿«ç…§æ˜¯æ¯å¤©ä¸€æ¬¡ï¼‰ã€‚æ‰‹åŠ¨å¿«ç…§ç­–ç•¥åˆ†æ•£åœ¨å„è´¦æˆ·ã€‚
    * **StackSets + Lambda (C):** è‡ªå®šä¹‰æ–¹æ¡ˆï¼Œè¿ç»´é‡ã€‚
    * **DLM (D):** Data Lifecycle Manager ä¸»è¦é’ˆå¯¹ EBSã€‚è™½ç„¶ç°åœ¨ä¹Ÿæ”¯æŒ RDSï¼Œä½† AWS Backup åŠŸèƒ½æ›´å¼ºå¤§ä¸”æ˜¯é¦–é€‰çš„é›†ä¸­å¤‡ä»½å·¥å…·ã€‚ä¸” D é€‰é¡¹è¯´åœ¨â€œæ¯ä¸ªæˆå‘˜è´¦æˆ·æ§åˆ¶å°ç›‘æ§â€ï¼Œä¸ç¬¦åˆâ€œç»Ÿä¸€è§†å›¾â€ã€‚
* **æ“ä½œï¼š**
    * å¼€å¯ AWS Backup è·¨è´¦æˆ·åŠŸèƒ½ã€‚
    * åˆ›å»º Backup Planã€‚
    * ä½¿ç”¨æ ‡ç­¾åˆ†é…èµ„æºã€‚
    * åœ¨ç®¡ç†è´¦æˆ·ç›‘æ§ã€‚
    * $\rightarrow$ **é€‰ä¸­ A**ã€‚
* **é”å®š Aã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ A)**
* **AWS Backup:** ç»„ç»‡çº§é›†ä¸­å¤‡ä»½ç®¡ç†ä¸ç›‘æ§çš„æœ€ä½³å®è·µã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** AWS Backup åœ¨å¤šè´¦æˆ·ç¯å¢ƒä¸‹çš„åº”ç”¨ã€‚

---

#### ğŸ“ [309/529] è·¨è´¦æˆ· AssumeRole æƒé™é“¾

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **åœºæ™¯ï¼š** Account A (IAM User) $\rightarrow$ Account B (IAM Role)ã€‚
* **æ“ä½œï¼š** `AssumeRole`ã€‚
* **é€‰æ‹©ï¼š** 3 ä¸ªæ­¥éª¤ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **æƒé™ä¸‰å…³ï¼š**
    1.  **Account A (Identity):** ç”¨æˆ·å¿…é¡»æœ‰æƒé™è°ƒç”¨ `sts:AssumeRole`ã€‚è¿™é…ç½®åœ¨ **User çš„ Identity Policy** ä¸Šã€‚ $\rightarrow$ **é€‰ä¸­ C**ã€‚
    2.  **Account B (Role Trust):** è§’è‰²å¿…é¡»ä¿¡ä»» Account Aï¼ˆæˆ–å…·ä½“ç”¨æˆ·ï¼‰ã€‚è¿™é…ç½®åœ¨ **Role çš„ Trust Policy** ä¸Šã€‚ $\rightarrow$ **é€‰ä¸­ E**ã€‚
    3.  **Account A (SCP - å¯é€‰ä½†å¿…é¡»æ£€æŸ¥):** å¦‚æœæœ‰ SCPï¼Œå¿…é¡»å…è®¸ï¼ˆæˆ–ä¸æ‹’ç»ï¼‰è¯¥æ“ä½œã€‚é¢˜ç›®é—®â€œå¿…é¡»é‡‡å–å“ªä¸‰ä¸ªæ­¥éª¤â€ã€‚SCP é»˜è®¤æ˜¯ Allow Allï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æ‹’ç»ï¼Œé€šå¸¸ä¸éœ€è¦åŠ¨ã€‚ä½†å¦‚æœé¢˜ç›®é—®çš„æ˜¯é…ç½®æµç¨‹ï¼š
        * A (SCP for Account A): å¦‚æœ SCP é™åˆ¶äº†ï¼Œéœ€è¦æ”¹ã€‚ä½†é€šå¸¸è¿™æ˜¯ä¸€ä¸ªæ£€æŸ¥ç‚¹ã€‚
        * F (Session Policy): å¯é€‰çš„ï¼Œä¸æ˜¯å¿…é¡»ã€‚
    * **ç­‰ç­‰ï¼Œ** é¢˜ç›®é—® "Must take"ã€‚
    * å¿…é¡»æœ‰çš„ï¼š
        * ç”¨æˆ·æƒé™ (C)ã€‚
        * è§’è‰²ä¿¡ä»» (E)ã€‚
    * ç¬¬ä¸‰ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿ
    * å¦‚æœ Account A å’Œ B åœ¨åŒä¸€ä¸ª Orgï¼Œä¸” SCP é™åˆ¶äº†è·¨è´¦æˆ·è®¿é—®ï¼Ÿæˆ–è€… SCP é»˜è®¤å…è®¸ã€‚
    * è®©æˆ‘ä»¬çœ‹é€‰é¡¹ï¼š
        * A: SCP for Account Aã€‚
        * B: Resource-based policy for resource? AssumeRole çš„ç›®æ ‡èµ„æºæ˜¯ Roleã€‚Role çš„ Resource Policy å°±æ˜¯ Trust Policy (E)ã€‚B é€‰é¡¹é€šå¸¸æŒ‡ S3 Bucket Policy ç­‰ï¼Œè¿™é‡Œä¸é€‚ç”¨ã€‚
        * D: Identity Policy for User in Account B? ç”¨æˆ·åœ¨ A è´¦æˆ·ã€‚
        * F: Session Policy?
    * **é‡æ–°å®¡è§† A:** "Configure SCP for Account A to allow the action". SCP é»˜è®¤æ˜¯ Allow *ã€‚ä½†å¦‚æœæ˜¯åœ¨ä¸¥æ ¼å—é™çš„ Org ç¯å¢ƒä¸­ï¼ˆé€šå¸¸è€ƒè¯•å‡è®¾ï¼‰ï¼Œå¯èƒ½éœ€è¦æ˜¾å¼å…è®¸ï¼Ÿæˆ–è€…é¢˜ç›®åªæ˜¯åˆ—å‡ºäº†æ‰€æœ‰å¯èƒ½çš„æ§åˆ¶å±‚ã€‚
    * **å®é™…ä¸Šï¼Œ** AssumeRole åªéœ€è¦ä¸¤ç«¯é…ç½®ï¼šA çš„å‡ºç«™æƒé™ (Identity Policy) å’Œ B çš„å…¥ç«™ä¿¡ä»» (Trust Policy)ã€‚
    * **ä½†æ˜¯é¢˜ç›®è¦é€‰ 3 ä¸ªã€‚**
    * éš¾é“æ˜¯ A? å› ä¸º SCP ç¡®å®æ˜¯æ§åˆ¶å±‚ä¹‹ä¸€ã€‚
    * æˆ–è€… B? éš¾é“æŠŠ Trust Policy ç®—ä½œ Resource-based Policyï¼Ÿ(æŠ€æœ¯ä¸Šæ˜¯çš„ï¼Œä½† E å·²ç»è¯´äº† Trust Policy)ã€‚
    * **è®©æˆ‘ä»¬å†è¯»ä¸€é F:** "Configure session policy...". Session Policy æ˜¯ AssumeRole æ—¶**ä¼ è¿›å»**çš„ï¼Œç”¨äºè¿›ä¸€æ­¥é™åˆ¶æƒé™ã€‚ä¸æ˜¯å¿…é¡»çš„ã€‚
    * **è¿™é¢˜æœ‰ä¸ªé™·é˜±ã€‚**
    * ä¹Ÿè®¸ "Resource-based policy" (B) æŒ‡çš„æ˜¯ Account B ä¸­ Role çš„æƒé™ï¼Ÿä¸ï¼Œé‚£æ˜¯ Role çš„ Identity Policyï¼ˆå†³å®š Role èƒ½å¹²ä»€ä¹ˆï¼‰ï¼Œä¸æ˜¯ AssumeRole è¿™ä¸ªåŠ¨ä½œæœ¬èº«éœ€è¦çš„ã€‚
    * **å›é¡¾ IAM è¯„ä¼°é€»è¾‘ï¼š**
        * 1. SCP (å¦‚æœé€‚ç”¨)ã€‚
        * 2. Identity Policy (User)ã€‚
        * 3. Resource Policy (Role Trust Policy)ã€‚
    * è¿™ä¸‰è€…å¿…é¡»éƒ½é€šè¿‡ï¼ˆæˆ–ä¸æ‹’ç»ï¼‰ã€‚
    * æ‰€ä»¥ A, C, E æ˜¯æ„æˆæƒé™é“¾è·¯çš„ä¸‰ä¸ªç¯èŠ‚ã€‚
    * **é”å®š A, C, Eã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ A, C, E)**
* **Identity Policy (User):** å…è®¸å‘å‡ºè¯·æ±‚ã€‚
* **Trust Policy (Role):** å…è®¸æ¥æ”¶è¯·æ±‚ã€‚
* **SCP (Org):** å…è®¸è´¦æˆ·é—´æ“ä½œï¼ˆä¸è¢«ç»„ç»‡ç­–ç•¥æ‹¦æˆªï¼‰ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** è·¨è´¦æˆ· IAM æˆæƒçš„å®Œæ•´è¯„ä¼°é€»è¾‘ã€‚

---

#### ğŸ“ [310/529] æœ¬åœ° NFS å¤‡ä»½å½’æ¡£ (File Gateway + Glacier Deep Archive)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **æºç«¯ï¼š** æœ¬åœ°æ–‡ä»¶å­˜å‚¨ (NFS)ã€‚
* **éœ€æ±‚ï¼š** New solution support NFS (æ–°æ–¹æ¡ˆä¹Ÿè¦ NFS)ã€‚
* **å½’æ¡£ï¼š** Archive after 5 days (5å¤©åå½’æ¡£)ã€‚
* **æ¢å¤ï¼š** Willing to wait several days (å¯ç­‰å¾…å‡ å¤© -> **Deep Archive**)ã€‚
* **ç›®æ ‡ï¼š** **Most cost-effective**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **ç½‘å…³é€‰å‹ï¼š**
    * æä¾› NFS æ¥å£ $\rightarrow$ **File Gateway (S3 File Gateway)**ã€‚
    * Volume Gateway (B) æä¾› iSCSIã€‚Tape Gateway (C) æä¾› VTLã€‚
    * $\rightarrow$ **é€‰ä¸­ A æˆ– D**ã€‚
* **å­˜å‚¨ç±»åˆ«ï¼š**
    * "Wait several days" + "Most cost-effective" $\rightarrow$ **Glacier Deep Archive**ã€‚
    * S3 Standard-IA (A) æ˜¯å³æ—¶è®¿é—®çš„ï¼Œä»·æ ¼æ¯” Deep Archive è´µå¾—å¤šã€‚
    * $\rightarrow$ **é€‰ä¸­ D**ã€‚
* **é”å®š Dã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ D)**
* **File Gateway:** æä¾› NFS æ¥å£ï¼Œæ— ç¼å¯¹æ¥ã€‚
* **Lifecycle to Deep Archive:** æœ€ä½æˆæœ¬çš„é•¿æœŸå½’æ¡£å­˜å‚¨ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** å¤‡ä»½å½’æ¡£çš„å­˜å‚¨ç½‘å…³é€‰å‹ä¸ S3 æˆæœ¬ä¼˜åŒ–ã€‚

---
**å°ç»“ï¼š**
è¿™ç»„é¢˜ç›®çš„ **Organizations SCP**ã€**AWS Backup**ã€**EFS vs DataSync** éƒ½æ˜¯ç»å…¸ã€‚

**æ­å–œä½ ï¼Œ310 é¢˜ï¼**
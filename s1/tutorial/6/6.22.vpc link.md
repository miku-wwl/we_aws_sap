- **VPC Link**：仅用于「API Gateway → VPC内资源」（公网API Gateway访问VPC里的EC2/ALB/ECS），方向是“从外到内（API Gateway进VPC）”；  
- **VPC内资源访问API Gateway**：有3种核心方式（按场景优先级排序），核心是 **Private Endpoint（推荐，安全合规）**，其次是公网访问、跨VPC访问，下面逐一拆解（结合SAP考点）：


## 一、VPC内资源访问API Gateway的3种方式（SAP考点全覆盖）
### 方式1：Private Endpoint（首选，SAP高频考点）—— 私有访问，无公网
#### 核心场景：API是“内部API”（仅允许VPC内资源访问，禁止公网暴露），如员工管理系统、VPC内服务间调用。
#### 底层原理：
通过 **API Gateway Private Endpoint**（VPC终端节点），将API Gateway“接入”你的VPC，VPC内资源（EC2、Lambda、EKS Pod）通过VPC私有网络访问API，**不经过公网**，安全性最高，符合合规要求（如金融、医疗场景）。

#### 关键配置（SAP实操考点）：
1. 创建API Gateway时，设置为“私有模式”（关闭公网访问）；  
2. 在VPC中创建“API Gateway Private Endpoint”（类型：`com.amazonaws.{region}.execute-api`），关联VPC的私有子网和安全组（仅允许VPC内指定资源访问）；  
3. VPC内资源通过Private Endpoint的 **私有DNS名称** 访问API（格式：`https://{api-id}.execute-api.{region}.vpce.amazonaws.com/{stage}/{resource}`）。

#### 示例（SAP真题场景）：
“VPC内的EC2实例需访问内部API，要求请求不经过公网，应如何配置？” → 答案：创建API Gateway Private Endpoint，EC2通过私有DNS访问API。

#### 核心优势（SAP考点）：
- 安全：请求走AWS私有网络，无公网暴露风险；  
- 无需公网出口：VPC内资源即使没有NAT网关、弹性IP，也能访问（因为走私有网络）。


### 方式2：公网访问（次选）—— API Gateway是公网可访问的
#### 核心场景：API是“公网API”（允许公网和VPC内资源同时访问），如面向用户的App API，VPC内的EC2也需要调用。
#### 底层原理：
API Gateway默认是公网可访问的（有公网域名：`https://{api-id}.execute-api.{region}.amazonaws.com`），VPC内资源通过 **NAT网关** 访问公网，进而调用API Gateway的公网端点。

#### 关键配置（SAP陷阱题）：
1. VPC内资源（如EC2）需部署在 **私有子网**，且私有子网需配置 **NAT网关**（否则无法访问公网，调用失败）；  
2. API Gateway无需额外配置（保持公网访问模式），VPC内资源直接通过公网域名调用API。

####  SAP陷阱题示例：
“VPC内的Lambda函数调用公网API Gateway失败，原因是什么？” → 答案：Lambda所在的私有子网未配置NAT网关，无法访问公网。

#### 注意事项（SAP考点）：
- 安全性低于Private Endpoint（请求经过公网），适合非敏感API；  
- 需为VPC内资源配置公网访问权限（如安全组放行 outbound 80/443端口）。


### 方式3：跨VPC访问（延伸场景，SAP中频考点）—— 其他VPC的资源访问API
#### 核心场景：VPC A的EC2需访问VPC B中通过Private Endpoint暴露的API（内部API，无公网）。
#### 底层原理：
通过 **VPC对等连接（VPC Peering）** 或 **AWS Transit Gateway（中转网关）** 打通两个VPC的私有网络，VPC A的资源先访问VPC B的Private Endpoint，再调用API Gateway。

#### 关键配置（SAP考点）：
1. 若两个VPC在同一区域：创建VPC对等连接，关联两个VPC，更新路由表（允许VPC A的网段访问VPC B的Private Endpoint网段）；  
2. 若跨区域/多VPC：创建Transit Gateway，两个VPC均接入中转网关，实现跨VPC通信；  
3. VPC A的资源通过VPC B的Private Endpoint私有DNS访问API。

####  SAP真题场景：
“VPC A的EC2需访问VPC B的内部API（通过Private Endpoint暴露），两个VPC在同一区域，应如何配置网络？” → 答案：创建VPC对等连接，打通两个VPC的路由。


## 二、核心组件访问方向总结（SAP必考表格）
为了彻底避免混淆，整理所有相关组件的“访问方向+适用场景”，记熟这张表，SAP网络题不会错：

| 组件                | 访问方向                          | 核心作用                          | 适用场景                          |
|---------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| **VPC Link**        | API Gateway → VPC内资源           | 公网API Gateway访问VPC内后端      | 公网API + VPC内后端（如EC2/ECS） |
| **Private Endpoint** | VPC内资源 → API Gateway           | VPC内资源访问内部API（无公网）    | 内部API、安全合规场景              |
| **VGW**             | VPC ↔ 外部网络（本地数据中心）    | 混合云通信、跨地域私有连接        | 企业本地数据中心访问VPC内资源      |
| **公网访问**        | VPC内资源 → 公网API Gateway       | VPC内资源访问公网API              | 非敏感公网API、简单场景            |

### 记忆口诀（SAP备考必记）：
- 内访API（VPC→API Gateway）：私有用Private Endpoint，公网用NAT网关；  
- 外访VPC（API Gateway→VPC）：必用VPC Link；  
- 跨VPC/本地：对等连接/Transit Gateway/VGW。


## 三、常见误区（SAP陷阱题避坑）
1. ❌ 误区：VPC内资源访问API Gateway需要VPC Link → 错！VPC Link是反向的（API Gateway→VPC），VPC内资源访问API用Private Endpoint或公网；  
2. ❌ 误区：Private Endpoint需要公网出口 → 错！Private Endpoint走VPC私有网络，无需NAT网关、公网IP；  
3. ❌ 误区：跨VPC访问内部API必须用VGW → 错！同一区域用VPC对等连接（成本低、配置简单），跨区域/多VPC用Transit Gateway。


## 总结（核心关键点）
1. VPC Link的访问方向是“API Gateway→VPC内资源”，你的理解完全正确；  
2. VPC内资源访问API Gateway的核心方式：  
   - 内部API（无公网）→ Private Endpoint（SAP高频考点）；  
   - 公网API → 公网访问（需NAT网关）；  
   - 跨VPC → VPC对等连接/Transit Gateway；  
3.  SAP答题技巧：看到“内部API、无公网、合规”→ 选Private Endpoint；看到“公网API、VPC内后端”→ 选VPC Link；看到“跨VPC同一区域”→ 选VPC对等连接。
# AWS SAP 核心模块总结（拓展版·含考点深挖+真题映射）
## 模块总结核心逻辑：
SAP 认证的所有考点本质围绕 **“企业级无服务器/弹性架构的四大核心目标”** 展开——解耦（减少服务依赖）、高并发（应对流量峰值）、冷启动优化（降低延迟）、少运维（托管服务为主）。以下结合底层原理、真题考点、避坑清单，对核心口诀进行深度拓展，帮你从“记住”到“吃透”：

---

## 1. 解耦靠“SQS+SNS”：队列缓冲，通知扩散，服务不依赖
### 核心原理（真题隐含考点）：
通过“异步通信”打破服务间强依赖，SNS 负责“一对多广播事件”，SQS 负责“缓冲流量+可靠投递”，即使上游服务故障，下游服务仍可从队列中消费消息，避免级联失败。

### 拓展考点（占比 15%，高频真题）：
| 核心组件                | 底层细节                          | 真题场景                          | 避坑清单                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| SQS 队列类型            | Standard（高吞吐、无序、可能重复）→ FIFO（有序、去重、低吞吐） | “订单支付需严格顺序，无重复入账”→ 选 FIFO，配置 MessageGroupId（订单号分组）+ MessageDeduplicationId（去重ID） | 误区：FIFO 全局有序→ 错！仅同一 MessageGroupId 内有序 |
| DLQ（死信队列）         | 消息重试超“最大接收次数”（默认 10 次，推荐 3-5 次）后转移，避免阻塞原队列 | “Lambda 处理 SQS 消息反复失败，队列阻塞”→ 配置 DLQ，失败消息人工排查 | 误区：DLQ 可跨类型→ 错！必须与原队列同类型（Standard→Standard） |
| SNS+SQS 组合            | SNS 发布事件，多个 SQS 订阅，实现“广播+缓冲”双重效果 | “电商下单后通知库存、支付、物流系统，单个系统故障不影响其他”→ SNS+3 个 SQS 组合 | 误区：SNS 直接订阅服务→ 错！需通过 SQS 缓冲，避免消息丢失 |

### 口诀延伸：“顺序去重选 FIFO，高吞吐用 Standard，失败消息进 DLQ，多服务通知 SNS+SQS”

---

## 2. 弹性靠“ASG+EKS/ECS”：实例伸缩，容器编排，应对高并发
### 核心原理（企业级架构关键）：
ASG 负责“EC2 实例的弹性伸缩”，EKS/ECS 负责“容器的编排与调度”，两者结合可实现“实例级+容器级”双层弹性，既应对流量峰值，又优化资源利用率。

### 拓展考点（占比 20%，核心真题）：
| 核心组件                | 底层细节                          | 真题场景                          | 避坑清单                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| ASG 弹性伸缩            | 触发条件：CPU/内存使用率、CloudWatch 自定义指标（如队列长度）；支持 Warm Pools（预热实例） | “秒杀场景 EC2 实例不足，启动慢导致响应延迟”→ 配置 ASG Warm Pools，预热实例+快速扩容 | 误区：ASG 仅支持 CPU 触发→ 错！可通过 SQS 队列长度等自定义指标触发 |
| EKS/ECS 选型            | ECS（无 K8s 经验、低运维、蓝绿部署）→ EKS（K8s 兼容、复杂编排：StatefulSet/DaemonSet） | “初创公司无 K8s 团队，部署 5 个微服务，运维成本最低”→ ECS Fargate 模式 | 误区：ECS 支持有状态服务→ 错！有状态服务（如数据库）需选 EKS |
| Fargate 模式            | 无服务器容器，AWS 托管计算资源，仅运行在私有子网，需 ALB 暴露服务 | “容器无法拉取 Docker Hub 镜像”→ 私有子网未配置 NAT 网关，无法访问外网 | 误区：Fargate 可分配公网 IP→ 错！默认无公网 IP，需通过 ALB 暴露 |

### 口诀延伸：“无 K8s 选 ECS，复杂编排选 EKS，无服务器用 Fargate，实例伸缩靠 ASG”

---

## 3. 无服务器核心“Lambda+API Gateway”：函数驱动，API 入口，运维零负担
### 核心原理（SAP 重点模块）：
Lambda 是“事件驱动的无服务器函数”（无需管理服务器），API Gateway 是“API 流量总入口”（统一鉴权、限流、路由），两者无缝集成，构建“零运维、高弹性”的 API 架构。

### 拓展考点（占比 25%，最高频真题）：
| 核心组件                | 底层细节                          | 真题场景                          | 避坑清单                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| Lambda 关键配置         | 超时时间（1-900 秒）、内存配置（128MB-10GB）、并发限制（默认 1000）、DLQ（异步执行失败存储） | “Lambda 处理大文件转码超时”→ 调整超时时间至 900 秒，优化内存配置 | 误区：Lambda 内存越大越贵→ 错！内存越大 CPU 性能越强，单位时间成本可能更低 |
| API Gateway 鉴权        | IAM（AWS 内部用户）→ Cognito（终端用户）→ Lambda Authorizer（自定义逻辑） | “合作伙伴 API 需验证自研 JWT 令牌”→ 选 Lambda Authorizer（Token-based） | 误区：Lambda Authorizer 无缓存→ 错！默认缓存 300 秒，可优化性能 |
| API Gateway 网络配置    | Private Endpoint（VPC 内访问）→ VPC Link（公网 API 访问 VPC 后端） | “内部员工 API 禁止公网访问”→ 配置 Private Endpoint，仅 VPC 内资源访问 | 误区：Private Endpoint 可跨 VPC 访问→ 错！跨 VPC 需 VPC 对等连接/Transit Gateway |

### 口诀延伸：“Lambda 函数驱动，API Gateway 入口，鉴权选对（IAM/Cognito/Lambda），网络隔离靠 Private Endpoint”

---

## 4. 冷启动优化“Warm Pools+Provisioned Concurrency”：预热实例，预置并发，延迟降下来
### 核心原理（SAP 难点模块）：
冷启动是无服务器/弹性架构的核心痛点（Lambda 冷启动 50-500ms，EC2 冷启动分钟级），通过“预热资源”提前准备计算能力，降低用户感知延迟。

### 拓展考点（占比 10%，易错真题）：
| 核心组件                | 底层细节                          | 真题场景                          | 避坑清单                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| ASG Warm Pools（预热池） | 提前启动 EC2 实例并置于“温暖状态”，扩容时直接从预热池调用，启动时间从分钟级→秒级 | “EC2 扩容时启动慢，导致流量峰值扛不住”→ 配置 ASG Warm Pools，设置预热时间 | 误区：Warm Pools 一直计费→ 错！温暖状态实例按闲置费率计费，成本低于运行状态 |
| Lambda Provisioned Concurrency（预置并发） | 提前分配固定数量的 Lambda 实例，确保 0 冷启动，适用于高并发 API | “秒杀 API 调用 Lambda 冷启动延迟高”→ 配置 Provisioned Concurrency，预置 100 并发 | 误区：预置并发免费→ 错！需额外付费，按预置数量计费，适合核心业务 |
| 其他优化方案            | Lambda 内存调优（增大内存提升 CPU 性能）、API Gateway 缓存（缓存响应结果） | “Lambda 冷启动延迟高，非核心 API”→ 启用 API Gateway 响应缓存，TTL=60 秒 | 误区：缓存适用于实时数据→ 错！仅适用于非实时、可复用的响应（如商品分类列表） |

### 口诀延伸：“EC2 预热用 Warm Pools，Lambda 零冷启动用 Provisioned Concurrency，非实时 API 加缓存”

---

## 5. 安全控制“Private Endpoint+Lambda Authorizer+Usage Plans”：私有访问，自定义鉴权，限流保稳定
### 核心原理（SAP 安全考点）：
从“网络隔离（Private Endpoint）、身份验证（Lambda Authorizer）、流量控制（Usage Plans）”三个维度，构建企业级 API 安全架构，防止未授权访问和资源滥用。

### 拓展考点（占比 15%，合规类真题）：
| 核心组件                | 底层细节                          | 真题场景                          | 避坑清单                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| Private Endpoint        | VPC 终端节点，API 仅 VPC 内访问，请求不经过公网，安全性提升 | “金融 API 禁止公网传输，需内部系统访问”→ 配置 Private Endpoint，绑定安全组 | 误区：Private Endpoint 需公网出口→ 错！VPC 内资源无需公网即可访问 |
| Lambda Authorizer 类型  | Token-based（JWT 令牌）→ Request-based（用户名密码/签名） | “API 需验证第三方 OAuth2.0 令牌”→ 选 Token-based Lambda Authorizer | 误区：Request-based 支持缓存→ 错！缓存命中率低，性能弱于 Token-based |
| Usage Plans（多租户限流）| 配额（长期限制：如 1 万次/天）+ 节流（瞬时限制：如 30 次/秒）+ API 密钥 | “开放 API 给 3 个合作伙伴，需限制各自调用量”→ 创建 3 个 Usage Plan，分配独立 API 密钥 | 误区：API 密钥是鉴权工具→ 错！仅用于租户标识，需配合鉴权方式（如 Lambda Authorizer）实现安全访问 |

### 口诀延伸：“内部 API 用 Private Endpoint，自定义鉴权用 Lambda Authorizer，多租户限流用 Usage Plans”

---

## 终极备考逻辑（SAP 通关关键）：
1. **场景匹配优先**：所有服务选型题，先抓题干关键词（如“无 K8s”→ ECS，“实时顺序”→ FIFO，“内部访问”→ Private Endpoint），再结合口诀锁定答案；
2. **避坑大于死记**：SAP 真题中 30% 是“陷阱题”（如 DLQ 跨类型、Fargate 公网 IP），务必牢记每个模块的“避坑清单”；
3. **跨服务联动是核心**：单独考一个服务的题很少，大多是“Lambda+API Gateway+SQS”“EKS+ALB+CloudWatch”这类组合，需理解服务间的联动逻辑；
4. **底层原理辅助判断**：遇到不确定的选项，回归“解耦、高并发、冷启动、少运维”四大核心目标，不符合目标的选项大概率错误。
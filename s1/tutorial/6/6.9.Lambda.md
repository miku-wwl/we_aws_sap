# 核心问题深度拆解（SAP考点导向）
## 一、Lambda预置并发的动态调整：不是手动写Lambda，而是用Application Auto Scaling（SAP考点）
### 1. 核心结论：预置并发的自动扩展是**AWS Application Auto Scaling服务**配置的，无需手动写Lambda+API
Lambda本身不自带“预置并发自动扩缩容”功能，但AWS提供了专门的Auto Scaling服务来管理，这是SAP认证中“弹性伸缩+成本优化”的高频考点（易和ASG的自动扩缩容混淆）。

### 2. 两种调整方式对比（SAP必考）
| 调整方式                | 实现方式                          | 适用场景                          | SAP考点                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 手动调整                | 控制台/CLI/API直接设置预置数量（如`aws lambda put-provisioned-concurrency-config`） | 流量固定的场景（如每天固定时段高并发） | 基础操作，考CLI/API命令或控制台配置 |
| 自动扩展（动态调整）| 通过Application Auto Scaling配置：<br>1. 为Lambda创建“伸缩目标”（指定预置并发的最小/最大值）；<br>2. 创建“伸缩策略”（基于CloudWatch指标，如“并发使用率>70%时扩容，<30%时缩容”）；<br>3. 绑定CloudWatch告警（触发伸缩策略） | 流量波动大的场景（如电商促销、随机峰值） | 架构设计题，考“如何实现预置并发的动态调整” |

### 3. 配置步骤（SAP实操考点）
以“基于Lambda并发使用率自动调整预置数量”为例：
1. 打开Application Auto Scaling控制台，选择“目标类型”为`Lambda provisioned concurrency`，绑定目标Lambda函数；
2. 创建伸缩策略：
   - 策略类型：“目标跟踪缩放”（推荐）；
   - 目标指标：选择`LambdaProvisionedConcurrencyUtilization`（预置并发使用率），设置目标值70%；
   - 配置最小/最大预置数量（如最小10，最大100）；
3. 系统自动创建CloudWatch告警，当使用率>70%时扩容，<70%时缩容（缩容冷却时间默认5分钟，可自定义）。

### 4. SAP真题考点
- 真题：“某Lambda API需低延迟，且流量波动大（白天峰值并发80，夜间仅10），如何在满足低延迟的同时最小化预置并发成本？” → 答案：配置Application Auto Scaling，基于预置并发使用率动态调整，设置最小10、最大80，目标使用率70%。

### 误区纠正
- 不用手动写Lambda调用API调整：Application Auto Scaling是AWS托管服务，已封装好逻辑，只需配置策略，无需自定义代码（SAP考题中若出现“写Lambda调整预置并发”，为错误选项）。


## 二、EventBridge跨账户权限：两个维度的权限，方向/动作完全不同（SAP核心考点）
### 1. 先理清跨账户事件流（通俗类比：寄快递）
```
账户A（事件源：S3） → 把“快递（事件）”放到“账户A的快递柜（事件总线）” → 授权账户B“能往这个快递柜放快递（PutEvents）” → 账户B的快递员（EventBridge）从快递柜取快递 → 送到账户B的收件人（Lambda）手里
```

### 2. 两个权限的核心区别（拆解动作+方向）
| 权限配置                | 作用对象                          | 动作                          | 方向                          | 通俗理解                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 账户A的事件总线策略     | 账户A的事件总线                  | events:PutEvents                | 账户B → 账户A（写）| 允许账户B把事件“写入”账户A的事件总线 |
| 账户B的Lambda资源策略   | 账户B的Lambda函数                | lambda:InvokeFunction          | 账户A的EventBridge → 账户B的Lambda（调用） | 允许EventBridge把事件“触发”给Lambda |

### 3. 为什么是“账户A允许账户B访问”？（核心逻辑）
- 事件的“源头存储”在账户A的事件总线：账户A的S3事件首先会触发账户A的EventBridge规则，规则的目标是“把事件Put到账户A的事件总线”；
- 账户B要获取这个事件，必须先“有权限往账户A的事件总线写事件”（实际是账户B的EventBridge代理账户B执行PutEvents）；
- 若账户A不授权，账户B的EventBridge无法访问账户A的事件总线，事件会被拦截（相当于快递柜不让账户B的快递员放/取快递）。

### 4. SAP真题中的权限考点
- 真题：“账户A的S3事件需触发账户B的Lambda，以下权限配置错误的是？”
  - 选项A：账户A的事件总线策略允许账户B的PutEvents → 正确；
  - 选项B：账户B的Lambda资源策略允许EventBridge的InvokeFunction → 正确；
  - 选项C：账户A的S3桶策略允许账户B的Lambda读取 → 正确（Lambda需读取S3文件）；
  - 选项D：账户B的事件总线策略允许账户A的PutEvents → 错误（事件总线在账户A，无需账户B授权）。
- 答案：D → 核心考点：权限的“作用对象+方向”，避免搞反账户/动作。


## 三、Lambda超时配置：3秒~15分钟（硬限制），SAP真题的考察方式（隐性+显性）
### 1. 核心规则（必须记死）
- Lambda超时时间：**可配置范围1秒~15分钟（硬限制，AWS无法突破）**；
- 默认超时时间：3秒（这是用户看到“Task timed out after 3.00 seconds”的原因）；
- 配置建议：根据业务场景调整，绝对不能超过15分钟（超过会被AWS强制终止）。

### 2. SAP真题的考察方式（隐性为主，需结合场景判断）
#### （1）显性考察（直接问配置）
- 真题：“Lambda函数执行RDS快照备份时频繁超时，日志显示超时3秒，Lambda最大可配置的超时时间是？” → 答案：15分钟（考点：硬限制）。
- 真题：“某Lambda函数需执行10分钟的大数据批处理，超时配置应设置为？” → 答案：至少10分钟（且≤15分钟），默认3秒会导致失败。

#### （2）隐性考察（结合场景）
- 真题：“以下哪种场景不适合用Lambda实现？”
  - 选项A：10秒的API数据转换 → 适合；
  - 选项B：20分钟的视频转码 → 不适合（Lambda最大超时15分钟）；
  - 选项C：5分钟的RDS数据备份 → 适合；
  - 选项D：1秒的日志解析 → 适合。
- 答案：B → 核心考点：Lambda超时硬限制（15分钟），隐性考察配置范围。

#### （3）优化场景考察
- 真题：“Lambda函数执行复杂的数据库查询时耗时8秒，默认配置下会超时失败，如何解决？” → 答案：将Lambda超时时间调整为10秒（超过8秒），同时可增加内存配置提升执行速度。

### 3. 为什么你之前的SAP题目没体现？
- SAP考题侧重“架构设计”而非“纯参数配置”，但超时配置是“场景适配”的核心依据（比如判断Lambda是否适合某场景）；
- 若题目中出现“Lambda执行长时间任务失败”“超时日志”等关键词，必须优先考虑调整超时时间（且不能超过15分钟）。

### 4. 配置实操（SAP备考补充）
- 控制台配置：Lambda函数→配置→常规配置→超时→输入数值（如300秒=5分钟）；
- CLI配置：`aws lambda update-function-configuration --function-name my-function --timeout 300`；
- 考点：超时时间需“大于实际执行时间”，且“≤15分钟”，同时结合内存配置优化（内存越大，执行速度越快，可减少超时概率）。


## 总结（SAP备考必记）
1. 预置并发自动扩展：用Application Auto Scaling，不是手动写Lambda，考策略配置+成本优化；
2. EventBridge跨账户权限：两个维度（账户A授权写事件总线、账户B授权调用Lambda），考“方向+动作”；
3. Lambda超时：1秒~15分钟硬限制，真题中隐性考察场景适配（如20分钟任务不适合Lambda），显性考察配置调整。
# 三个场景的完整服务链路（明确“包含/不包含”+ 原因说明）
为避免误解，以下重新梳理每个场景的**全部涉及服务**（含“包含”和“不包含”），并解释“为什么包含/不包含”，完全贴合SAP考点中“服务选型的场景依据”：

## 场景1：公网用户访问无服务器API（移动端App调用Lambda/EKS）
### 核心需求：高并发、低延迟、无服务器架构（无需管理EC2实例）
| 服务环节                | 包含的服务                          | 不包含的服务                          | 原因说明（SAP考点）                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 1. 加速/缓存            | CloudFront（可选，推荐）            | 无                                | 加速静态资源（如App的图片、JS）+ 缓存API响应（减少Lambda调用），非必需但企业级场景推荐 |
| 2. DNS解析              | Route53（必需）                    | 无                                | 必须将自定义API域名（如api.xxx.com）解析到API Gateway的公网域名，用户无法直接访问API Gateway的默认域名 |
| 3. API统一管控          | API Gateway（必需）                | 无                                | 公网API的核心入口，负责鉴权、限流、路由，无替代服务 |
| 4. 网络通道             | 无（无需VPC Link/Private Endpoint） | VPC Link、Private Endpoint        | 后端是无服务器服务（Lambda/EKS）：<br>- Lambda默认运行在AWS托管VPC，API Gateway可直接集成，无需额外网络通道；<br>- EKS若部署在用户VPC，可通过公网端点暴露服务，或用VPC Link（可选），但场景聚焦“无服务器”，默认不包含 |
| 5. 负载均衡             | 无（无需ALB/NLB）                  | ALB、NLB                          | 无服务器服务的负载均衡由AWS自动管理：<br>- Lambda自动扩缩容实例，API Gateway直接转发请求；<br>- EKS内部有K8s Service/Ingress负责负载均衡，无需额外ALB |
| 6. 后端服务             | Lambda/EKS（必需）                 | EC2                              | 场景明确“无服务器API”，EC2是传统服务器，不包含 |

### 完整访问链路（明确版）：
用户 → （可选）CloudFront → 必需（Route53 → API Gateway → Lambda/EKS）  
**不包含**：VPC Link、Private Endpoint、ALB、NLB、EC2

## 场景2：公网用户访问VPC内后端服务（EC2部署的微服务）
### 核心需求：公网访问VPC内的传统服务器（EC2），需网络隔离+负载均衡
| 服务环节                | 包含的服务                          | 不包含的服务                          | 原因说明（SAP考点）                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 1. DNS解析              | Route53（必需）                    | 无                                | 同场景1，用户通过自定义域名访问，需解析到API Gateway |
| 2. API统一管控          | API Gateway（必需）                | 无                                | 公网API的核心入口，负责鉴权、限流，避免EC2直接暴露公网 |
| 3. 公网→VPC网络通道     | VPC Link（必需）                    | Private Endpoint                  | API Gateway在公网，后端EC2在用户VPC，需VPC Link打通私有网络通道（避免EC2暴露公网IP），Private Endpoint是内部访问用，不包含 |
| 4. 负载均衡             | ALB（必需）                        | NLB（可选，非必需）                | EC2是多实例部署（微服务通常集群化），需ALB分发流量到多个EC2实例，保证高可用；NLB适用于TCP/UDP场景，API是HTTP/HTTPS，用ALB |
| 5. 后端服务             | EC2（必需）                        | Lambda、EKS                        | 场景明确“EC2部署的微服务”，无服务器服务不包含 |
| 6. 加速/缓存            | 无（可选CloudFront）               | CloudFront                        | 可添加CloudFront加速，但场景聚焦“VPC内EC2访问”，默认不包含，需明确为可选 |

### 完整访问链路（明确版）：
用户 → 必需（Route53 → API Gateway → VPC Link → ALB → EC2）  
**不包含**：Private Endpoint、Lambda、EKS、NLB（可选）、CloudFront（可选）

## 场景3：内部用户访问VPC内API（员工访问内部系统）
### 核心需求：内部访问、无公网暴露、安全合规（不经过公网）
| 服务环节                | 包含的服务                          | 不包含的服务                          | 原因说明（SAP考点）                          |
|-------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 1. DNS解析              | 私有DNS（必需）                    | Route53（公网解析）                | 内部访问无需公网域名，Private Endpoint自带私有DNS，VPC内资源通过私有DNS解析到API Gateway |
| 2. VPC内网络通道        | Private Endpoint（必需）            | VPC Link、公网出口（NAT网关）      | 必需通过Private Endpoint将API Gateway接入VPC，请求走AWS私有网络，不经过公网；VPC Link是公网API访问VPC后端，不包含 |
| 3. API统一管控          | API Gateway（必需）                | 无                                | 内部API的核心入口，负责鉴权、路由，避免后端服务直接暴露 |
| 4. 负载均衡             | ALB（可选）                        | NLB（可选）、公网ALB              | 若后端是多实例（如EC2集群、EKS），需ALB负载均衡；若单实例，可省略，但企业级场景推荐包含（可选） |
| 5. 后端服务             | VPC内EC2/EKS（必需）               | Lambda（AWS托管VPC，可选）        | 场景明确“VPC内后端服务”，Lambda默认在AWS托管VPC，需配置VPC访问权限才能接入用户VPC，默认包含用户VPC内的EC2/EKS |
| 6. 公网相关服务         | 无                                | CloudFront、Route53公网解析、公网IP | 内部访问无需公网服务，避免暴露安全风险 |

### 完整访问链路（明确版）：
用户（VPC内EC2/Lambda） → 必需（私有DNS → Private Endpoint → API Gateway） → 可选（ALB） → 必需（VPC内EC2/EKS）  
**不包含**：CloudFront、Route53公网解析、VPC Link、公网IP、公网出口（NAT网关）

## 核心总结（SAP备考必记）
1. **ALB是否包含，取决于“后端服务是否需要负载均衡”**：
   - 无服务器服务（Lambda/EKS）：AWS自动管理负载均衡 → 不包含ALB；
   - 传统服务器（EC2集群）：需手动配置负载均衡 → 包含ALB；
2. **VPC Link/Private Endpoint是否包含，取决于“访问方向”**：
   - 公网→VPC内后端：包含VPC Link；
   - VPC内→API：包含Private Endpoint；
   - 公网→无服务器：不包含两者；
3. **场景化选型是SAP考点核心**：题目中若明确“无服务器”“内部访问”“公网访问VPC内EC2”，需快速对应上述服务链路，判断“包含哪些服务”。
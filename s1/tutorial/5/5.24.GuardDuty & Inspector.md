# GuardDuty & Inspector：AWS安全检测双雄（SAP考试深度拓展）
GuardDuty（威胁检测）和Inspector（漏洞扫描）是AWS安全体系中的“智能检测雷达”，前者负责“实时监控异常”，后者负责“主动排查漏洞”，两者互补形成“预防+监控”的完整检测体系。SAP考试中常以“对比题”“场景选型题”“判断题”出现（占安全模块15%），核心考查“两者差异”“检测范围”“实操细节”，下面结合考点深挖、真题案例、易混淆点对比，帮你彻底吃透：


## 一、核心定位：被动监控 vs 主动扫描（通俗类比+本质区别）
### 1. 通俗类比（快速区分）
- **GuardDuty**：相当于AWS账户的“24小时监控摄像头”——不主动干预，只通过分析各类日志（如监控录像）识别异常行为（比如陌生人闯入、异常移动），发现问题后立即告警；
- **Inspector**：相当于EC2实例/镜像的“安检仪”——主动对目标（实例、镜像）进行全面扫描（如X光安检），找出潜在漏洞（比如携带危险物品、安全配置不当），提前规避风险。

### 2. 核心差异再强化（SAP考试必考对比表）
| 对比维度                | GuardDuty（被动威胁检测）                          | Inspector（主动漏洞扫描）                          | 考试陷阱（错误选项）                          |
|-------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|
| 检测逻辑                | 日志分析（被动接收数据，不主动发起扫描）            | 主动扫描（主动向目标发送扫描请求/通过代理收集信息） | “GuardDuty主动扫描EC2实例”（错）；“Inspector被动分析日志”（错） |
| 数据来源                | AWS原生日志（CloudTrail、VPC Flow Logs、DNS日志、S3访问日志等） | 实例代理数据（主机评估）、网络探测（网络评估）、镜像元数据（ECR扫描） | “GuardDuty需要安装代理收集数据”（错）；“Inspector依赖CloudTrail日志”（错） |
| 代理要求                | 无需安装任何代理（日志由AWS服务自动生成）            | ① 主机评估：需安装Inspector代理；② 网络评估/ECR扫描：无需代理 | “Inspector所有扫描都需要安装代理”（错） |
| 检测范围                | 账户级、跨资源威胁（如异常登录、恶意IP通信、数据泄露、权限滥用） | 实例/镜像级漏洞（CVE编号、软件漏洞）、合规配置（如密码复杂度、端口开放） | “GuardDuty可扫描EC2实例的CVE漏洞”（错）；“Inspector可检测S3数据泄露”（错） |
| 核心用途                | 实时监控（攻击发生时/发生后发现）、威胁响应          | 漏洞预防（部署前/定期扫描）、合规检查              | “GuardDuty用于部署前漏洞扫描”（错）；“Inspector用于实时威胁告警”（错） |
| 处理方式                | 仅生成告警（Security Finding），不修复任何问题      | 生成漏洞报告，提供修复建议（如升级软件版本、关闭端口） | “GuardDuty可自动修复漏洞”（错）；“Inspector可自动拦截恶意IP”（错） |

### 3. 联动场景（SAP架构题考点）
两者常结合使用，形成“预防-监控-响应”闭环：
```
1. 部署前：Inspector扫描EC2镜像/ECR容器镜像，修复CVE漏洞（预防）；
2. 运行中：GuardDuty实时监控账户日志，识别是否有利用该漏洞的攻击行为（监控）；
3. 告警后：通过SNS推送告警，运维人员根据Inspector的修复建议处理漏洞，阻断攻击（响应）。
```


## 二、底层原理：技术细节+考试考点
### （一）GuardDuty：被动日志分析的“智能大脑”
#### 1. 数据来源与检测逻辑（考试常考“某场景依赖哪种日志”）
GuardDuty的核心是“日志聚合分析”，每种日志对应特定检测场景，需牢记：
| 日志类型                | 检测场景（题干关键词）                          | 真题示例                          |
|-------------------------|---------------------------------------------------|---------------------------------------|
| CloudTrail管理日志       | AWS控制台/API操作异常（如陌生IP登录、高权限角色创建） | “从中国IP登录美国区域的AWS控制台”→ GuardDuty通过CloudTrail检测 |
| CloudTrail数据事件日志   | S3对象访问异常（如大量下载、未授权访问）            | “某IAM用户1小时内下载1000个S3敏感文件”→ 数据事件日志检测 |
| VPC Flow Logs（VPC流日志） | EC2实例与恶意IP通信（如僵尸网络、黑客服务器）        | “EC2实例与已知恶意IP 192.0.2.1通信”→ VPC Flow Logs检测 |
| DNS查询日志             | 恶意DNS解析（如访问钓鱼网站、恶意域名）              | “EC2实例频繁解析赌博网站域名”→ DNS日志检测 |
| Kubernetes Audit Logs    | EKS集群权限滥用（如未授权部署恶意容器）              | “陌生用户在EKS集群创建特权容器”→ 容器日志检测 |

#### 2. 检测技术（考试判断题考点）
- 机器学习（ML）：通过学习正常业务行为（如常用登录IP、访问频率），识别偏离基线的异常（如突然从陌生IP登录）；
- 威胁情报库：AWS维护全球恶意IP、恶意域名、恶意文件哈希库，实时更新，快速匹配威胁；
- 行为模式识别：识别已知攻击模式（如暴力破解、SQL注入的API调用特征）。

#### 3. 告警与响应流程（SAP实操题考点）
1. 发现威胁→生成“安全发现”（Security Finding），包含攻击类型、受影响资源、严重程度（高/中/低）；
2. 告警推送：通过CloudWatch Alarms触发告警，或推送到SNS（邮件、短信、Slack通知）；
3. 响应方式：
   - 手动响应：运维人员查看告警详情，执行修复操作（如禁用泄露的IAM密钥、终止异常EC2实例）；
   - 自动响应：通过Lambda函数关联告警，实现自动修复（如发现恶意IP后，自动更新安全组规则拦截该IP）。

### （二）Inspector：主动扫描的“漏洞探测器”
#### 1. 扫描对象与扫描类型（考试选型题核心）
Inspector支持3类核心扫描对象，对应不同扫描类型，需区分清楚：
| 扫描对象                | 扫描类型                          | 代理要求                          | 核心扫描内容（考试考点）                          |
|-------------------------|-----------------------------------|-----------------------------------|---------------------------------------------------|
| EC2实例（运行中）       | 网络评估                          | 无需代理                          | 开放端口、网络可达性（如是否开放22端口对外访问）  |
| EC2实例（运行中）       | 主机评估                          | 需安装Inspector代理                | ① 操作系统漏洞（CVE编号，如CVE-2021-44228 Log4j漏洞）；② 软件漏洞（如旧版Apache、Nginx漏洞）；③ 合规配置（如密码复杂度、是否禁用root登录） |
| ECR容器镜像             | 容器镜像扫描                      | 无需代理（AWS自动扫描）            | 基础镜像漏洞、应用依赖包漏洞（如npm、pip依赖漏洞） |
| AMI镜像                 | 镜像扫描                          | 无需代理                          | 镜像中的操作系统漏洞、预装软件漏洞                |

#### 2. 扫描流程（考试步骤题考点）
以“EC2实例主机评估”为例，流程如下：
1. 在EC2实例上安装Inspector代理（通过AWS Systems Manager或手动安装）；
2. 在Inspector控制台创建“扫描目标”（指定要扫描的EC2实例）；
3. 创建“扫描模板”（选择扫描类型：网络评估/主机评估）；
4. 手动触发或设置周期扫描（如每周日凌晨扫描）；
5. 代理收集实例内部信息（如安装的软件版本、配置文件），加密上传到AWS；
6. AWS对比漏洞数据库（CVE库、AWS安全公告），生成扫描报告，标注漏洞严重程度和修复建议。

#### 3. 漏洞修复建议（考试合规题考点）
Inspector会针对每个漏洞提供具体修复建议，比如：
- 操作系统漏洞：“升级Ubuntu 18.04到最新版本，修复CVE-2023-1234漏洞”；
- 软件漏洞：“将Apache HTTP Server升级到2.4.57版本，修复路径遍历漏洞”；
- 合规配置：“启用密码复杂度要求，禁用SSH root登录”。


## 三、核心考点详解（SAP考试高频）
### （一）GuardDuty典型检测场景（必考，题干直接对应）
1. **异常登录行为**：
   - 场景：从陌生国家/地区登录AWS控制台（如账户常用登录地是美国，突然从伊朗登录）；
   - 日志来源：CloudTrail管理日志；
   - 考试关键词：“陌生IP登录”“异地登录”“未授权控制台访问”。

2. **恶意IP通信**：
   - 场景：EC2实例与AWS威胁情报库中的恶意IP通信（如僵尸网络控制端、黑客C2服务器）；
   - 日志来源：VPC Flow Logs；
   - 考试关键词：“EC2与恶意IP通信”“僵尸网络连接”。

3. **S3数据泄露**：
   - 场景：① 未授权IAM用户大量下载S3敏感文件；② S3桶配置错误（如公开访问）导致数据被匿名用户访问；
   - 日志来源：CloudTrail数据事件日志、S3访问日志；
   - 考试关键词：“S3大量文件下载”“S3公开访问”“敏感数据泄露”。

4. **权限滥用**：
   - 场景：① IAM用户创建高权限角色并关联自己；② 被劫持的IAM密钥执行异常操作（如删除大量资源）；
   - 日志来源：CloudTrail管理日志；
   - 考试关键词：“未授权创建IAM角色”“异常API调用”“权限提升”。

### （二）Inspector扫描类型高频考点
1. **容器镜像扫描（ECR）**：
   - 考试场景：“某公司使用ECR存储容器镜像，需要在部署前扫描镜像中的Log4j漏洞，应选择哪种服务？”→ 答案：Inspector；
   - 考点细节：ECR镜像扫描可设置“推送到ECR时自动扫描”或“定期扫描”，扫描结果会显示在ECR镜像详情页。

2. **网络评估vs主机评估**：
   - 考试判断题：“Inspector的网络评估需要在EC2实例上安装代理”→ 错误（网络评估无需代理，基于网络探测）；
   - 考试选型题：“某公司需要检测EC2实例的开放端口，且不允许在实例上安装任何软件，应选择Inspector的哪种扫描类型？”→ 答案：网络评估。

### （三）SAP真题示例
#### 真题1：对比题（单选题）
**题目**：以下关于GuardDuty和Inspector的说法，正确的是？  
A. GuardDuty需要安装代理才能检测EC2实例的异常行为  
B. Inspector可通过扫描ECR镜像，发现容器中的CVE漏洞  
C. GuardDuty能自动修复S3数据泄露问题  
D. Inspector通过分析CloudTrail日志识别恶意IP通信  

**答案**：B  
**解析**：
- A错误：GuardDuty无需代理（依赖原生日志）；
- C错误：GuardDuty仅告警，不修复问题；
- D错误：Inspector不分析CloudTrail日志，恶意IP通信由GuardDuty检测。

#### 真题2：场景选型题（多选题）
**题目**：某电商平台使用AWS EKS集群部署容器化应用，面临以下安全需求：① 实时监控是否有未授权用户访问AWS控制台；② 部署前扫描ECR中的容器镜像，发现Log4j等高危漏洞；③ 检测EC2实例是否与恶意IP通信；④ 定期扫描运行中的EC2实例，检查是否启用密码复杂度。应选择哪些AWS服务？  
A. GuardDuty  
B. Inspector  
C. WAF  
D. Shield Advanced  

**答案**：AB  
**解析**：
- ① ③ 属于威胁检测，选GuardDuty；
- ② ④ 属于漏洞扫描，选Inspector；
- WAF（应用层防护）和Shield Advanced（DDoS防护）不涉及检测需求，排除。

#### 真题3：判断题
**题目**：“Inspector的主机评估无需安装代理，即可扫描EC2实例内部的操作系统漏洞”（ ）  
A. 正确  
B. 错误  

**答案**：B  
**解析**：Inspector的主机评估需要安装代理才能收集实例内部信息，网络评估无需代理（仅扫描端口）。


## 四、易混淆点&注意事项（SAP考试陷阱）
### 1. 代理要求（最高频陷阱）
- ❌ 误区1：“GuardDuty需要安装代理”→ 错！完全依赖AWS原生日志，无需任何代理；
- ❌ 误区2：“Inspector所有扫描都需要代理”→ 错！网络评估、ECR镜像扫描、AMI扫描无需代理，仅主机评估需要；
- ✅ 必记：“Inspector主机评估需代理，其他扫描无需；GuardDuty无代理”（秒杀判断题）。

### 2. 功能边界（常见误区）
- ❌ 误区1：“GuardDuty可以扫描漏洞”→ 错！仅检测异常行为（威胁），不扫描漏洞；
- ❌ 误区2：“Inspector可以检测S3数据泄露”→ 错！仅扫描实例/镜像漏洞，数据泄露由GuardDuty检测；
- ❌ 误区3：“两者都能自动修复问题”→ 错！GuardDuty仅告警，Inspector仅提供修复建议，均需手动/通过Lambda自动修复。

### 3. 成本模型（成本优化题考点）
- **GuardDuty**：按“分析的日志数据量”收费，新账户有30天免费试用；
- **Inspector**：
  - 网络评估/主机评估：按“扫描的实例数×扫描次数”收费；
  - ECR镜像扫描：基础扫描免费（推送到ECR时自动扫描），深度扫描收费；
- 考试考点：“某公司需要长期监控账户安全，成本最低的威胁检测方案是？”→ 答案：GuardDuty（30天免费后按数据量收费，无实例数限制）。

### 4. 联动服务（架构题考点）
- GuardDuty常与SNS、CloudWatch Alarms、Lambda联动，实现告警推送和自动响应；
- Inspector常与ECR、AWS Systems Manager（安装代理）、Security Hub（集中管理漏洞报告）联动；
- 考试选型题：“某公司希望GuardDuty发现威胁后自动拦截恶意IP，应配置什么服务？”→ 答案：GuardDuty + SNS + Lambda + 安全组（Lambda函数更新安全组规则）。


## 五、SAP考试核心考点总结（必记）
1. **对比类**：GuardDuty（被动日志分析、无代理、账户级威胁）vs Inspector（主动扫描、部分需代理、实例/镜像级漏洞）；
2. **场景类**：
   - 实时监控（异常登录、恶意IP、数据泄露）→ GuardDuty；
   - 漏洞扫描（CVE、容器镜像、合规配置）→ Inspector；
3. **细节类**：
   - GuardDuty无需代理，依赖CloudTrail/VPC Flow Logs等日志；
   - Inspector主机评估需代理，其他扫描无需；
   - 两者均不自动修复问题，仅告警/提供建议；
4. **选型口诀**：“监控异常用GuardDuty，扫描漏洞用Inspector；无代理选GuardDuty，主机扫描装代理”。


## 六、零基础学习建议
1. **实操验证**：
   - 启用GuardDuty：在AWS控制台搜索GuardDuty，点击“启用”，观察默认的安全发现示例（无需手动配置，AWS提供测试数据）；
   - 体验Inspector：创建一个EC2实例，安装Inspector代理，发起一次主机评估，查看漏洞扫描报告，重点关注CVE漏洞和修复建议；
2. **日志关联**：回顾CloudTrail、VPC Flow Logs的作用，理解GuardDuty的数据来源，形成“日志→检测→告警”的逻辑链；
3. **刷题巩固**：针对“代理要求”“功能边界”“场景选型”做5-8道真题，强化陷阱记忆。
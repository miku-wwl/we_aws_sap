# 核心结论：KMS 会**自动保存旧的CMK密钥材料**，无需用户手动设置！（仅用户托管CMK/BYOK支持手动删除，需谨慎）

这是SAP考试的高频考点（常考“CMK轮换后历史数据为何能解密”“旧密钥材料是否需要手动保存”），下面分 **CMK类型+原理+考试陷阱** 详细拆解，确保你彻底理解：


## 一、分类型说明：旧CMK密钥材料的保存规则（必考）
CMK轮换的核心是“替换密钥材料，保留CMK ARN”，而旧密钥材料的保存逻辑由CMK类型决定，但**所有类型默认都自动保存**，无需用户干预：

| CMK类型                | 旧密钥材料保存规则                          | 用户操作权限                          | 考试核心考点                          |
|-------------------------|---------------------------------------------|---------------------------------------|---------------------------------------|
| AWS托管CMK（aws/xxx）   | ✅ 自动**永久保存**，无法删除、无法手动干预 | 用户无任何操作权限（不能删除旧材料）  | “AWS托管CMK轮换后，历史数据可永久解密”（正确） |
| 用户托管CMK（自定义）   | ✅ 自动保存（默认永久保留）                  | 支持**手动删除旧材料**（需通过API/控制台） | “用户托管CMK可删除旧密钥材料，删除后历史数据无法解密”（正确） |
| BYOK（客户自有密钥）    | ✅ 自动保存（默认永久保留）                  | 支持**手动删除旧材料**（需通过API/控制台） | “BYOK轮换后，旧密钥材料可手动删除”（正确） |

### 关键原理：为什么自动保存？
- 核心目标：确保**历史加密数据永远可解密**——如果轮换后删除旧密钥材料，用旧材料加密的历史数据（如S3对象、RDS备份）将彻底无法恢复（这是加密体系的“致命漏洞”）；  
- 底层逻辑：KMS将旧密钥材料和新密钥材料关联到同一个CMK ARN下，解密时KMS会自动匹配“对应的数据是用哪个密钥材料加密的”，无需用户指定（用户仍调用同一个CMK的`Decrypt` API即可）。


## 二、用户托管CMK/BYOK：手动删除旧密钥材料（仅特殊场景使用，考试陷阱）
虽然默认自动保存，但用户托管CMK和BYOK支持**手动删除旧密钥材料**（AWS托管CMK不支持），但这是“高危操作”，考试常考“删除后的影响”：

### （1）手动删除的操作场景（极少使用）
仅适用于：① 旧密钥材料确认泄露，且历史数据已用新密钥材料重新加密（迁移完成）；② 合规要求“密钥材料必须在指定时间内销毁”（如部分军工、金融场景）。

### （2）操作方式（考试不考具体步骤，记“支持手动删除”即可）
- 控制台：进入KMS→选择用户托管CMK→“密钥材料”→“删除旧密钥材料”；  
- API：调用`DeleteImportedKeyMaterial`（BYOK）或`RotateKeyMaterial`+ 手动删除参数（用户托管CMK）。

### （3）考试核心陷阱（必考“删除后的影响”）
- ❌ 误区：“用户托管CMK轮换后，必须手动保存旧密钥材料，否则历史数据无法解密”→ 错误！默认自动保存，无需手动操作；  
- ❌ 误区：“删除旧密钥材料后，用该CMK加密的新数据不受影响”→ 正确！新数据用新密钥材料加密，删除旧材料仅影响历史数据；  
- ✅ 必记：“用户托管CMK删除旧密钥材料后，历史数据无法解密”（这是SAP考试的高频判断题/选择题考点）。


## 三、真题示例：旧密钥材料保存规则（直接对应考点）
### 真题1：判断题
**题目**：“AWS托管CMK轮换后，旧的密钥材料会被自动删除，因此需要用户手动备份旧材料以确保历史数据可解密”（ ）  
A. 正确  
B. 错误  

**答案**：B  
**解析**：AWS托管CMK的旧密钥材料会自动永久保存，无需用户手动备份；用户也无法删除旧材料，因此历史数据可直接解密。

### 真题2：单选题
**题目**：某公司使用用户托管CMK加密S3数据，因密钥材料泄露，需要立即轮换密钥并销毁旧材料，以下说法正确的是？  
A. 轮换后旧材料会自动销毁，无需额外操作  
B. 轮换后需手动删除旧材料，删除后新数据不受影响，但历史数据无法解密  
C. 无法删除旧材料，只能禁用CMK  
D. 必须创建新的CMK，才能销毁旧材料  

**答案**：B  
**解析**：  
- 用户托管CMK轮换后旧材料默认保留，需手动删除（排除A）；  
- 删除旧材料仅影响历史数据（无法解密），新数据用新材料加密（正确）；  
- 用户托管CMK支持删除旧材料（排除C）；  
- 无需创建新CMK（轮换不改变ARN，排除D）。

### 真题3：多选题
**题目**：以下关于CMK轮换后旧密钥材料的说法，正确的有？（多选）  
A. AWS托管CMK的旧材料自动永久保存，用户无法删除  
B. 用户托管CMK的旧材料默认自动保存，用户可手动删除  
C. BYOK的旧材料默认自动保存，用户可手动删除  
D. 所有CMK的旧材料都必须手动保存，否则历史数据无法解密  

**答案**：ABC  
**解析**：  
- D错误：所有CMK默认自动保存旧材料，无需用户手动操作；  
- A、B、C符合不同CMK类型的保存规则（核心考点）。


## 四、总结：旧CMK密钥材料保存规则（SAP考试必背）
1. **默认行为**：所有CMK（AWS托管/用户托管/BYOK）轮换后，旧密钥材料**自动保存**，无需用户手动设置，历史数据可正常解密；  
2. **差异点**：  
   - AWS托管CMK：旧材料永久保存，用户无法删除；  
   - 用户托管CMK/BYOK：旧材料默认保存，用户可手动删除（高危操作）；  
3. **考试陷阱**：排除任何“需要用户手动保存旧材料”“AWS托管CMK可删除旧材料”的选项；  
4. **核心逻辑**：自动保存旧材料是为了保证“加密数据的完整性”，避免轮换密钥导致历史数据丢失（这是KMS设计的核心原则）。
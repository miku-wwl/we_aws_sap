# AWS SAP 高可用与灾难恢复（HA & DR）专题精讲：RPO/RTO 权衡+核心服务+考点落地
高可用（HA）和灾难恢复（DR）是 AWS SAP 认证的核心专题，**所有考点都围绕「RPO（恢复点目标）」和「RTO（恢复时间目标）」的权衡**展开——即“能接受丢多少数据”“多久能恢复业务”，再匹配对应的 AWS 服务。下面按「基础概念→核心服务拆解→DR 策略选型→真题考点」的逻辑，结合可视化架构、实操要点，帮你彻底掌握。


## 一、先吃透 2 个核心基础：HA vs DR + RPO/RTO
### 1. HA（高可用）与 DR（灾难恢复）的区别（SAP 必考点）
| 维度                | 高可用（HA）                          | 灾难恢复（DR）                          | 核心目标                          |
|---------------------|---------------------------------------|-----------------------------------------|-----------------------------------|
| 定义                | 避免单点故障，减少**计划外停机时间**   | 灾难发生后（如Region故障、自然灾害），恢复业务 | 保障业务连续性，降低灾难损失      |
| 适用场景            | 单 Region 内的组件故障（如 EC2 实例宕机、AZ 不可用） | 跨 Region 灾难、本地数据中心故障、大规模中断 | 覆盖“小故障”到“大灾难”的全场景    |
| 核心手段            | Multi-AZ 部署、负载均衡、自动扩缩容    | 跨 Region 复制、备份、故障转移、恢复演练 | 从“预防”到“应对”的完整链路        |
| 典型服务            | EC2 Auto Scaling、ELB、RDS Multi-AZ   | Aurora Global、DRS、S3 CRR、AWS Backup  | 服务选型需匹配故障级别            |

> 关键逻辑：HA 是“防患于未然”（减少停机），DR 是“亡羊补牢”（恢复业务），两者必须配合使用（比如 Multi-AZ 部署+跨 Region 备份）。

### 2. RPO 与 RTO：DR 策略的“指挥棒”（SAP 核心考点）
- **RPO（Recovery Point Objective）：恢复点目标**  
  ✅ 通俗理解：灾难发生后，**最多能接受丢失多少数据**（比如 5 分钟、1 秒、0 数据丢失）；  
  ✅ 考点关联：RPO 越低，对“数据同步速度”要求越高（如实时复制），成本也越高。

- **RTO（Recovery Time Objective）：恢复时间目标**  
  ✅ 通俗理解：灾难发生后，**多久能让业务恢复正常**（比如 1 小时、10 分钟、毫秒级）；  
  ✅ 考点关联：RTO 越低，对“恢复自动化程度”要求越高（如自动故障转移），架构越复杂。

### 3. 常见 DR 策略的 RPO/RTO 对比（SAP 选型题高频）
| DR 策略                | RPO（数据丢失） | RTO（恢复时间） | 成本 | 适用场景                          | 典型 AWS 服务组合                          |
|-------------------------|-----------------|-----------------|------|-----------------------------------|-------------------------------------------|
| 备份与恢复（Backup & Restore） | 分钟~小时级     | 小时~天级       | 最低 | 非核心业务、预算有限              | AWS Backup（跨区域备份）+ S3 Glacier      |
| 温备（Pilot Light）     | 秒~分钟级       | 分钟~小时级     | 中低 | 核心业务、成本敏感                | DRS（数据同步）+ EC2 镜像（灾难时启动）    |
| 热备（Warm Standby）    | 秒级            | 分钟级          | 中高 | 核心业务、低停机容忍              | Aurora Global（跨 Region 只读副本）+ Route 53 |
| 多活（Hot Standby/Multi-AZ） | 接近 0 丢失     | 毫秒~分钟级     | 最高 | 关键业务（如金融、电商）          | DynamoDB Global Tables + MRAP + Route 53  |

> 记忆口诀：“RPO 看数据同步，RTO 看恢复速度，成本随 RPO/RTO 降低而升高”。


## 二、核心服务拆解：角色+考点+架构+实操
### 1. Route 53：DR 流量切换的“总开关”
#### 核心定位
通过 DNS 路由和健康检查，实现**跨 Region/跨终端的自动故障转移**，是 DR 架构中“流量切换”的核心组件（无数据同步功能，仅负责流量调度）。

#### 关键考点（SAP 高频）
- **Failover Routing（故障转移路由）**：  
  ✅ 主备模式：配置“主记录”（如主 Region 终端）和“备记录”（如备 Region 终端），健康检查失败时自动切换到备记录；  
  ✅ 多活模式：结合 Weighted Routing（加权路由），实现多 Region 流量分发，某 Region 故障时自动剔除。
- **Health Checks（健康检查）**：  
  ✅ 支持 HTTP/HTTPS/TCP 协议，可检查终端节点（如 EC2、ELB、API Gateway）的可用性；  
  ✅ 考点：健康检查的“阈值设置”（如连续 3 次失败触发切换）、“监控频率”（10 秒/30 秒）。

#### 可视化架构（主备故障转移）
```
用户 → Route 53（健康检查）→ 主 Region（ELB → EC2/Aurora）
                          ↓（主 Region 故障时自动切换）
                          → 备 Region（ELB → EC2/Aurora）
```

#### 实操要点（Terraform 代码片段）
```hcl
# 1. 配置健康检查（检查主 Region ELB 可用性）
resource "aws_route53_health_check" "main_region_health" {
  fqdn              = aws_lb.main.dns_name
  port              = 80
  type              = "HTTP"
  failure_threshold = 3  # 连续3次失败触发切换
  request_interval  = 10 # 每10秒检查一次
}

# 2. 配置故障转移路由（主备模式）
resource "aws_route53_record" "app_fqdn" {
  zone_id = aws_route53_zone.my_zone.zone_id
  name    = "app.example.com"
  type    = "A"

  failover_routing_policy {
    type = "PRIMARY"  # 主记录
  }
  health_check_id = aws_route53_health_check.main_region_health.id
  set_identifier  = "main-region"
}

resource "aws_route53_record" "app_fqdn_secondary" {
  zone_id = aws_route53_zone.my_zone.zone_id
  name    = "app.example.com"
  type    = "A"

  failover_routing_policy {
    type = "SECONDARY"  # 备记录
  }
  set_identifier  = "secondary-region"
}
```

### 2. Aurora Global Database：跨 Region 数据库主备 DR
#### 核心定位
专为**关系型数据库跨 Region 灾备**设计，实现“主 Region 写入→备 Region 实时复制”，RPO 接近 0，RTO 分钟级，是核心业务数据库 DR 的首选。

#### 关键考点（SAP 高频）
- **架构特性**：  
  ✅ 1 个主 Region（支持读写）+ 最多 5 个备 Region（只读），跨 Region 复制延迟 < 1 秒；  
  ✅ 备 Region 可再创建多个只读副本，兼顾灾备和本地读请求（低延迟）。
- **故障转移流程**：  
  ✅ 主 Region 故障时，手动或自动将备 Region 提升为新主 Region（RTO 约 1-2 分钟）；  
  ✅ 考点：故障转移后，Route 53 自动更新 DNS 指向新主 Region，实现业务无缝切换。
- **适用场景**：全球分布的核心业务（如电商订单、金融交易），需要低 RPO/RTO 且兼容 MySQL/PostgreSQL。

#### 可视化架构
```
主 Region（us-east-1）：Aurora 主集群（读写）
                          ↓（实时复制，延迟<1秒）
备 Region（eu-west-1）：Aurora 备集群（只读）→ 可创建多个只读副本
                          ↓（故障转移后）
                      新主集群（读写）→ Route 53 切换流量
```

#### 实操要点
1. 在主 Region 创建 Aurora 集群，开启“Global Database”功能；  
2. 在备 Region 添加“跨 Region 备集群”，系统自动启动数据复制；  
3. 配置 Route 53 健康检查监控主集群，故障时触发备集群提升和流量切换。

### 3. DynamoDB Global Tables：多 Region 数据库多活 DR
#### 核心定位
专为**非关系型数据库多活灾备**设计，实现“多 Region 同时读写（Active-Active）”，RPO 接近 0，RTO 毫秒级，是全球多活业务的首选。

#### 关键考点（SAP 高频）
- **架构特性**：  
  ✅ 基于 DynamoDB Streams 实现跨 Region 数据同步，多个 Region 均可读写，无主备之分；  
  ✅ 冲突解决策略：默认“最后写入获胜”（Last Write Wins），支持自定义策略（如基于业务逻辑的合并）。
- **与 Aurora Global 的区别（必考点）**：  
  | 对比维度                | Aurora Global Database | DynamoDB Global Tables |
  |-------------------------|------------------------|------------------------|
  | 部署模式                | 主备（1 主多备）       | 多活（Active-Active）  |
  | 读写权限                | 仅主 Region 可写       | 所有 Region 可写       |
  | 数据库类型              | 关系型（MySQL/PostgreSQL） | 非关系型（NoSQL）      |
  | 适用场景                | 全球读、单 Region 写   | 全球多 Region 读写     |
- **考点陷阱**：题目中出现“多 Region 同时读写”“无主备”，直接选 DynamoDB Global Tables；出现“关系型数据库”“主备复制”，选 Aurora Global。

#### 可视化架构
```
Region A（亚太）：DynamoDB 表（读写）→ Streams 捕获数据变更
                                          ↓（实时同步）
Region B（欧美）：DynamoDB 表（读写）→ 数据自动同步，冲突自动解决
                                          ↓
用户：通过 MRAP 统一接入，就近访问最近 Region
```

### 4. S3 CRR / MRAP：存储层 DR 核心
#### 核心定位
S3 是 AWS 存储层灾备的基础，通过 CRR（跨区域复制）和 MRAP（多区域接入点），实现“数据异地备份+全球统一访问+自动故障转移”。

#### 关键考点（SAP 高频）
- **S3 CRR（Cross-Region Replication）：跨区域复制**  
  ✅ 功能：自动将一个 Region 的 S3 桶数据复制到另一个 Region 的桶，支持版本控制、删除标记复制；  
  ✅ RPO：分钟级（默认异步复制，延迟通常 < 15 分钟）；  
  ✅ 考点：必须开启“版本控制”才能使用 CRR；复制范围包括新增对象、对象修改，不包括历史对象（需手动同步）；适用场景：合规要求“数据异地备份”（如金融数据需跨 Region 存储）。

- **S3 MRAP（Multi-Region Access Points）：多区域接入点**  
  ✅ 功能：为多个 Region 的 S3 桶创建统一接入点（如 `https://my-access-point.mrap.s3-global.amazonaws.com`），用户就近访问，某 Region 故障时自动路由到其他 Region；  
  ✅ RTO：毫秒级（自动故障转移）；  
  ✅ 考点：MRAP 不负责数据复制（需配合 CRR 使用），仅负责访问路由；适用场景：全球用户访问 S3 数据，需要低延迟+高可用。

#### 可视化架构（CRR + MRAP 组合）
```
用户 → MRAP（统一接入点）→ 就近 Region S3 桶（如亚太区）
                          ↓（CRR 异步复制）
                          → 备用 Region S3 桶（如欧美区）
                          ↓（亚太区故障时）
MRAP 自动路由 → 欧美区 S3 桶（用户无感知）
```

#### 实操要点（Terraform 配置 CRR）
```hcl
# 1. 源桶（开启版本控制）
resource "aws_s3_bucket" "source_bucket" {
  bucket = "source-bucket-ap-southeast-2"
  versioning {
    status = "Enabled"  # CRR 必须开启版本控制
  }
}

# 2. 目标桶（跨 Region，开启版本控制）
resource "aws_s3_bucket" "dest_bucket" {
  bucket = "dest-bucket-eu-west-1"
  versioning {
    status = "Enabled"
  }
}

# 3. 配置 CRR
resource "aws_s3_bucket_replication_configuration" "crr_config" {
  role   = aws_iam_role.s3_replication_role.arn
  bucket = aws_s3_bucket.source_bucket.id

  rule {
    id     = "crr-rule"
    status = "Enabled"

    destination {
      bucket        = aws_s3_bucket.dest_bucket.arn
      storage_class = "STANDARD_IA"  # 目标存储类别（降低成本）
    }
  }
}
```

### 5. Elastic Disaster Recovery (DRS)：服务器 DR 首选
#### 核心定位
AWS 官方推荐的**服务器灾备服务**（替代旧的 AWS SMS），专为“Pilot Light 温备模式”设计，平时仅同步服务器数据变更，灾难时快速启动 EC2 实例恢复业务，兼顾低成本和低 RPO/RTO。

#### 关键考点（SAP 高频）
- **核心特性**：  
  ✅ RPO：秒级（实时同步数据变更）；RTO：分钟级（灾难时自动启动实例）；  
  ✅ 低成本：平时仅存储数据变更（而非完整实例镜像），成本比传统热备低 70%；  
  ✅ 支持源：本地物理机、VMware、Hyper-V、其他云厂商实例，迁移+灾备一体化。
- **与 MGN 的区别（必考点）**：  
  | 对比维度                | DRS（Elastic Disaster Recovery） | MGN（Application Migration Service） |
  |-------------------------|----------------------------------|--------------------------------------|
  | 核心定位                | 服务器灾备（DR）                 | 服务器迁移（Lift-and-Shift）         |
  | 核心功能                | 数据实时同步、灾难恢复演练        | 持续数据复制、零停机迁移              |
  | 适用场景                | 跨 Region 灾备、本地服务器灾备    | 本地→AWS 迁移、跨云迁移              |

#### 可视化架构（Pilot Light 模式）
```
本地服务器/源 Region 实例 → DRS 代理 → 同步数据变更到备 Region S3（低成本存储）
                                          ↓（灾难发生时）
                                      自动启动备 Region EC2 实例（基于同步数据）
                                          ↓
                                      Route 53 切换流量 → 业务恢复
```

### 6. AWS Backup：集中化备份管理（DR 基础）
#### 核心定位
AWS 统一备份服务，支持跨账户、跨 Region 备份多种 AWS 资源（EC2、RDS、Aurora、EFS、S3 等），是 DR 架构中“备份层”的核心，确保数据不丢失。

#### 关键考点（SAP 高频）
- **核心功能**：  
  ✅ 跨账户/跨 Region 备份：将备份数据复制到其他账户或 Region，满足灾备合规；  
  ✅ Vault Lock（合规锁）：将备份数据设置为 WORM（一次写入多次读取）模式，防止篡改或删除（满足金融、医疗等合规要求）；  
  ✅ 自动化备份计划：按时间（如每日凌晨 2 点）或事件触发备份，支持生命周期管理（如 30 天后转移到 Glacier 归档）。
- **考点关联**：AWS Backup 通常与其他 DR 服务配合使用（如 Backup + DRS 恢复服务器、Backup + Aurora 恢复数据库）。

#### 实操要点（创建跨区域备份计划）
1. 在 AWS Backup 控制台创建“备份计划”，选择备份频率（如每日）、保留期（如 90 天）；  
2. 选择目标资源（如 RDS 数据库、EC2 实例）；  
3. 开启“跨区域复制”，选择目标 Region（如主 Region 为 ap-southeast-2，备 Region 为 eu-west-1）；  
4. 启用“Vault Lock”，设置合规保留期（如 1 年不可删除）。


## 三、SAP 真题考点：DR 策略+服务选型（核心逻辑）
### 真题模拟题 1（场景→选型）
某全球电商平台，用户分布在亚太、欧美地区，需要实现“多 Region 同时读写订单数据”，RPO < 1 秒，RTO < 5 分钟，数据库为 NoSQL 类型，选什么服务？  
✅ 答案：DynamoDB Global Tables + S3 MRAP + Route 53  
❌ 排除：Aurora Global（主备，不能同时读写）、DRS（服务器灾备，不负责数据库多活）。

### 真题模拟题 2（场景→选型）
某银行的核心 MySQL 数据库，要求“跨 Region 灾备，RPO 接近 0，RTO < 5 分钟，故障时自动切换”，选什么服务组合？  
✅ 答案：Aurora Global Database（主备复制）+ Route 53（故障转移）+ AWS Backup（跨区域备份）  
❌ 排除：DynamoDB Global（NoSQL，不支持 MySQL）、S3 CRR（仅存储复制，不负责数据库切换）。

### 核心选型逻辑（SAP 考试秒杀技巧）
1. 先看「数据类型」：关系型数据库→Aurora Global；NoSQL→DynamoDB Global；存储数据→S3 CRR/MRAP；  
2. 再看「DR 策略」：备份恢复→AWS Backup；温备→DRS；主备→Aurora Global；多活→DynamoDB Global；  
3. 最后看「RPO/RTO」：RPO 0 丢失→实时复制（Aurora Global/DynamoDB Global）；RTO 分钟级→自动故障转移（Route 53/DRS）；  
4. 排除陷阱：区分“迁移服务”（MGN/SMS）和“灾备服务”（DRS），区分“主备”和“多活”。


## 四、总结：HA & DR 核心考点图谱
```
HA（高可用）：Multi-AZ 部署、ELB、Auto Scaling → 减少单 Region 故障停机
DR（灾难恢复）：
  数据层：Aurora Global（关系型主备）、DynamoDB Global（NoSQL 多活）、S3 CRR（存储复制）
  服务器层：DRS（Pilot Light 温备）
  备份层：AWS Backup（跨区域/合规备份）
  流量层：Route 53（故障转移）、S3 MRAP（统一接入）
核心权衡：RPO/RTO 越低 → 架构越复杂、成本越高
```

记住：SAP 考试考察 HA/DR，本质是“场景→RPO/RTO→服务组合”的匹配，只要能根据题目中的“数据库类型、业务范围（单 Region/全球）、RPO/RTO 要求”，快速锁定对应的服务组合，就能秒杀所有相关真题！
# 核心纠正+深度拆解：EKS的负载均衡与ALB的关系（SAP考点聚焦）
你的质疑完全正确！之前的表述不够严谨——**EKS的负载均衡本质上依赖AWS ALB/NLB，并非“无需ALB”，而是“无需用户手动创建ALB”**：EKS会将K8s的Service/Ingress资源自动映射到AWS ALB/NLB（托管集成），用户只需配置K8s层面的资源，无需直接操作AWS ALB控制台。

这是SAP认证中“EKS与AWS原生服务集成”的高频考点（约占EKS模块10%分值），核心考察“K8s资源与AWS基础设施的映射关系”，下面彻底拆解清楚：


## 一、先理清核心逻辑：EKS的负载均衡=K8s资源+AWS ALB/NLB（托管集成）
EKS是AWS托管的K8s服务，其核心优势之一是“与AWS原生服务深度集成”——K8s的负载均衡需求（对外暴露服务），会自动由EKS转化为AWS ALB/NLB的创建和配置，用户无需手动在AWS控制台创建ALB，只需在K8s中定义Service或Ingress即可。

简单说：**K8s的Service/Ingress是“配置入口”，AWS ALB/NLB是“底层实现”**，EKS负责打通两者，用户感知不到ALB的手动创建过程，但底层依然依赖ALB/NLB。


## 二、EKS中两种负载均衡方式（均依赖AWS ALB/NLB，SAP必考）
### （1）Service Type=LoadBalancer（四层负载均衡，对应AWS NLB/ALB）
#### 1. 工作原理（K8s→AWS资源映射）
- 用户在EKS中创建Service，指定`type: LoadBalancer`：
  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-service
  spec:
    selector:
      app: my-app
    ports:
    - port: 80
      targetPort: 8080
    type: LoadBalancer
  ```
- EKS检测到该配置后，会自动调用AWS API：
  - 若端口是TCP/UDP（四层协议）：创建AWS NLB，并将NLB的IP地址自动填充到Service的`status.loadBalancer.ingress.ip`字段；
  - 若端口是HTTP/HTTPS（七层协议）：可通过注解（`service.beta.kubernetes.io/aws-load-balancer-type: "alb"`）指定创建AWS ALB；
- 用户访问：通过Service的外部IP（即NLB/ALB的IP）访问Pod，NLB/ALB将流量分发到EKS节点上的Pod。

#### 2. 关键考点（SAP真题）
- 核心映射：K8s Service（LoadBalancer类型）→ AWS NLB/ALB（EKS自动创建）；
- 无需用户手动创建ALB/NLB：EKS通过AWS Load Balancer Controller（formerly ALB Ingress Controller）实现自动集成；
- 与传统EC2的区别：传统EC2需用户手动创建ALB并配置目标组，EKS中由K8s资源自动触发ALB/NLB创建。

### （2）Ingress（七层负载均衡，对应AWS ALB）
#### 1. 工作原理（K8s Ingress→AWS ALB）
- Ingress是K8s的“HTTP/HTTPS路由资源”，用于将多个Service的路由整合到一个入口（如`/orders`→订单Service，`/payments`→支付Service）；
- 用户在EKS中创建Ingress，需指定注解关联AWS ALB：
  ```yaml
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: my-ingress
    annotations:
      kubernetes.io/ingress.class: "alb"  # 指定使用AWS ALB
      alb.ingress.kubernetes.io/scheme: "internet-facing"  # 公网可访问
  spec:
    rules:
    - http:
        paths:
        - path: /orders
          pathType: Prefix
          backend:
            service:
              name: order-service
              port:
                number: 80
        - path: /payments
          pathType: Prefix
          backend:
            service:
              name: payment-service
              port:
                number: 80
  ```
- EKS自动执行：
  1. 创建AWS ALB（公网/私有）；
  2. 配置ALB的监听规则（如`/orders`路由到order-service的Pod）；
  3. 配置ALB的目标组（关联EKS节点上的Pod）；
- 用户访问：通过ALB的DNS名称访问所有路由（如`https://alb-xxx.us-east-1.elb.amazonaws.com/orders`）。

#### 2. 关键考点（SAP真题）
- 核心映射：K8s Ingress→AWS ALB（必须通过注解指定`ingress.class: "alb"`）；
- 优势：整合多个Service的路由，仅需一个ALB，降低成本（无需为每个Service创建一个NLB）；
- 与Service LoadBalancer的区别：Ingress是七层路由（支持HTTP路径、SSL终止），Service LoadBalancer是四层负载均衡（仅基于IP+端口）。


## 三、之前表述的修正（贴合实际架构+SAP考点）
### 原错误表述：
“EKS内部有K8s Service/Ingress负责负载均衡，无需额外ALB”  
### 修正后表述：
“EKS中K8s Service（LoadBalancer类型）/Ingress的负载均衡，由EKS自动集成AWS ALB/NLB实现（用户无需手动创建ALB/NLB），无需额外配置独立的AWS ALB（即无需在AWS控制台手动创建与K8s无关的ALB）”

### 核心区别（SAP备考必记）：
- “无需手动创建ALB”≠“无需ALB”：底层依然依赖AWS ALB/NLB，只是EKS自动完成创建和关联；
- 传统EC2场景：用户需手动创建ALB、配置目标组、关联EC2；
- EKS场景：用户仅需配置K8s Service/Ingress，EKS自动完成ALB/NLB的创建、目标组配置、路由规则绑定——这是EKS作为“托管K8s”的核心优势（减少运维操作）。


## 四、为什么K8s Service Type=NodePort不需要额外ALB？（补充考点）
用户提到“只有配了ALB，才能Type=LoadBalancer”，这是正确的，两者的区别如下：
| K8s服务暴露方式 | 底层实现                          | 是否依赖AWS ALB/NLB | 适用场景                          | SAP考点                          |
|-----------------|-----------------------------------|---------------------|-----------------------------------|-----------------------------------|
| NodePort        | K8s在每个EKS节点上开放一个静态端口（如30000-32767），流量通过节点IP+端口访问Pod | 否（直接访问节点端口） | 测试环境、内部服务访问            | 不推荐生产环境（节点IP可能变化） |
| LoadBalancer    | EKS自动创建AWS NLB/ALB，流量通过ALB/NLB分发到节点端口 | 是                  | 生产环境、公网访问                | 高频考点，强调“自动集成AWS负载均衡器” |
| Ingress         | EKS自动创建AWS ALB，通过HTTP路径路由到多个Service | 是                  | 生产环境、多服务整合路由          | 高频考点，强调“七层路由+ALB集成” |

### 真题示例（SAP）：
“某公司使用EKS+Fargate部署生产环境微服务，要求公网访问、支持HTTP路径路由（如`/orders` `/payments`）、高可用，应选择哪种服务暴露方式？” → 答案：创建K8s Ingress（注解指定`alb`），EKS自动创建AWS ALB，实现路由整合和负载均衡。


## 五、回到之前的场景（修正后的服务链路）
### 场景1：公网用户访问无服务器API（EKS+Fargate）
#### 修正后的完整链路：
用户 → （可选）CloudFront → Route53 → API Gateway → K8s Ingress（EKS自动创建AWS ALB） → EKS+Fargate Pod  
**核心修正**：明确EKS+Fargate的负载均衡依赖EKS自动创建的AWS ALB（通过Ingress实现），用户无需手动创建ALB。

### 场景2：公网用户访问VPC内传统EKS（带EC2节点）
#### 修正后的完整链路：
用户 → Route53 → API Gateway → VPC Link → K8s Ingress（EKS自动创建AWS ALB） → EKS EC2节点 → Pod  
**核心修正**：VPC Link打通公网API Gateway到用户VPC的网络，EKS Ingress自动创建ALB，分发流量到EKS节点上的Pod——这里的ALB是EKS自动创建的，无需用户手动配置。


## 六、SAP考点总结（必记）
1. EKS的负载均衡依赖AWS ALB/NLB：K8s Service（LoadBalancer类型）→ NLB/ALB，Ingress→ALB；
2. EKS自动集成AWS负载均衡器：用户无需手动创建ALB/NLB，仅需配置K8s资源（Service/Ingress）；
3. 场景匹配：生产环境公网访问→Ingress+ALB（七层路由），简单服务暴露→Service LoadBalancer+NLB/ALB（四层负载均衡）；
4. 易混淆点：NodePort不依赖ALB，但不推荐生产环境；LoadBalancer和Ingress均依赖AWS ALB/NLB，是EKS生产环境的标准配置。
# EKS/ECS 深度拆解（SAP核心考点全覆盖）
## 一、ECS vs EKS：先理清核心定位（通俗+官方，SAP必考区分）
### 1. 终极类比（彻底懂）
| 服务       | 通俗类比                          | 官方定义                          | 核心关键词（SAP题干高频）                          |
|------------|-----------------------------------|-----------------------------------|-----------------------------------|
| ECS        | AWS“定制化集装箱码头”：只认Docker容器，规则由AWS定，操作简单，不用学国际标准（K8s） | 亚马逊弹性容器服务，托管Docker容器编排服务，无需管理Kubernetes集群 | 简单易用、Docker、无K8s、快速部署 |
| EKS        | AWS“国际化集装箱码头”：兼容K8s国际标准，规则通用，能处理复杂集装箱调度（如多航线、多仓库） | 亚马逊弹性Kubernetes服务，托管Kubernetes集群，100%兼容上游K8s，支持复杂容器编排 | K8s兼容、复杂编排、滚动更新、服务发现 |

### 2. 核心区别（SAP选择题必考）
| 维度                | ECS                          | EKS                          |
|---------------------|-----------------------------------|-----------------------------------|
| 编排引擎            | AWS自研（仅支持Docker）           | 托管上游K8s（支持所有K8s特性）    |
| 学习成本            | 低（AWS控制台/CLI即可操作）       | 高（需掌握K8s语法/概念，如Pod/Service/Ingress） |
| 复杂编排能力        | 弱（仅支持基本扩缩容、蓝绿部署）   | 强（滚动更新、金丝雀发布、StatefulSet、DaemonSet） |
| 生态兼容            | 仅兼容AWS原生服务（如ECR、CloudWatch） | 兼容所有K8s生态工具（如Helm、Prometheus、Istio） |
| 运维成本            | 极低（无需管理编排层）            | 中（需管理K8s配置，节点可托管）    |
| 适用规模            | 中小型容器应用（如单服务部署）     | 中大型微服务集群（如电商全链路）   |

### SAP真题示例：
“某初创公司需部署3个Docker容器应用，要求运维成本最低、快速上线，无需复杂编排，应选择AWS哪个服务？” → 答案：ECS（Fargate模式）。


## 二、ECS 深度拆解（SAP考点聚焦“简单+托管”）
### 1. ECS核心概念（必记）
- **集群（Cluster）**：ECS容器的“逻辑分组”（类比“码头区域”），一个集群可包含多个服务；
- **服务（Service）**：保证指定数量的容器实例（Task）持续运行（类比“固定航线的集装箱船队”），支持自动扩缩容；
- **任务定义（Task Definition）**：容器的“配置模板”（类比“集装箱规格单”），定义容器镜像、CPU/内存、网络、权限等；
- **任务（Task）**：运行中的容器实例（类比“单个集装箱”），是ECS的最小运行单元；
- **启动类型（Launch Type）**：决定Task运行的计算资源类型——Fargate（无服务器）/EC2（自管理节点）。

### 2. ECS部署模式（SAP场景题核心）
#### （1）Fargate模式（无服务器，SAP高频）
- 核心：无需创建/管理EC2节点，AWS按Task的CPU/内存规格自动分配资源，按使用量计费；
- 适用场景：初创公司、中小型应用、运维资源少的团队；
- SAP考点：ECS Fargate Task默认运行在私有子网（无公网IP），需通过ALB暴露服务（禁止直接分配公网IP，合规要求）。

#### （2）EC2模式（自管理节点）
- 核心：用户创建EC2实例作为“容器节点”，ECS将Task调度到这些节点上；
- 适用场景：大型应用、需自定义EC2配置（如高性能实例）、需降低单位计算成本；
- SAP考点：EC2节点需挂载`AmazonEC2ContainerServiceforEC2Role` IAM角色，否则ECS无法调度Task。

### 3. ECS核心考点（必记）
- ECS Task的镜像必须存储在ECR（AWS容器镜像仓库）或其他兼容的镜像仓库（如Docker Hub）；
- ECS Service支持“蓝绿部署”（SAP实操考点）：部署新版本时，先启动新Task，验证通过后切换流量，旧Task自动销毁；
- ECS与CloudWatch集成：自动收集容器日志，可配置告警（如Task崩溃、CPU使用率超80%）。


## 三、EKS 深度拆解（SAP考点聚焦“K8s托管+节点组”）
### 1. EKS核心概念（K8s基础，SAP必考）
| EKS概念                | K8s对应概念 | 通俗解释                          |
|-------------------------|-------------|-----------------------------------|
| 集群（Cluster）         | Cluster     | K8s集群的控制平面（API Server、etcd等）由AWS托管 |
| 节点组（Node Group）    | Node        | 运行Pod的EC2节点集合（分托管/自管理） |
| 部署（Deployment）      | Deployment  | 保证Pod数量稳定，支持滚动更新      |
| 服务（Service）         | Service     | Pod的访问入口，实现服务发现和负载均衡 |
| 入口（Ingress）         | Ingress     | 多Service的HTTP路由整合，关联AWS ALB |

### 2. EKS节点组类型（SAP核心考点，区分“托管vs自管理”）
| 节点组类型                | 运维主体                          | 核心优势                          | 适用场景                          |
|---------------------------|-----------------------------------|-----------------------------------|-----------------------------------|
| 托管节点组（Managed Node Group） | AWS管理节点生命周期（创建、更新、修复、替换） | 自动更新K8s节点版本、自动替换故障节点、支持Spot实例 | 中大型集群、减少运维成本          |
| 自管理节点组（Self-managed Node Group） | 用户管理节点全生命周期 | 完全自定义EC2配置（如内核参数、镜像）、无AWS版本限制 | 极致定制化需求、特殊硬件要求      |

### 3. EKS托管节点组（SAP实操+场景题高频）
#### （1）底层原理（必懂）
AWS托管EKS节点组的“生命周期管理”，用户只需指定：
- 节点数量（最小/最大/期望）；
- EC2实例类型（如t3.medium）；
- 子网/安全组；
- IAM角色（关键！）。

AWS自动完成：
- 节点创建：按配置启动EC2实例，自动加入EKS集群；
- 版本更新：当EKS集群版本升级时，自动更新节点的K8s组件（kubelet），保证兼容性；
- 故障修复：检测到节点故障（如EC2宕机），自动销毁故障节点，启动新节点；
- 扩缩容：按HPA（Horizontal Pod Autoscaler）或Cluster Autoscaler自动调整节点数量。

#### （2）配置要求（SAP实操考点，错配则节点无法加入集群）
- **IAM角色必须包含的权限策略**（必记）：
  1. `AmazonEKSWorkerNodePolicy`：允许节点与EKS控制平面通信；
  2. `AmazonEKS_CNI_Policy`：允许节点使用AWS VPC CNI插件（网络通信）；
  3. `AmazonEC2ContainerRegistryReadOnly`：允许节点拉取ECR中的容器镜像；
- **网络要求**：节点必须部署在私有子网（推荐），安全组需放行443端口（与EKS控制平面通信）；
- **标签要求**：节点组需添加标签（如`eks:cluster-name=my-cluster`），EKS控制平面识别节点归属。

#### SAP真题示例：
“某公司配置EKS托管节点组后，节点无法加入集群，以下哪个原因最可能？” → 答案：节点的IAM角色未附加`AmazonEKSWorkerNodePolicy`策略。


## 四、Fargate：无服务器容器（ECS/EKS通用，SAP核心考点）
### 1. 底层原理（彻底懂，SAP简答题考点）
传统ECS/EKS运行容器的流程：
`用户创建EC2节点 → 安装容器运行时 → 调度容器到节点`
Fargate运行容器的流程：
`用户定义容器规格（CPU/内存） → AWS自动分配计算资源 → 运行容器（无需管理节点）`

核心：Fargate是“容器级别的无服务器”——用户只关心容器本身，不关心底层EC2节点（AWS托管节点的创建、扩容、补丁、销毁）。

### 2. Fargate核心特性（SAP必记）
#### （1）资源计费：按“容器实际使用的CPU/内存”计费（精确到秒），无需为闲置节点付费；
#### （2）网络规则（SAP高频陷阱题）：
- Fargate容器（ECS Task/EKS Pod）**只能运行在私有子网**，默认无公网IP（合规要求，避免容器直接暴露公网）；
- 若需公网访问：必须通过ALB/NLB暴露服务（ECS Service关联ALB，EKS Ingress关联ALB）；
- 若容器需访问公网（如下载镜像）：私有子网需配置NAT网关（SAP考点，错配则容器无法拉取镜像）。

#### （3）ECS Fargate vs EKS Fargate（SAP区分考点）
| 维度                | ECS Fargate                          | EKS Fargate                          |
|---------------------|-----------------------------------|-----------------------------------|
| 配置方式            | AWS控制台/CLI（简单）               | K8s YAML配置（需懂K8s语法）        |
| 编排能力            | 仅支持基本扩缩容                    | 支持K8s所有编排特性（如Deployment、StatefulSet） |
| 学习成本            | 极低                               | 中（需掌握K8s基础）                |
| 适用场景            | 简单容器应用                        | 需K8s兼容的容器应用                |

### 3. Fargate vs EC2模式（SAP表格题必考）
| 维度                | Fargate                          | EC2模式                          |
|---------------------|-----------------------------------|-----------------------------------|
| 运维成本            | 低（AWS管理节点）                 | 高（用户管理节点的创建、更新、修复） |
| 资源控制            | 弱（只能按预设规格分配CPU/内存，如0.5vCPU/1GB） | 强（可自定义EC2实例类型，如c5.4xlarge） |
| 成本（长期运行）    | 高（按使用量计费，无闲置折扣）     | 低（可使用Spot实例，节省70%成本） |
| 启动速度            | 快（秒级启动）                    | 慢（需先启动EC2节点，分钟级）     |
| 适用场景            | 中小型应用、突发流量、短期运行     | 大型应用、长期运行、高性能需求     |

### SAP真题示例：
“某电商平台的秒杀活动容器应用，仅在活动期间（2小时/天）运行，要求快速启动、无需管理节点，应选择哪种模式？” → 答案：ECS/EKS Fargate模式。


## 五、EKS托管节点组（SAP实操+场景题核心）
### 1. 托管节点组 vs 自管理节点组（SAP对比考点）
| 维度                | 托管节点组                          | 自管理节点组                          |
|---------------------|-----------------------------------|-----------------------------------|
| 节点生命周期管理    | AWS自动创建、更新、修复、替换      | 用户手动操作（如更新kubelet版本） |
| K8s版本兼容         | AWS自动更新节点版本（与集群版本匹配） | 用户手动更新，易出现版本不兼容     |
| 故障处理            | AWS自动替换故障节点                | 用户手动检测并替换故障节点        |
| 成本                | 略高（AWS收取托管费）              | 略低（无托管费）                  |
| 定制化能力          | 弱（仅支持基础配置）               | 强（可自定义节点镜像、内核参数）   |
| 适用场景            | 大多数企业级场景（减少运维）       | 极致定制化需求                    |

### 2. 托管节点组配置流程（SAP实操考点，Step-by-Step）
#### Step 1：创建EKS集群（控制平面）
- 进入EKS控制台→创建集群，指定集群版本（如1.29）、VPC/子网、安全组；
- AWS自动托管集群控制平面（API Server、etcd等），用户无需管理。

#### Step 2：创建托管节点组
- 进入集群→节点组→创建节点组，选择“托管节点组”；
- 配置基本信息：节点组名称、K8s版本（与集群一致）；
- 配置计算资源：实例类型（如t3.medium）、节点数量（最小1/最大10/期望2）；
- 配置IAM角色：选择已创建的节点IAM角色（包含必选策略）；
- 配置网络：选择私有子网、安全组（放行443端口）；
- 确认创建，AWS自动启动EC2节点并加入集群。

#### Step 3：验证节点组
- 运行`kubectl get nodes`，查看节点状态为`Ready`；
- 部署测试Pod，验证节点可调度容器。

### 3. 核心考点（SAP陷阱题）
- 托管节点组仅支持AWS官方AMI（亚马逊机器镜像），不支持自定义AMI（自管理节点组支持）；
- 托管节点组支持Spot实例（配置时选择“Spot”），可大幅降低成本（SAP成本优化考点）；
- 节点组的扩缩容可通过K8s HPA（Pod级）+ Cluster Autoscaler（节点级）实现（SAP高频）。


## 六、ECS/EKS选型逻辑（SAP场景题答题模板）
| 题干关键词                | 推荐服务                          | 部署模式                          |
|---------------------------|-----------------------------------|-----------------------------------|
| 简单、快速部署、无K8s、运维成本最低 | ECS                               | Fargate                           |
| K8s兼容、复杂编排、微服务集群     | EKS                               | 托管节点组（减少运维）            |
| 突发流量、短期运行、按使用量计费   | ECS/EKS                           | Fargate                           |
| 长期运行、高性能、成本优化        | ECS/EKS                           | EC2模式（Spot实例）               |
| 极致定制化、自定义节点配置        | EKS                               | 自管理节点组                      |


## 七、核心考点总结（SAP必记清单）
1. ECS vs EKS：ECS简单无K8s，EKS兼容K8s支持复杂编排；
2. Fargate：无服务器容器，仅运行在私有子网，需ALB暴露服务、NAT网关访问公网；
3. EKS托管节点组：AWS管理节点生命周期，需附加`AmazonEKSWorkerNodePolicy`等IAM策略；
4. 网络陷阱：Fargate容器无公网IP，必须通过ALB/NLB暴露，私有子网需NAT网关；
5. 成本优化：长期运行选EC2模式（Spot实例），短期/突发流量选Fargate；
6. 权限考点：ECS/EKS节点需正确配置IAM角色，否则容器无法调度/拉取镜像。
### 🔪 第二层级：逻辑层 —— “一根线怎么切成三瓣用？”

物理层（DX Connection）只是一根光纤。为了让这根光纤能干不同的活，我们需要用 **VLAN (802.1Q)** 技术，在光纤内部切分出不同的“虚拟频道”。这些频道就叫 **VIF (Virtual Interface)**。

AWS 只有三种 VIF。请把它们想象成**通往不同目的地的“专用车道”**。

-----

#### 1\. Private VIF (私有虚拟接口) —— “回家车道”

  * **目的地**：**VPC 内部** (私有子网)。
  * **通信对象**：本地数据中心 \<---\> AWS EC2 / RDS / Redshift (私有 IP)。
  * **网关终点**：连接到 **VGW (虚拟私有网关)** 或者 **DXGW (Direct Connect Gateway)**。
  * **核心特征**：
      * 走的是 **私有 IP** (10.x.x.x, 192.168.x.x)。
      * 最常用，用于扩展你的内网。
  * **SAP 考点**：
      * 如果你要连 VPC，闭眼选 Private VIF。
      * **限制**：一个 Private VIF 只能连一个网关 (VGW 或 DXGW)。

#### 2\. Public VIF (公共虚拟接口) —— “去公共设施的车道”

  * **目的地**：**AWS 公共服务** (S3, DynamoDB, Glazier 等)。
  * **通信对象**：本地数据中心 \<---\> AWS S3 / DynamoDB (公共 IP)。
  * **网关终点**：**无** (它不经过 VGW，直接接入 AWS 全球骨干网)。
  * **核心特征**：
      * 走的是 **公共 IP**。
      * **神奇之处**：虽然连的是 S3 的公共 IP，但**流量不走互联网**，而是走你的 DX 专线。
      * **路由**：AWS 会通过 BGP 把 **所有 AWS 的公共 IP 段** (几千个网段) 广播给你的本地路由器。
  * **SAP 考点 (必考)**：
      * **场景**：本地数据中心有 500TB 数据，要通过 DX 专线传到 **S3 存储桶**。
      * **答案**：使用 **Public VIF**。
      * *陷阱*：不要选 Private VIF (除非你配合 S3 Interface Endpoint，那个更贵且复杂，Public VIF 是原生解法)。

#### 3\. Transit VIF (传输虚拟接口) —— “去交通枢纽的车道”

  * **目的地**：**Transit Gateway (TGW)**。
  * **通信对象**：本地数据中心 \<---\> TGW \<---\> **成百上千个 VPC**。
  * **网关终点**：必须连接到 **DXGW**，然后由 DXGW 连接到 **TGW**。
  * **核心特征**：
      * 这是企业级架构的专属接口。
      * **唯一作用**：当你使用 **Transit Gateway** 组网时，DX 上必须切出 Transit VIF。
      * *注意：Private VIF 连不上 TGW；Public VIF 也连不上 TGW。只有 Transit VIF 能连。*
  * **SAP 考点**：
      * **场景**：你有 100 个 VPC 连接在 TGW 上，现在本地数据中心想通过 DX 访问这 100 个 VPC。
      * **答案**：创建一个 **Transit VIF**。

-----

-----

### ⚔️ SAP 考场：如何 1 秒选出正确 VIF？

遇到网络题，盯着\*\*“目的地”\*\*看：

1.  **目的地是 EC2 / RDS (VPC 内资源)**？

      * 如果连接方式是 VGW 或 DXGW -\> 选 **Private VIF**。
      * 如果连接方式是 Transit Gateway -\> 选 **Transit VIF**。

2.  **目的地是 S3 / DynamoDB (AWS 公共服务)**？

      * 选 **Public VIF**。

3.  **目的地是 Transit Gateway (TGW)**？

      * 必须选 **Transit VIF**。

-----

### ⚠️ 高频陷阱：Private VIF 能连 S3 吗？

**题目**：客户只有一条 Private VIF 连接到 VPC。现在本地服务器想通过这条 DX 线访问 S3，最简单的办法是什么？

  * **错误直觉**：不行吧，Private VIF 只能连内网，S3 是公网服务。
  * **正确解法 (利用 VPC 端点)**：
    1.  在 VPC 里创建一个 **S3 Interface Endpoint (接口端点)**。这会在 VPC 里生成一个**私有 IP**。
    2.  本地服务器访问这个**私有 IP**。
    3.  流量路径：本地 -\> Private VIF -\> VPC (私有 IP) -\> AWS 骨干网 -\> S3。
    <!-- end list -->
      * *注：这种方案虽然可行，但如果题目问“原生、高吞吐访问 S3”，首选还是 Public VIF。接口端点是要额外交费的，Public VIF 访问 S3 流量费更低。*

-----

### ⚡️ 快速测试

**场景**：
你是一家跨国银行，已经购买了 **Direct Connect**。

1.  你需要把每天产生的 10TB 交易日志归档到 **Amazon S3**。
2.  你需要让本地收银系统连接 AWS 上的 **EC2** 结算服务。
3.  合规要求：所有流量都**不能**走公共互联网。

**问题**：你需要在 DX 物理连接上创建哪种 VIF？
A. 一个 Transit VIF。
B. 一个 Private VIF 和 一个 Public VIF。
C. 两个 Private VIF（一个连 VPC，一个连 S3 Endpoint）。
D. 一个 Public VIF（同时访问 EC2 和 S3）。

**请告诉我你的选择和理由。**
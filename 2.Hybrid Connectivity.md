1.  **物理层**：路怎么铺？（Direct Connect vs VPN）
2.  **逻辑层**：接口怎么开？（VIF 的三种类型）
3.  **枢纽层**：网关怎么选？（VGW vs DXGW vs TGW —— **核心难点**）
4.  **DNS 层**：名字怎么叫？（Route 53 Resolver）

-----

### 第一层级：物理层 —— “路怎么铺？”

假设你的**本地数据中心 (On-Premise)** 是 **“张家村”**，**AWS 云** 是 **“云端城”**。你想修一条路连通它们。

#### 1\. 方案 A：Site-to-Site VPN (公路)

  * **本质**：你利用现有的**公共互联网**（国道），在上面打了一条**加密隧道**（IPSec Tunnel）。
  * **特点**：
      * **便宜、快**：几分钟就能配好。
      * **不稳定**：公网堵车你也堵，延迟忽高忽低。
      * **带宽上限**：单条隧道 **1.25 Gbps**（记数字）。想更高？要用 ECMP（多条路并联）。

#### 2\. 方案 B：Direct Connect (DX) (专用高速铁路)

  * **本质**：你拉了一根**物理光纤**，从张家村直接连到 AWS 的机房。不经过公共互联网。
  * **特点**：
      * **贵、慢**：申请光纤要几个月。
      * **极其稳定**：低延迟、高带宽（1G, 10G, 100G）。
      * **安全**：虽然是私有路，但**默认不加密**（裸光纤）。如果在此基础上还要加密，必须**再套一层 VPN** 或者开启 **MACsec**（硬件加密，需特定设备）。

-----

### 第二层级：逻辑层 —— “接口怎么开？” (VIFs)

这就是 DX 最容易晕的地方。你有了一根物理光纤（DX Connection），但这根光纤里可以跑不同类型的流量。我们需要划分**虚拟接口 (VIF - Virtual Interface)**。

想象这根光纤是一条**大管道**，VIF 就是管道里的**隔离套管**。

| VIF 类型 | 连通目标 (Destination) | 典型场景 (SAP 考点) | 关键限制 |
| :--- | :--- | :--- | :--- |
| **Private VIF**<br>(私有 VIF) | **VPC 内部** (私有 IP) | 本地服务器要连 AWS 里的 EC2、RDS。 | 一个 Private VIF 只能连一个 VGW/DXGW。 |
| **Public VIF**<br>(公共 VIF) | **AWS 公共服务** (公共 IP) | 本地服务器要往 **S3** 传数据，或者连 **DynamoDB**，但不想走公网。 | 它是通向 AWS 的“后门”，不进 VPC，直接连 AWS 全球骨干网。 |
| **Transit VIF**<br>(传输 VIF) | **Transit Gateway (TGW)** | **终极杀招**。当你需要通过 DX 连接 TGW 时，**必须且只能**用这种 VIF。 | 只能连 DX Gateway (作为中介) 再连 TGW。 |

> **🧠 记忆定桩**：
>
>   * 连 VPC -\> **Private**
>   * 连 S3 -\> **Public**
>   * 连 TGW -\> **Transit**

-----

### 第三层级：枢纽层 —— “网关怎么选？” (The Gateway Wars) ⚡️核心难点

这是 SAP 考试中**最核心、最容易混淆**的部分。AWS 有三种网关，名字很像，功能天差地别。

请把它们想象成不同级别的\*\*“路由器”\*\*。

#### 1\. VGW (Virtual Private Gateway) —— “单户门铃”

  * **地位**：它是 VPC 自己的大门。
  * **能力**：
      * 只能连 **1 个** VPC。
      * 如果你有 10 个 VPC 要连 DX，你就得在 DX 上开 10 个 Private VIF，分别连这 10 个 VGW。
  * **考点**：**“最老、最笨、最简单”**。

#### 2\. DXGW (Direct Connect Gateway) —— “跨国批发商”

  * **地位**：它是一个**全球性**资源（Global Resource）。
  * **能力**：
      * **一对多**：它可以连接 **10 个** 不同 Region 的 VPC (VGW)。
      * **省钱**：你只需要在 DX 上开 **1 个** Private VIF 连到 DXGW，就能通达这 10 个 VPC。
      * **致命缺陷 (必考)**：**无传递路由 (No Transitive Routing)**。
          * 本地能访问 VPC A。
          * 本地能访问 VPC B。
          * **但是！** VPC A **不能** 通过 DXGW 访问 VPC B。它们是隔离的。

#### 3\. TGW (Transit Gateway) —— “中央枢纽”

  * **地位**：它是 Region 级别的\*\*“云上核心路由器”\*\*。
  * **能力**：
      * **万能连接**：连 VPC、连 VPN、连 DX。
      * **传递路由 (Transitive Routing)**：**A 可以访问 B！**（这是它和 DXGW 最大的区别）。
      * **DX 怎么连 TGW？** (SAP 经典架构)：
          * 物理 DX -\> **Transit VIF** -\> **DXGW** -\> **TGW** -\> VPCs。
          * *注意：Transit VIF 不能直接插在 TGW 上，必须中间经过一个 DXGW。*

-----

### 🧪 阶段性小测验 (看看你晕没晕)

**场景**：
你是一家跨国公司。

1.  **本地**：在芝加哥有一个数据中心，有一条 **DX**。
2.  **云端**：在 `us-east-1` 有 VPC A，在 `eu-west-1` (欧洲) 有 VPC B。
3.  **需求 1**：本地数据中心需要访问 VPC A 和 VPC B。
4.  **需求 2**：VPC A 和 VPC B 之间**不需要**通信。

**问题**：你应该在 DX 上配置什么？
A. 创建两个 Private VIF，分别连两个 VPC 的 VGW。
B. 创建一个 Private VIF，连到一个 DX Gateway，然后 DXGW 关联这两个 VPC 的 VGW。
C. 创建一个 Transit VIF，连到一个 DX Gateway，再连到 TGW。

**请思考一下选什么？** (这能检验你对 DXGW “跨区域 + 不互通”特性的理解)

-----

### 第四层级：DNS 层 —— “名字怎么叫？” (Hybrid DNS)

路修好了，现在要解决“喊名字”的问题。

  * 本地服务器想访问 `db.aws.internal`。
  * AWS EC2 想访问 `server.onprem.corp`。

**Route 53 Resolver (解析器) 是唯一答案。**

它有两个**端点 (Endpoints)**，分别负责两个方向（必考）：

1.  **出站端点 (Outbound Endpoint)**：**AWS -\> 本地**

      * **动作**：EC2 发出请求，经过这个端点，通过 DX/VPN，**转发**给本地 DNS 服务器。
      * *口诀：AWS 想出去，走 Outbound。*

2.  **入站端点 (Inbound Endpoint)**：**本地 -\> AWS**

      * **动作**：本地 DNS 服务器配置一个“转发规则”，把 `*.amazonaws.com` 的请求发给这个入站端点的 **IP 地址**。
      * *口诀：本地想进来，找 Inbound。*

-----

### 🔥 终极复习：一张表总结“混合云网络”

| 这里的... | 对应 AWS 服务 | 关键特征 (考点) |
| :--- | :--- | :--- |
| **物理光纤** | **Direct Connect (DX)** | 稳定、不走公网。 |
| **隔离通道** | **Private VIF** | 连 VPC 私有 IP。 |
| **后门通道** | **Public VIF** | 连 S3/DynamoDB 公共 IP。 |
| **超级通道** | **Transit VIF** | 专连 TGW (通过 DXGW)。 |
| **全球分发器** | **DX Gateway (DXGW)** | 跨 Region 连 VPC，但 VPC 间**不通**。 |
| **中央路由器** | **Transit Gateway (TGW)** | 区域内连 VPC，VPC 间**可通**。 |
| **DNS 翻译官** | **Route 53 Resolver** | Inbound (进), Outbound (出)。 |

-----
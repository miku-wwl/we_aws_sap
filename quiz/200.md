#### 📝 [200/529] SAML 联合认证排错

**1. 🕵️‍♂️ 题眼与约束分析**
* **架构：** On-prem IdP $→$ SAML 2.0 $→$ AWS STS $→$ Console。
* **故障：** 架构师测试成功，**Test User** 失败。
* **推断：** 既然架构师能成，说明 IdP 和 AWS 的信任关系（SAML Provider ARN, Role Trust Policy 基本结构）是对的。问题出在测试用户特定的配置或断言上。
* **选择：** 3 个检查项。

**2. ⚡ 秒杀思路**
* **检查 1：IAM Role Trust Policy (B)。** 虽然架构师成功了，但 Role 的 Trust Policy 必须允许 SAML Provider Assume。这是基础。（虽然架构师成功可能意味着他用的 Role 是对的，但如果测试用户用的是不同的 Role，或者 Trust Policy 有 Condition 限制特定用户？B 是必查项）。
* **检查 2：SAML Assertion (D)。** Web 门户必须调用 `AssumeRoleWithSAML` 并传递正确的 ARN（Role ARN, Provider ARN）。如果测试用户的断言里 Role ARN 映射错了，就会挂。
* **检查 3：IdP 组映射 (C)。** 题目提到 "Test user is not in the AWSFederatedUsers group"。在 IdP 端，通常通过组来映射 AWS Role。如果用户不在组里，IdP 就不会生成包含该 Role 的 SAML 断言。这是最常见的"用户级"错误。
* **排除 A:** "IAM user permissions policy"。联合认证使用的是 **IAM Role**，不是 IAM User。联合用户在 AWS 端没有 IAM User 实体。A 概念错误。
* **排除 E:** "DNS access from VPC"。SAML 认证是客户端（浏览器）与 IdP 和 AWS 的交互，不涉及 VPC 内部怎么连 IdP。

**3. ✅ 正确选项解析 (选项 B, C, D)**
* **Trust Policy:** 允许 SAML 扮演。
* **IdP Group:** 确保用户有权获取断言。
* **API Call:** 确保参数传递正确。

**5. 📚 核心考点:** SAML 联合认证的调试流程。
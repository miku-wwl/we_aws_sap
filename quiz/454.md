#### 📝 [454/529] 强制 AWS CLI 使用 MFA (STS GetSessionToken)

**1. 🕵️‍♂️ 题眼与约束分析**
* **用户：** Cloud Engineers (IAM Users + Access Keys + MFA Device)。
* **工具：** AWS CLI。
* **需求：** **Enforce MFA** for S3 operations (强制 MFA)。
* **当前策略：** IAM User in `S3-access` group。

**2. ⚡ 秒杀思路**
* **强制策略 (IAM Policy):**
    * 在 IAM Policy 中使用 `Condition: {"Bool": {"aws:MultiFactorAuthPresent": "true"}}`。
    * 如果没有 MFA，拒绝操作。
    * $→$ **选中 C 或 D** 的前半部分。
* **CLI 操作流程：**
    * 长期凭证（Access Key / Secret Key）本身**不包含** MFA 信息。直接用它们调用 CLI，`aws:MultiFactorAuthPresent` 是 `false`（或不存在），会被拒绝。
    * 必须先使用长期凭证 + MFA Code 调用 **`aws sts get-session-token`**，获取**临时凭证**。
    * 这个临时凭证由于是带 MFA 换取的，所以包含 `aws:MultiFactorAuthPresent: true` 上下文。
    * 然后配置 CLI 使用这个临时凭证操作 S3。
* **选项对比：**
    * A (Prompt for MFA): CLI 不会自动弹出提示框输入 MFA。必须显式获取 Token。
    * B (Trust Policy): IAM User 没有 Trust Policy（只有 Role 有）。
    * C (Deny unless MFA): 策略是对的，但操作描述 "Use IAM access key and CLI to call S3" 是错的。直接用 AK/SK 会被拒绝。
    * **D:** Policy (Deny unless MFA) + **STS GetSessionToken** (Get temp creds) + **Use temp creds in profile**。这是 CLI 使用 MFA 的标准且唯一正确流程。
    * **锁定 D。**

**3. ✅ 正确选项解析 (选项 D)**
* **Condition: aws:MultiFactorAuthPresent:** 强制 MFA 的策略条件。
* **STS GetSessionToken:** CLI 获取带 MFA 上下文的临时凭证的方法。

**5. 📚 核心考点:** CLI 环境下强制 MFA 的实现机制与操作流程。
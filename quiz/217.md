#### ğŸ“ [217/529] Web å®‰å…¨ä¸å®¡è®¡ (WAF + Firehose)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **æ¶æ„ï¼š** ALB + EC2ã€‚
* **å®‰å…¨éœ€æ±‚ï¼š**
    1.  Filter common vulnerabilities (è¿‡æ»¤å¸¸è§æ¼æ´ -> WAF)ã€‚
    2.  Send **Denied requests** to 3rd-party audit (è¢«æ‹’è¯·æ±‚å‘ç»™ç¬¬ä¸‰æ–¹)ã€‚
    3.  Highly Availableã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **é˜²å¾¡å±‚ï¼š** **AWS WAF** æŒ‚åœ¨ ALB ä¸Šã€‚ä½¿ç”¨ **AWS Managed Rules** (å¸¸è§æ¼æ´)ã€‚
* **æ—¥å¿—å®¡è®¡ï¼š**
    * WAF æ”¯æŒ **Full Logging** (å…¨é‡æ—¥å¿—)ã€‚
    * WAF æ—¥å¿—çš„åŸç”Ÿç›®çš„åœ°æ”¯æŒï¼šCloudWatch Logs, S3, **Kinesis Data Firehose**ã€‚
    * é¢˜ç›®è¦æŠŠæ—¥å¿—å‘ç»™ç¬¬ä¸‰æ–¹å®¡è®¡åº”ç”¨ï¼ˆé€šå¸¸æ”¯æŒ Splunk/Sumo Logic ç­‰ï¼Œæˆ–è€… HTTP Endpointï¼‰ã€‚**Kinesis Data Firehose** æ”¯æŒç›´æ¥æŠ•é€’åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚ Splunk, Datadog, HTTPï¼‰ã€‚
    * é€‰é¡¹ B (CloudWatch Logs + Lambda): ä¹Ÿå¯ä»¥ï¼Œä½† Lambda éœ€è¦è‡ªå·±å†™ä»£ç æ¬è¿ã€‚Firehose æ˜¯æ‰˜ç®¡çš„æ¬è¿å·¥ã€‚
    * é€‰é¡¹ C/D (Firehose):
        * C: Configure ALB target group... Create Firehose... WAF on ALB... **Enable logging choosing Firehose**. è¿™ä¸ªæµç¨‹æ˜¯å¯¹çš„ã€‚
        * D: ä¹Ÿæ˜¯ Firehoseã€‚åŒºåˆ«åœ¨äº D è¿˜é…ç½®äº† "Multi-AZ ASG"ã€‚é¢˜ç›®è¦æ±‚ "Highly Available"ï¼Œæ‰€ä»¥å¤š AZ æ˜¯å¿…é¡»çš„ã€‚
        * è®©æˆ‘ä»¬ç»†çœ‹ C å’Œ D çš„åŒºåˆ«ã€‚
        * C: "Configure ALB... add EC2 as targets". æ²¡æ ASGã€‚
        * D: "Configure Multi-AZ ASG...". æåˆ°äº† ASGã€‚
        * æ˜¾è€Œæ˜“è§ï¼ŒD çš„æ¶æ„æ›´å¥å£®ï¼ˆMulti-AZ ASGï¼‰ã€‚ä¸” D çš„ WAF æ—¥å¿—é…ç½®ä¹Ÿæ˜¯å¯¹çš„ã€‚
    * **é”å®š Dã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ D)**
* **WAF:** é˜²å¾¡ã€‚
* **Kinesis Firehose:** æ—¥å¿—å®æ—¶æŠ•é€’åˆ°ç¬¬ä¸‰æ–¹ã€‚
* **Multi-AZ ASG:** é«˜å¯ç”¨è®¡ç®—ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** WAF æ—¥å¿—æŠ•é€’ä¸é«˜å¯ç”¨æ¶æ„ã€‚
#### 📝 [229/529] 零停机 SQL Server 迁移 (Re-platform vs Re-host)

**1. 🕵️‍♂️ 题眼与约束分析**
* **源端：** Mission-critical SQL Server (Legacy)。
* **目标：** Modern data architecture (现代化架构 -> RDS/Aurora)。
* **要求：** **Near-zero downtime** (接近零停机)。

**2. ⚡ 秒杀思路**
* **现代化路径：**
    * Re-host (EC2): 不是现代化。
    * Re-platform (RDS for SQL Server): 是现代化。
    * Refactor (Aurora MySQL/PG): 改动大，但题目说 "Migrate legacy system to modern architecture"，并未禁止换引擎。但通常 Legacy SQL Server 很难直接转 Aurora（除非用 Babelfish）。
* **迁移工具：**
    * **AWS DMS (B):** 专门做数据库迁移，支持 **CDC (Change Data Capture)**，能实现源和目标的持续同步，从而达到"接近零停机"的切换。
    * **MGN (A/D):** 应用迁移服务，是块级复制，通常用于 Re-host 到 EC2。不支持直接迁移到 RDS/Aurora（除了特定的 OS 搬迁，但数据库层面 DMS 更专业）。
    * **Native HA (C):** 配置 SQL Server Always On 到 RDS？RDS 是托管的，虽然支持 Native Backup Restore，但配置 Always On 跨混合云比较复杂。
* **选项 B:** 使用 **DMS** 将数据迁移到 S3？然后再加载到 RDS？
    * 这是一个**陷阱**。DMS 通常直接从 Source DB 连到 Target DB (RDS)。为什么中间加个 S3？
    * 也许是因为源库太老/网络限制？或者作为中转？
    * **再看 A:** SCT + MGN -> Aurora Serverless。MGN 不能迁数据进 Aurora。错。
    * **再看 C:** 本地 HA 工具。
    * **再看 D:** MGN -> EC2 -> 分离 DB -> 移到 RDS。这步骤太多，停机时间不可控。
    * **回过头看 B:** DMS to S3, then S3 to RDS? 这不是 DMS 的标准用法（DMS 直连 RDS 最快）。但是，如果源库很大，或者有特殊限制，S3 中转也是一种模式。更重要的是，B 选项提到了 **CDC**。只有 CDC 才能实现 Near-zero downtime。
    * **但是，** 让我们仔细看 **C**。 "Use native database high availability tools... replicate... cutover". SQL Server 可以配置 **Distributed Availability Group** 或者 **Log Shipping** 到 RDS 吗？RDS 即使支持，配置也很复杂。
    * **实际上，** 最标准的答案应该是 **DMS 直连 RDS**。但选项 B 非要插个 S3。
    * **让我们重新审视 A:** "In-place upgrade before migration... AWS SCT... Aurora Serverless". 如果这是异构迁移（SQL -> Aurora），SCT + DMS 是标配。
    * **题目没说要异构。** 只是说 "Modern data architecture"。RDS for SQL Server 也算现代（托管）。
    * **如果必须选一个最靠谱的：** **C** 选项利用 SQL Server 原生复制（如 Transactional Replication 或 Always On，虽然 RDS 限制多，但如果是同构迁移，原生复制最稳）。
    * **然而，** 在 AWS 考试逻辑中，**DMS** 是迁移万金油。选项 B 虽然怪（S3 中转），但它是唯一提到 **"DMS"** 和 **"CDC"** 的。CDC 是零停机的关键。也许 S3 只是作为 DMS 的一个 Target endpoint 示例？
    * **更正：** 实际上，还有一种可能。题目是 **DMS + SCT** 组合。但选项 A 混用了 MGN。
    * **让我们看 C:** "Native tools... Replicate... Cutover". 这在 SQL Server 迁移中（如使用 Distributed Availability Groups 到 RDS Custom 或 EC2）是可行的。但 RDS 标准版支持吗？RDS 支持 Native Backup/Restore (S3)，不支持直接作为 Always On 副本（有限制）。
    * **有没有可能选 B?** S3 -> RDS SQL Server 可以用 `rds_restore_database` 存储过程（从 .bak 文件）。如果 DMS 把数据作为 .bak 扔到 S3？不对，DMS 输出的是 CSV/Parquet。
    * **这题选项设计得很刁钻。**
    * **让我们再看 A:** "In-place upgrade... export to Aurora". 风险极大。
    * **D:** MGN 到 EC2，然后把数据导进 RDS。这是 **Rehost then Replatform**。这是非常稳健的策略：先用 MGN 快速上云（EC2），然后在云上利用高速内网和原生工具迁移到 RDS。虽然步骤多，但每一步都可控。
    * **但是 D 没提 CDC。** 只有 B 提了 CDC。
    * **如果一定要选 Near-zero downtime，CDC 是必须的。**
    * 也许 B 的意思是：DMS (Source -> S3 with CDC), 然后 App 消费 S3？不，目标是 RDS。
    * **让我们换个思路：** 这是一个多选题吗？不，单选。
    * **最新的 AWS 迁移最佳实践：** 对于 SQL Server，推荐 **DMS**。如果 B 选项去掉了 "S3" 这个中间人，就是完美答案。
    * 考虑到其他选项的离谱程度（A 乱用工具，D 步骤繁琐且停机长，C 原生复制限制多），**B 选项** 尽管有 S3 中转的描述瑕疵（或者是指 DMS 将全量+增量数据落地 S3，然后某种机制同步进 RDS？），但它包含了核心关键词 **"DMS"** 和 **"CDC"**。这是零停机迁移的灵魂。
    * **修正：** 实际上，DMS 支持 S3 作为 Target。然后 RDS SQL Server 支持从 S3 导入数据（BULK INSERT）。但这无法实现 CDC 的实时应用。
    * **有没有可能是题目回忆有误？** 或者 C 是指 Transactional Replication？RDS 支持作为订阅者。
    * **让我们暂定 B，因为 CDC 是零停机的核心技术。**

**3. ✅ 正确选项解析 (选项 B)**
* **DMS + CDC:** 唯一能实现源端和目标端持续同步、从而最小化切换停机时间的技术。

**5. 📚 核心考点:** 数据库零停机迁移技术 (DMS CDC)。
这 10 道题目（包含 1 道关于 EC2 默认加密的题目）涵盖了 **Lambda 成本与 Savings Plan**、**多区域游戏架构 (Latency)**、**第三方防火墙高可用部署 (GWLB)**、**遗留应用许可证迁移 (ENI)**、**跨区域数据库扩展 (RDS RR + Latency Routing)**、**VPC 自动化创建 (StackSets)**、**多区域 API 密钥与 Secrets 管理**、**单体应用可靠性重构 (Session Store)**、**RDP 安全访问 (Fleet Manager)**、**EBS 默认加密**。

特别是 **Q313 (Firewall Appliance HA)** 和 **Q317 (Multi-Region Secrets & KMS)** 是 SAP 考试中的复杂设计题。

让我们开启 **逐题秒杀模式**！

---

#### 📝 [311/529] 计算成本优化 (EC2 + Lambda + MemoryDB)

**1. 🕵️‍♂️ 题眼与约束分析**
* **资源：**
    * EC2: Consistent & stable (持续稳定) $\rightarrow$ 适合 SP/RI。
    * Lambda: Variable & unpredictable (波动大) $\rightarrow$ 不适合 RI (预留并发是为性能不是为省钱)，适合 Compute SP。
    * MemoryDB: Cache layer $\rightarrow$ 适合 Reserved Nodes。
* **目标：** Minimize overall monthly cost。

**2. ⚡ 秒杀思路**
* **EC2 & Lambda:**
    * **Compute Savings Plan** 同时覆盖 EC2、Fargate 和 Lambda。由于 Lambda 负载波动，单独买 Lambda SP 不灵活。Compute SP 可以自动适配 EC2 和 Lambda 的总用量。
    * $\rightarrow$ **选中 C 或 D 的前半部分**。
* **Lambda Reserved Concurrency (预留并发):**
    * 这是一个**陷阱**。预留并发是为了保证有足够的并发实例可用（解决冷启动或限流），它**不省钱**（实际上如果没用满反而浪费，因为它不是计费折扣，而是容量预留）。Savings Plan 才是省钱工具。
    * $\rightarrow$ **排除 B, D**。
* **MemoryDB:**
    * MemoryDB 有 **Reserved Nodes**。这是标准的省钱方式。
    * $\rightarrow$ **选中 A 或 B**。
* **综合分析：**
    * **A:** EC2 Instance SP (只管 EC2) + Lambda Compute SP (只管 Lambda?) + MemoryDB Reserved。
        * Compute SP 可以覆盖 EC2 和 Lambda。分开买 EC2 Instance SP 和 Lambda Compute SP 有点多余，不如一个大的 Compute SP 灵活（除非 EC2 极其稳定且确定 Region/Family，Instance SP 折扣略高）。但 A 的 Lambda Compute SP 描述为 "cover minimum expected" 是合理的。
    * **C:** **Compute Savings Plan for EC2 & Lambda** + MemoryDB Reserved Nodes。
        * 选项 C 说 "Purchase Compute Savings Plans to cover ALL expected costs for EC2, Lambda and MemoryDB"。**错误！** Compute Savings Plan **不覆盖** MemoryDB（MemoryDB 需要单独买 Reserved Nodes）。
    * **让我们回看 A:** "Purchase EC2 Instance SP... Purchase Compute SP for Lambda... Purchase MemoryDB Reserved Nodes"。这个组合技术上可行，且针对性强。
    * **再看 D:** "Compute SP for EC2 and MemoryDB"。错，SP 不包 MemoryDB。
    * **有没有可能 C 的意思是：** Compute SP 覆盖 EC2/Lambda，另外买 MemoryDB Reserved？选项 C 的原文是 "Purchase Compute Savings Plans to cover all expected costs for EC2 instances, Lambda functions, and MemoryDB cache nodes." 这是一个语法陷阱。它暗示 SP 能包圆了。这是错的。
    * **让我们再看 B:** Compute SP for EC2... Lambda Reserved Concurrency。预留并发不省钱。
    * **结论：** 只有 **A** 是正确的组合策略。EC2 Instance SP 折扣最高（适合稳定负载）。Lambda Compute SP 覆盖 Lambda。MemoryDB Reserved 覆盖 MemoryDB。
    * **修正：** 其实 Compute SP 可以同时覆盖 EC2 和 Lambda。如果选一个 Compute SP 覆盖 EC2 + Lambda，也是很好的。但选项中没有单纯的 "Compute SP for EC2/Lambda + MemoryDB Reserved"。
    * **A 选项拆开了：** EC2 Instance SP + Lambda Compute SP。这是为了最大化 EC2 的折扣（Instance SP > Compute SP）。因为题目说 EC2 负载 "Consistent and stable"。
    * **锁定 A。**

**3. ✅ 正确选项解析 (选项 A)**
* **EC2 Instance Savings Plan:** 针对稳定 EC2 提供最高折扣（~72%）。
* **Compute Savings Plan:** 针对 Lambda 提供折扣（~66%）。
* **MemoryDB Reserved Nodes:** 针对 MemoryDB 提供折扣。

**5. 📚 核心考点:** 不同计算/数据库服务的 Savings Plan/Reserved Instance 适用范围。

---

#### 📝 [312/529] 全球游戏架构 (Latency-based Routing)

**1. 🕵️‍♂️ 题眼与约束分析**
* **部署：** 3 Regions。
* **数据：** Leaderboard, Inventory, State must be available across regions (跨区数据同步)。
* **需求：**
    1.  Scale to handle load from ALL regions (任何区域能抗所有负载 -> 灾备/突发)。
    2.  Connect to **lowest latency** region (就近接入)。
    3.  **Minimize operational overhead**。

**2. ⚡ 秒杀思路**
* **路由层：**
    * **Route 53 Latency-based Routing (C):** 将用户导向延迟最低的区域。这是标准做法。
    * **Global Accelerator (A):** 也可以，但 A 选项后面接的是 Route 53 指向 GA IP？逻辑有点绕。GA 本身就是 Anycast IP。且 A 用 Spot Fleet？游戏状态通常需要稳定实例。
* **数据层：**
    * **DynamoDB Global Tables (C):** 多区域多活，数据实时同步（排行榜、库存）。Serverless，自动扩展，运维最少。
    * **Aurora Global (D):** 只有一写多读（Write Forwarding 也有延迟和限制），或者多主（仅限 2 Region）。三区域多活对于 Aurora 来说配置复杂。且 D 选项说 "Deploy DNS server on EC2"，这是反模式（有 Route 53 不用？）。
    * **MySQL on EC2 (B):** 自建复制？运维噩梦。
* **计算层：**
    * **ASG + NLB (C):** 标准组合。
* **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **Route 53 Latency Routing:** 最低延迟接入。
* **DynamoDB Global Tables:** 多区域数据同步与多活。

**5. 📚 核心考点:** 全球游戏架构的标准组件 (Global Tables + Latency Routing)。

---

#### 📝 [313/529] 第三方防火墙高可用部署 (GWLB)

**1. 🕵️‍♂️ 题眼与约束分析**
* **场景：** 部署第三方防火墙（Marketplace）。
* **位置：** Shared Service VPC (集中式)。
* **需求：**
    1.  Monitor/Secure outbound traffic (监控出站)。
    2.  **Prioritize reliability** (可靠性优先)。
    3.  **Minimize failover time** (最小化故障转移时间)。
* **选择：** 3 个步骤。

**2. ⚡ 秒杀思路**
* **核心组件：** **Gateway Load Balancer (GWLB)**。它是专门为部署第三方网络虚机（Firewall/IPS）设计的。它提供健康检查、自动缩放、流量清洗，且故障转移极快（通过 GENEVE 协议）。
    * $\rightarrow$ **选中 C** (Create GWLB, add firewalls to target group)。
    * (B 是 NLB，NLB 不支持 GENEVE 透明代理模式，配置复杂且不够透明)。
* **高可用部署：**
    * 防火墙实例应该部署在 **不同可用区 (AZ)** 以实现 HA。
    * $\rightarrow$ **选中 A** (Deploy two firewalls in different AZs)。
    * (E 是同 AZ，单点风险)。
* **流量路由：**
    * 在 Shared VPC 中，需要将流量引向 GWLB。
    * 这是通过 **Gateway Load Balancer Endpoint (GWLBE)** 实现的。GWLBE 是 VPC 路由表中的下一跳目标。
    * $\rightarrow$ **选中 F** (Create GWLB Endpoint, update route table)。
    * (D 是 Interface Endpoint，用于 PrivateLink，不是用于流量清洗路由的)。
* **锁定 A, C, F。**

**3. ✅ 正确选项解析 (选项 A, C, F)**
* **GWLB:** 网络设备负载均衡与故障转移。
* **Multi-AZ:** 物理高可用。
* **GWLBE:** 路由表下一跳目标。

**5. 📚 核心考点:** Gateway Load Balancer (GWLB) 的标准部署架构。

---

#### 📝 [314/529] 遗留应用许可证迁移 (固定 MAC/IP)

**1. 🕵️‍♂️ 题眼与约束分析**
* **痛点：**
    1.  License tied to **MAC address** (绑定 MAC)。新 License 要 12 小时。
    2.  Config uses **Static IP** for DB (绑定 DB IP)。
* **目标：** High Availability (HA) in AWS。
* **选择：** 2 个步骤。

**2. ⚡ 秒杀思路**
* **解决 MAC 绑定 (ENI):**
    * 在 AWS 中，**ENI (Elastic Network Interface)** 拥有固定的 MAC 地址。
    * 即使 EC2 挂了，ENI 可以保留并挂载到新 EC2 上，MAC 地址不变。
    * 策略：创建一个 **ENI Pool** (预先申请好 License 的 ENI)。启动实例时，脚本从池中捞一个空闲 ENI 挂载上去。
    * $\rightarrow$ **选中 A**。
    * (B 说把 License 存 EC2 上做 AMI？License 是跟 ENI (MAC) 绑定的，不是跟 AMI 绑定的。如果 AMI 启动新实例，新实例默认网卡 MAC 会变，License 失效。必须**挂载特定的 ENI**)。
* **解决静态 IP (SSM):**
    * DB 服务器 IP 可能会变（如果 DB 故障切换）。
    * 应用配置文件写死了 IP。
    * 方案：将 DB IP 存储在 **SSM Parameter Store** 中。启动脚本从 SSM 读取 IP 并注入到配置文件。这样如果 DB IP 变了，只需更新 SSM，新启动的应用实例自动获取新 IP。
    * $\rightarrow$ **选中 D**。
    * (E 说把 IP 写死在 AMI 里？那每次 DB IP 变了都要重做 AMI，太慢)。
* **锁定 A, D。**

**3. ✅ 正确选项解析 (选项 A, D)**
* **ENI:** 保留 MAC 地址，解决许可证绑定。
* **SSM Parameter Store:** 解耦配置与镜像，实现动态配置注入。

**5. 📚 核心考点:** 遗留应用“绑定硬件特征”的上云适配技巧。

---

#### 📝 [315/529] 跨区域数据库扩展与低延迟 (Read Replica)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** US Region (RDS MySQL, API Gateway, Lambda, CloudFront)。
* **扩展：** Expand to Europe (欧洲)。
* **流量：** **> 90% Read-only** (读多写少)。
* **目标：** **Minimize latency** for report downloads (最小化延迟)。

**2. ⚡ 秒杀思路**
* **数据库策略：**
    * 90% 是读。为了让欧洲用户读得快，必须在欧洲有数据副本。
    * **Cross-Region Read Replica (C/D):** 在欧洲创建 RDS 只读副本。Lambda (欧洲) 读取本地副本，极大降低延迟。
    * **DMS (A/B):** 自己搭建复制链路？麻烦且不如原生 Read Replica 稳定。
* **路由策略：**
    * Route 53 需要将欧洲用户导向欧洲的 API Gateway。
    * **Latency-based Routing (C):** 根据网络延迟将用户导向最近的端点。这是性能优化的标准策略。
    * **Geolocation Routing (D):** 也可以，但在性能优化场景下，Latency Routing 通常更优（因为它反映真实网络状况）。不过对于“扩展到欧洲”这种明确的地理划分，Geolocation 也是常用的。
    * **关键区别：** Latency vs Geolocation。
    * 题目问 "Minimize user latency"。Latency Routing 就是为此设计的。
    * **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **Cross-Region Read Replica:** 数据本地化，解决读延迟。
* **Latency Routing:** 流量本地化，解决网络延迟。

**5. 📚 核心考点:** 读密集型应用的跨区域扩展架构。

---

#### 📝 [316/529] 自动化创建测试环境 (StackSets + New Account)

**1. 🕵️‍♂️ 题眼与约束分析**
* **需求：** Create **short-lived test environments** (短期环境) for Pull Requests。
* **环境：** EC2 in ASG, TGW connection to On-prem。
* **目标：** **No manual intervention** (全自动), **Least operational overhead**。

**2. ⚡ 秒杀思路**
* **环境隔离：**
    * 每个 PR 一个环境。如果都堆在一个 VPC 里，资源冲突（IP耗尽、安全组限制）很难管。
    * **每个环境一个新账户 (C):** 账户是最好的隔离边界。用完即删（或者重置）。通过 **Organizations** 创建新账户，通过 **CloudFormation StackSets** 自动部署网络和应用。
    * **每个环境一个 VPC (A):** 一个账户里建几百个 VPC？VPC 数量有限额，且 TGW 路由表会爆炸。
    * **单 VPC (B):** 隔离性差，容易冲突。
    * **EKS (D):** 容器化是好方向，但题目现状是 EC2 ASG。如果转 EKS 需要重构（Convert to Docker image）。题目要 Least overhead，直接自动化现有架构（CFN）更简单。
* **自动化工具：**
    * **CloudFormation StackSets** 可以在新账户创建时自动部署基线资源（VPC, TGW Attachment）。
    * 选项 C 描述了：New OU for testing -> StackSet deploys networking -> New Account for each env. 这是一个非常干净、可扩展的 CI/CD 环境模型（Ephemeral Accounts）。
* **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **Ephemeral Accounts:** 账户级隔离，避免资源冲突，易于清理。
* **StackSets:** 自动化账户基线配置。

**5. 📚 核心考点:** 大规模临时测试环境的账户策略。

---

#### 📝 [317/529] 多区域 API 密钥与 KMS 管理 (3选)

**1. 🕵️‍♂️ 题眼与约束分析**
* **架构：** API Gateway + Lambda + DynamoDB Global Table。
* **机密：** Vendor API Key in **Secrets Manager**, Encrypted by **KMS CMK**。
* **目标：** **Active-Active in multiple regions** (多区域双活)。
* **核心挑战：** Secrets Manager 和 KMS 密钥如何跨区域同步？

**2. ⚡ 秒杀思路**
* **KMS 密钥 (B vs D):**
    * 标准 KMS 密钥是区域性的 (Regional)。
    * **KMS Multi-Region Keys (MRK) (B):** 允许创建一个主密钥，并将其复制到其他区域。这些复制后的密钥具有**相同的 Key ID**。这极大地简化了应用逻辑（应用代码里的 Key ID 不用变，或者密文可以跨区域解密）。
    * $\rightarrow$ **选中 B**。
* **Secrets Manager (C vs E):**
    * **Secrets Manager Replication (C):** Secrets Manager 原生支持将 Secret **复制**到其他区域。
    * 在配置复制时，你需要指定目标区域使用的 **KMS Key**。这里应该选择那个 Multi-Region Key (MRK)。
    * $\rightarrow$ **选中 C**。
* **路由 (A):**
    * 使用 Route 53 **Multivalue Answer** (多值应答) 或 **Latency** 路由来实现 Active-Active。题目选项 A 提到了 Multivalue，这也是一种负载均衡策略（虽然 Latency 更常见，但 Multivalue 也是 Active-Active 的一种）。
    * $\rightarrow$ **选中 A**。
    * (F 选项说修改 Lambda 部署流程？有了 Global Table 和 Secret Replication，Lambda 部署只是标准的 CI/CD，不需要特别复杂的“修改流程”来支持多区域，重点是基础设施的同步)。
* **锁定 A, B, C。**

**3. ✅ 正确选项解析 (选项 A, B, C)**
* **KMS Multi-Region Key:** 简化跨区域解密。
* **Secrets Manager Replication:** 自动同步凭证。
* **Route 53:** 流量分发。

**5. 📚 核心考点:** Secrets Manager 和 KMS 的跨区域复制特性。

---

#### 📝 [318/529] 单体应用可靠性重构 (Session Store)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** Single Server (Web + App + MySQL)。
* **目标：** **Highest level of reliability** (最高可靠性)。
* **重构：** 迁移到 AWS。

**2. ⚡ 秒杀思路**
* **数据库：**
    * **Aurora MySQL (B):** 存储层 3AZ 复制，自愈能力，支持 Read Replica。可靠性高于标准 RDS (A/D)。
    * DocumentDB (C) 是 MongoDB，异构迁移风险大。
* **会话存储 (Session Store):**
    * 为了实现应用层的高可靠（ASG 扩展），应用必须无状态。
    * **ElastiCache for Redis (B):** 是存储会话的标准方案。支持复制组 (Replication Group) 实现高可用。
    * Neptune (A) 是图数据库，不适合 Session。
    * Firehose (C) 是流数据，不适合 Session。
    * Memcached (D) 不支持复制/持久化，节点挂了 Session 就丢了。Redis 支持复制，可靠性更高。
* **结论：** **B 选项** (Aurora + Redis) 是黄金组合。
* **锁定 B。**

**3. ✅ 正确选项解析 (选项 B)**
* **Aurora:** 最高可靠性的关系型数据库。
* **Redis (Replication Group):** 高可用的会话存储。

**5. 📚 核心考点:** Web 应用高可用架构组件 (Aurora + Redis)。

---

#### 📝 [319/529] RDP 安全访问 (Fleet Manager)

**1. 🕵️‍♂️ 题眼与约束分析**
* **需求：** RDP access to Windows EC2。
* **集成：** On-prem Active Directory。
* **连接：** Internet (有 VPN 硬件，但还没建？题目说 "Has hardware to establish VPN" 暗示可能还没建或者想用更简单的？)。
* **目标：** **Most cost-effective**。

**2. ⚡ 秒杀思路**
* **传统方案 (D - RD Gateway):** 需要部署 RD Gateway 服务器（EC2），需要 Managed AD。成本高（AD 费用 + EC2 费用）。
* **VPN (C):** 需要配置 VPN，且用户需要连 VPN 才能 RDP。虽然硬件已有，但 VPN 管理和客户端配置有成本。
* **SSM Fleet Manager (B):**
    * **无堡垒机/VPN：** Fleet Manager 提供基于浏览器的 RDP 访问（通过 SSM Agent），无需暴露 3389 端口，无需 VPN。
    * **AD 集成：** 通过 **AWS SSO (IAM Identity Center)** 集成 AD Connector（免费/低成本）来连接本地 AD。用户使用 AD 账号登录 AWS 控制台，然后通过 Fleet Manager RDP。
    * **成本：** SSM 是免费的（标准功能）。AD Connector 比 Managed AD 便宜。无需维护 RD Gateway EC2。
    * 这是最现代、最安全且成本最低的方案。
    * $\rightarrow$ **选中 B**。
* **锁定 B。**

**3. ✅ 正确选项解析 (选项 B)**
* **Fleet Manager:** 提供安全的、无代理的 RDP 访问。
* **AD Connector:** 低成本连接本地 AD。

**5. 📚 核心考点:** 取代堡垒机的 RDP 访问方案 (SSM Fleet Manager)。

---

#### 📝 [320/529] 强制 EBS 加密 (Default Encryption)

**1. 🕵️‍♂️ 题眼与约束分析**
* **痛点：** Unencrypted EBS volumes found.
* **需求：** Encrypt **ALL NEW** EBS volumes (所有新卷加密)。
* **目标：** **Least effort** (最小努力)。

**2. ⚡ 秒杀思路**
* **区域级设置：**
    * AWS EC2 提供了一个 **"Encryption by default"** (默认加密) 的账户级/区域级设置。
    * 一旦开启，该区域内所有新创建的 EBS 卷（无论是直接创建还是通过 Launch Template）都会被自动加密。
    * 无需写 Config 规则 (C)，无需 EventBridge + Lambda (A)，无需 Audit Manager (B)。
    * 只要在控制台点一下（或一个 API 调用）。
    * $\rightarrow$ **选中 D**。
* **锁定 D。**

**3. ✅ 正确选项解析 (选项 D)**
* **EBS Encryption by Default:** 一键解决合规问题，零代码。

**5. 📚 核心考点:** EBS 默认加密功能的开启。

---
**小结：**
这组题目的 **Fleet Manager**、**Secrets Manager 跨区复制**、**CodeCommit 修复** 都是高分关键。

**准备好下一组了吗？**
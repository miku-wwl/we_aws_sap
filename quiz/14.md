
---

#### 📝 [14/529] 抢救终止实例的日志

**1. 🕵️‍♂️ 题眼与约束分析**
* **痛点：** EC2 缩容终止时，最后 15 分钟的日志还没传走就丢了。
* **需求：** 在终止前强制上传日志。
* **核心技术：** **Auto Scaling Lifecycle Hook (生命周期挂钩)**。

**2. ⚡ 秒杀思路**
* **关键词匹配：** "Ensure logs copied before termination" $\rightarrow$ **Lifecycle Hook: EC2_INSTANCE_TERMINATING**。
* **流程逻辑：**
    1.  检测到终止，Hook 暂停实例（状态变为 Terminating:Wait）。
    2.  触发 Lambda/SSM 去干活（传日志）。
    3.  干完活，发送 **CONTINUE** 信号给 ASG，让它继续终止。
* **秒杀动作：**
    * 选项 A 和 D 发送 "ABANDON"（放弃）。ABANDON 意味着“这次扩展活动算失败”，虽然也会终止实例，但语义不对，且 D 用 SNS 绕弯路。
    * 选项 C 改频率每 5 分钟，治标不治本，最后 5 分钟还是会丢。
    * **选项 B** 使用 SSM Run Command（不需要预埋 Key/脚本，更安全），干完活发送 **CONTINUE**。最标准。
* **锁定 B。**

**3. ✅ 正确选项解析 (选项 B)**
* **SSM Run Command:** 远程执行命令是最佳实践（比 A 中 Lambda SSH 进去或者 A 中所谓的“用 SDK 终止”要好）。
* **CONTINUE:** 正确的结束信号，告诉 ASG “我清理完了，你可以杀它了”。

**4. ❌ 错误选项排查**
* **选项 A:** Lambda 很难直接运行脚本在 EC2 上（除非 SSH，但不推荐）。且最后应该发 CONTINUE。

**5. 📚 核心考点:** ASG Lifecycle Hook (Terminating State) + SSM 集成。

---
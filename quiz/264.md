#### 📝 [264/529] 固定 IP 出站与故障自动恢复 (NAT Gateway HA)

**1. 🕵️‍♂️ 题眼与约束分析**
* **应用：** 3 EC2 in 3 AZs (Private Subnets)。
* **需求：** Access on-prem system。
* **约束：**
    1.  **Only ONE IP address** allowed by firewall (防火墙只认一个 IP)。
    2.  **Mitigate failures automatically** (自动故障缓解)。
* **现状：** 公司已分配了一个 EIP。

**2. ⚡ 秒杀思路**
* **NAT Gateway 的局限：**
    * NAT Gateway 是 AZ 级别的资源。一个 NAT GW 对应一个 EIP。
    * 如果部署 3 个 NAT GW (A)，会有 3 个 EIP。防火墙只认一个 IP，这行不通。
    * 如果只部署 1 个 NAT GW (C)，会有单点故障（AZ 挂了 NAT 就挂了）。
* **如何实现"单 IP 高可用"？**
    * **方案 C (Lambda 自动恢复):**
        * 部署单个 NAT GW (关联那个唯一的 EIP)。
        * 监控 NAT GW。如果挂了（或 AZ 挂了），触发 **Lambda**。
        * Lambda 逻辑：在另一个健康的 AZ 创建新的 NAT GW，**重新关联那个 EIP**，并更新路由表。
        * 虽然有几分钟的 RTO，但题目要求 "Automatically mitigate failures"，并没有要求 RTO=0。这是在"只能用一个 IP"的死约束下，实现自动恢复的唯一方法。
* **排除其他选项：**
    * 选项 A: 3 个 NAT GW 需要 3 个 IP。
    * 选项 B (NLB): NLB 是做入站负载均衡的，这里是出站访问本地。而且 NLB 也是多 AZ 多 IP 的。
    * 选项 D (ALB): ALB 出站 IP 是动态的，且不做 NAT。
* **结论：** 由于"One IP"的硬限制，无法使用多活 NAT。只能用 **Cold Standby** (脚本自动重建) 的方式。
* **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **Single NAT Gateway:** 满足单 IP 白名单限制。
* **Lambda Automation:** 实现跨 AZ 的故障自动恢复（EIP 漂移）。

**5. 📚 核心考点:** 严格单 IP 出站限制下的 NAT Gateway 高可用设计。
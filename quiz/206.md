#### ğŸ“ [206/529] ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“å‡­è¯å®‰å…¨ (Secrets Manager + KMS)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **åœºæ™¯ï¼š** Lambda $\\rightarrow$ RDS SQL Serverã€‚
* **ç¯å¢ƒï¼š** Production (ä¸¥æ ¼å®‰å…¨)ã€‚
* **éœ€æ±‚ï¼š**
    1.  Credentials encrypted with key **only IT Security team can access**ã€‚
    2.  **Key must be rotated** (å¯†é’¥è½®æ¢? é¢˜ç›®è¯´ Key rotated, é€šå¸¸æŒ‡ KMS CMK çš„è½®æ¢ã€‚å¦‚æœæ˜¯å‡­è¯è½®æ¢ï¼ŒSecrets Manager æ“…é•¿)ã€‚
    3.  Devs have access to Dev, not Prod.
* **å…³é”®ç‚¹ï¼š** é™åˆ¶å¯¹ **Key** (åŠ å¯†å¯†é’¥) çš„è®¿é—®ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **å‡­è¯å­˜å‚¨ï¼š** **Secrets Manager (D)** æ˜¯ç®¡ç†æ•°æ®åº“å‡­è¯çš„æœ€ä½³å®è·µï¼Œæ”¯æŒè‡ªåŠ¨è½®æ¢å‡­è¯ã€‚Parameter Store (A) ä¹Ÿå¯ä»¥ï¼Œä½†é«˜çº§åŠŸèƒ½ä¸å¦‚ Secrets Managerã€‚
* **åŠ å¯†å¯†é’¥ï¼š** å¿…é¡»ä½¿ç”¨ **Customer Managed Key (CMK)**ï¼Œå› ä¸ºåªæœ‰ CMK æ‰èƒ½é€šè¿‡ **Key Policy** ç²¾ç»†æ§åˆ¶è°èƒ½ä½¿ç”¨ï¼ˆIT Security Teamï¼‰ã€‚Default Key (B) çš„ç­–ç•¥ä¸å¯æ”¹ã€‚
* **æƒé™æ§åˆ¶ï¼š**
    * é¢˜ç›®è¦æ±‚ï¼šåªæœ‰ IT Security èƒ½è®¿é—® **Key** å’Œ **Secret**ã€‚
    * **Lambda è§’è‰²ï¼š** éœ€è¦æœ‰æƒé™è¯»å– Secretï¼ˆ`GetSecretValue`ï¼‰å’Œä½¿ç”¨ Key è§£å¯†ï¼ˆ`kms:Decrypt`ï¼‰ã€‚
    * **å…³é”®é€»è¾‘ï¼š** å³ä½¿ Lambda ä»£ç èƒ½æ‹¿åˆ°å‡­è¯ï¼Œå¼€å‘äººå‘˜ï¼ˆå¦‚æœæ²¡æƒé™ï¼‰æ— æ³•ç›´æ¥å» Secrets Manager æŸ¥å¯†ç ï¼Œä¹Ÿæ— æ³•ç”¨ Key è§£å¯†ã€‚
    * **é€‰é¡¹ D:**
        * Store in Secrets Manager encrypted with CMKã€‚
        * Restrict access to Secret and Key to IT Security team (ç®¡ç†æƒ)ã€‚
        * Lambda Role has access (ä½¿ç”¨æƒ)ã€‚
        * è¿™æ˜¯æœ€æ ‡å‡†çš„æ¶æ„ã€‚
    * **é€‰é¡¹ A (Parameter Store):** SecureString ä¹Ÿå¯ä»¥ã€‚ä½† D çš„ Secrets Manager æ›´ç¬¦åˆæ•°æ®åº“å‡­è¯ç®¡ç†çš„æƒ¯ä¾‹ï¼ˆç‰¹åˆ«æ˜¯è½®æ¢ï¼Œè™½ç„¶é¢˜ç›®æ²¡æ˜è¯´è¦è½®æ¢å‡­è¯ï¼Œåªè¯´è½®æ¢ Keyï¼Œä½†é€šå¸¸è¿™æ˜¯ä¸€å¥—ï¼‰ã€‚ç„¶è€Œï¼Œ**Parameter Store SecureString** ä¹Ÿæ˜¯å¼ºä¾èµ– KMS çš„ã€‚
    * **å†³èƒœç‚¹ï¼š** "Key must be rotated"ã€‚KMS CMK æ”¯æŒæ¯å¹´è‡ªåŠ¨è½®æ¢ã€‚è¿™ä¸€ç‚¹ A/D éƒ½æ»¡è¶³ã€‚ä½†æ˜¯ **Secrets Manager** æ˜¯ä¸“é—¨ä¸ºæ•°æ®åº“å‡­è¯è®¾è®¡çš„ï¼Œæä¾›äº†æ›´å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ä¸” D é€‰é¡¹æ˜ç¡®æåˆ°äº† "Attach role to Lambda to provide access"ã€‚
    * å®é™…ä¸Šï¼Œå¯¹äº SAP è€ƒè¯•ï¼Œ**Database Credentials = Secrets Manager** æ˜¯å¼ºå…³è”ã€‚
    * **é”å®š Dã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ D)**
* **Secrets Manager:** ä¸“ç”¨äºå‡­è¯ç®¡ç†ã€‚
* **KMS CMK:** å…è®¸å®šä¹‰ Key Policy æ¥é™åˆ¶ç®¡ç†æƒé™ï¼ˆä»… IT Securityï¼‰ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** Secrets Manager ä¸ KMS CMK çš„æƒé™éš”ç¦»ã€‚
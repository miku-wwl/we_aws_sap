#### 📝 [192/529] 蓝绿部署流量控制 (Route 53 Weighted)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** ALB + ASG + Route 53。
* **发布策略：** **10%** traffic to new version (金丝雀/灰度发布)。
* **关键约束：** **Clients must use same version during test window** (会话粘性/一致性)。

**2. ⚡ 秒杀思路**
* **流量切分：**
    * **Route 53 Weighted Routing (A):** 可以配置 90% 指向旧 ALB，10% 指向新 ALB。
    * **ALB Weighted Target Groups (B):** 一个 ALB 下挂两个 Target Group，按权重分发。
* **会话一致性：**
    * **Route 53 (A):** DNS 缓存能保证一段时间内客户端解析到同一个 IP（同一个 ALB）。但这并不是严格的"会话粘性"，只是 DNS TTL 带来的副作用。不过对于大多数"测试窗口"，DNS 这种粗粒度的分流是常用的。
    * **ALB (B):** ALB 支持 **Target Group Stickiness** (目标组粘性)。这能保证同一个客户端一直被分发到同一个目标组（版本）。这比 DNS 更精准。
    * **但是，** 题目说 "Major update... new logic"。通常这种重大变更，建立**全新**的基础设施（新 ALB + 新 ASG）是更稳妥的蓝绿部署模式，方便回滚。
    * **选项 A vs B:**
        * A (Two ALBs): 隔离性更好。DNS 加权是控制入口流量的标准做法。
        * B (One ALB, Two TGs): 也可以。
    * **破局点：** "Customers must use the same version"。
    * 如果用 Route 53 (A)，只要 TTL 不过期，用户就一直在新版。
    * 如果用 ALB (B)，必须配置 Stickiness。选项 B 提到了 "Configure ALB target group stickiness"。
    * **让我们看 D:** "Second ASG... LOR algorithm... Session stickiness"。LOR 是算法，Session stickiness 是 Cookie。这也能做。
    * **AWS 官方蓝绿部署白皮书推荐：** 使用 **Route 53 Weighted Routing** 在两个独立的环境（Blue Env & Green Env）之间切换。每个环境都有自己的 LB 和 ASG。这样隔离性最强。
    * **选项 A** 描述了"Second ALB + New ASG + Route 53 Weighted"。这是最标准的**环境级**蓝绿/金丝雀部署。
    * **锁定 A。**

**3. ✅ 正确选项解析 (选项 A)**
* **Route 53 Weighted:** 在 DNS 层切分流量，实现环境隔离的灰度发布。

**5. 📚 核心考点:** 基于 DNS 的蓝绿部署架构。
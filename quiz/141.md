这 10 道题目（包含 1 道关于 WorkSpaces 存储扩容的题目）涵盖了 **SQS 死信队列排查**、**API Gateway 私有化**、**S3 全球加速**、**FSx 自动扩容**、**SFTP 现代化架构**、**Aurora 跨区域灾备**、**敏感数据脱敏 (Glue)**、**AWS Elastic Disaster Recovery (DRS)**、**跨账户审计访问**、**DAX 加速**。

特别是 **Q148 (Elastic Disaster Recovery)** 和 **Q144 (FSx Capacity Mgmt)** 是 SAP 考试中关于运维自动化的经典考点。

让我们开启 **逐题秒杀模式**！

---

#### 📝 [141/529] SQS 消息处理失败排查 (Visibility Timeout)

**1. 🕵️‍♂️ 题眼与约束分析**
* **处理时间：** 30 分钟。
* **Visibility Timeout:** 1 小时 (60 分钟)。
* **Retry Policy:** maxReceiveCount = 1 (失败一次就进死信队列)。
* **现象：** 消息进入 DLQ (死信队列)，但**应用日志无错误**。
* **推断：** 既然日志无错，说明代码没抛异常。为什么消息被认为“处理失败”了？
* **核心机制：** SQS 认为消息失败的唯一标准是：**Visibility Timeout 到期了，但消息还没被删除**。或者消费者主动 NACK。
* **矛盾点：** 既然处理只需 30 分钟，Timeout 是 60 分钟，理论上够用。为什么还会进 DLQ？
* **隐藏因素：** Auto Scaling Group **Scale-in** (缩容)。
* **场景重现：** 实例正在处理视频（需要30分钟）。第 15 分钟时，队列变空了，ASG 触发缩容，把这台正在干活的实例**终止 (Terminate)** 了。实例被杀，处理中断（还没来得及删消息）。Visibility Timeout (60分钟) 到期后，消息重新可见。由于 maxReceiveCount=1，消息立刻被送入 DLQ。
* **日志无错：** 因为实例被强杀，日志可能没来得及写（或写在本地盘随实例一起没了）。

**2. ⚡ 秒杀思路**
* **防止处理中断：** 需要告诉 ASG “我正在干活，别杀我”。这就是 **Instance Scale-in Protection** (缩容保护) 或 **Lifecycle Hook**。
* **选项对比：**
    * 选项 A (Termination Protection): 这是防止用户手动 API 误删的，对 ASG 缩容操作无效。
    * 选项 B (Visibility Timeout): 改成 3 小时没用，因为实例已经被杀了。
    * 选项 D (maxReceiveCount=0): 这会导致所有消息直接进 DLQ，更糟。
    * **选项 C:** **Configure scale-in protection** (配置缩容保护)。Worker 在领取任务时开启保护，处理完任务关闭保护。这样 ASG 就不会在任务处理中途杀掉实例。
    * **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **Scale-in Protection:** 专门用于长任务 Worker，防止 ASG 缩容误杀。

**4. ❌ 错误选项排查**
* **选项 A:** 这是一个常见的混淆点。EC2 控制台的 "Change termination protection" 只能防 API 调用，防不住 ASG。ASG 有特权。

**5. 📚 核心考点:** SQS 长任务处理与 ASG 缩容的冲突解决。

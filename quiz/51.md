
---

#### 📝 [51/529] S3 强制 KMS 加密合规

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** SSE-S3 加密。
* **新需求：** 所有当前和未来的对象必须使用 **Security team managed keys** (安全团队管理的密钥)。这意味着必须用 **SSE-KMS (AWS KMS)** 且是 **CMK (Customer Managed Key)**，不能用 SSE-S3（那个是 AWS 管理的）。
* **操作：** **Current and future objects** (存量 + 增量)。
* **环境：** **No versioning** (未启用版本控制)。

**2. ⚡ 秒杀思路**
* **配置默认加密：** Bucket 属性里的 Default Encryption 只能保证“未来”上传的对象被加密。
* **处理存量对象：** 修改默认加密**不会**自动加密现有的对象。必须重新上传（Copy in place）才能生效。
* **策略强制：** 需要拒绝未加密的请求。
* **选项对比：**
    * **选项 A (SSE-S3 with Customer Managed Keys):** SSE-S3 是不支持客户管理密钥的。SSE-S3 密钥完全由 AWS 托管。这是概念错误。
    * **选项 D (AES-256 with Customer Managed Keys):** AES-256 通常指 SSE-S3。同理，概念冲突。
    * **选项 C:** "Automatically encrypt objects upon GetObject"？S3 没这功能。加密是在 Put 时发生的。
    * **选项 B:**
        1.  修改默认加密为 **SSE-KMS** (这是唯一支持 Customer Managed Key 的模式)。
        2.  设置 Bucket Policy 拒绝未加密上传 (Enforce)。
        3.  使用 CLI **re-upload** (即 `aws s3 cp s3://bucket/ s3://bucket/ --recursive`) 刷新存量对象。
    * **锁定 B。**

**3. ✅ 正确选项解析 (选项 B)**
* **SSE-KMS:** 允许使用自定义 KMS 密钥。
* **Re-upload:** 解决存量数据加密问题的唯一方法。

**5. 📚 核心考点:** S3 加密模式区别 (SSE-S3 vs SSE-KMS) 及存量数据处理。
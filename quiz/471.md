#### 📝 [471/529] 防火墙设备水平扩展 (Gateway Load Balancer)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** 2 Firewall Appliances (EC2, HA), Static IP, Manual config issue.
* **痛点：** Script failure, Manual rebuild.
* **需求：**
    1.  **Horizontal Scaling** (水平扩展) for traffic.
    2.  Continue using firewall appliances (必须用防火墙设备).
    3.  Automated configuration (Bootstrap script available).
    4.  **Cost-effective**。
* **架构：** Centralized Networking Account + TGW。

**2. ⚡ 秒杀思路**
* **水平扩展与流量分发：**
    * 防火墙设备作为网络中间件（Inline Inspection），最适合使用 **Gateway Load Balancer (GWLB)**。
    * GWLB 提供透明的负载均衡、自动扩展（Auto Scaling Group）、健康检查，并且通过 **GENEVE** 协议在网络层（L3）转发流量，无需改变源/目的 IP。
    * $→$ **选中 A**。
    * (B 网络负载均衡器 NLB 不支持 GENEVE 封装，通常用于普通 TCP/UDP 服务，虽然可以做 Sandwich 架构，但 GWLB 是专门为 Virtual Appliances 设计的，更现代、更易管理且支持自动扩展)。
* **自动扩展配置：**
    * 创建 **Auto Scaling Group (ASG)** 和 **Launch Template**。
    * 使用 User Data 脚本自动配置防火墙。
    * $→$ **选中 C**。
    * (D Launch Wizard 是部署工具，但 ASG 是运行时扩展的核心。C 的描述 "Instance target type" 是 GWLB Target Group 的标准配置)。
* **跨账户流量路由：**
    * 成员账户的流量如何经过防火墙？
    * 通过 **Gateway Load Balancer Endpoint (GWLBE)**。
    * GWLBE 是 VPC Endpoint 的一种。在 TGW 连接的 VPC（集中账户或成员账户）中，路由表指向 GWLBE。
    * 题目架构是 "Centralized Network Account with TGW connecting member VPCs"。通常流量先到集中账户的 TGW，然后由 TGW 路由到防火墙 VPC（通过 TGW Attachment）。或者更现代的做法是 TGW + Appliance VPC。
    * **选项 F:** "Create VPC Endpoints in **Centralized Network Account**. Update route tables in **each member account** to point to VPC endpoint"。
        * 如果成员账户通过 TGW 连接，成员账户的路由表应该指向 **TGW Attachment**，而不是集中账户里的 VPC Endpoint（跨账户不能直接指 Endpoint，除非通过 PrivateLink，但防火墙是透明检查，不是服务访问）。
        * 正确的流向：Member VPC -> TGW -> Inspection VPC (GWLBE -> GWLB -> Firewall) -> Internet。
        * F 选项说 "Update route tables in each member account to point to VPC endpoint"。这在技术上通常是不对的（跨 VPC 引用 Endpoint ID 不行）。应该是指向 TGW。
        * **但是，** 让我们看选项 E。 "Create VPC Endpoints in **each member account**"。这意味着分布式部署防火墙？题目说 "Centralized Network Account"。所以防火墙在集中账户。
        * **让我们重新审视 F。** 也许它的意思是"在集中账户创建 GWLBE，然后配置 TGW 路由表（或成员账户指向 TGW，TGW 指向 Inspection VPC）"。
        * 或者，也许题目指的是 **PrivateLink Endpoint Service** (A/B 提到的)？
        * **A 选项** 说 "Deploy **Gateway Load Balancer**. Set up endpoint service using **AWS PrivateLink**"。
        * **GWLB** 确实是基于 PrivateLink 技术构建的（Endpoint Service 类型为 GatewayLoadBalancer）。
        * 那么消费者端（Consumer）需要创建 GWLB Endpoint (GWLBE)。
        * 如果是集中式架构，GWLBE 通常部署在 TGW 连接的"附件子网"或专门的"检查 VPC"中。
        * 成员账户的流量发给 TGW。
        * 选项 F 的描述 "Update route tables in each member account to point to VPC endpoint" 依然很怪。成员账户应该指 TGW。
        * **也许题目是想说：** 使用 PrivateLink 将防火墙作为服务发布给成员账户？不，防火墙通常是透明网关。
        * **让我们看最佳实践：** Centralized Inspection with TGW + GWLB。
        * 步骤 1: GWLB + ASG (A, C)。
        * 步骤 2: TGW 路由。
        * 选项中没有提到 TGW 路由表的修改。
        * 让我们再看 B (NLB)。NLB 也可以做 PrivateLink 服务。但这不仅是防火墙，更是"服务"。防火墙是检查流量的。
        * **GWLB (A)** 是正解。
        * 至于第三个选项（E vs F）。
        * 如果 GWLB 配置为 Endpoint Service。那么需要在某个地方创建 Endpoint。
        * 如果是集中式检查，Endpoint 在集中账户。
        * 如果是分布式检查，Endpoint 在成员账户。题目是 "Centralized"。
        * 所以 Endpoint 在集中账户。
        * F 说 "Create VPC Endpoints in centralized network account"。这是对的。
        * F 后半句 "Update route tables in each member account to point to VPC endpoint" 可能是指"更新 TGW 路由表"或者题目表述有误（指向 TGW）。但在 E 和 F 之间，**F (集中账户创建 Endpoint)** 符合集中式架构。
    * **锁定 A, C, F。** (F 存在描述瑕疵，但位置是对的)

**3. ✅ 正确选项解析 (选项 A, C, F)**
* **GWLB:** 专为防火墙设备设计的负载均衡器。
* **ASG:** 实现水平扩展。
* **GWLB Endpoint:** 流量入口。

**5. 📚 核心考点:** Gateway Load Balancer 在集中式网络安全架构中的应用。
这 1 道题涵盖了 **REST API 防僵尸网络 (WAF Rate Limiting)**。

让我们开启 **逐题秒杀模式**！

---

#### 📝 [251/529] REST API 防僵尸网络 (WAF Rate Limiting)

**1. 🕵️‍♂️ 题眼与约束分析**
* **正常流量：** 6个合作伙伴，每天1次（频率极低）。
* **攻击流量：** 每秒 1000 次请求，来自 500 个不同 IP。
* **目标：** Protect API, **Minimize cost**。

**2. ⚡ 秒杀思路**
* **防御手段：**
    * 面对 DDoS/Bot 攻击，**AWS WAF** 是首选。
    * **Rate-based Rules (基于速率的规则):** 可以设置"每个 IP 每 5 分钟允许 X 次请求"。如果超过，自动封禁。
    * 题目说正常用户"每天1次"。攻击者"每秒1000次"。设置一个较低的速率限制（如 5分钟 5次）可以有效拦截攻击者，且不误伤正常用户。
* **选项对比：**
    * **选项 A (OAI):** OAI 是 S3 用的，不是 API Gateway 用的。
    * **选项 C/D (WAF Allow IP):** 允许 6 个合作伙伴 IP？如果合作伙伴 IP 变了怎么办？而且题目说"Allow access to IP addresses used by 6 partners"，这需要手动维护 IP 白名单。虽然安全，但维护成本高。如果没有 IP 列表，怎么配？
    * **选项 A/B (CloudFront + WAF):** 将 WAF 挂在 CloudFront 上是标准做法（虽然 API Gateway 也支持 WAF，但 CloudFront 抗 DDoS 能力更强且能缓存）。
    * **决胜点：** **Rate Limiting**。
    * 选项 A/B 都提到了 "Block clients that submit more than 5 requests per day"。WAF Rate-based rule 最小周期是 5 分钟，不是 1 天。但这里的描述可能指逻辑上的速率限制。
    * **API Key:** 选项 B 提到了 **API Key**。这是识别合法用户的好方法。API Key 可以作为最后一道防线。
    * **选项 A:** "Use OAI... ensure only OAI can run POST"。概念错误。OAI 是 S3 的。
    * **选项 B:** CloudFront + WAF (Rate Limit) + **API Key** (in Custom Header)。
        * WAF 挡掉大部分攻击。
        * CloudFront 添加自定义头（包含 API Key）。
        * API Gateway 校验 API Key。
        * 这确保了只有通过 CloudFront（且经过 WAF 过滤）的流量才能访问 API，并且有 API Key 认证。
        * **更正:** 其实 WAF 规则里写的 "5 requests per day" 在技术上是不准确的（WAF 最小是 5 分钟）。但这并不影响 B 是唯一架构合理的选项（相比 A 的 OAI 错误，C/D 的 IP 白名单维护困难）。
    * **其实最简单的可能是 D:** Usage Plan 限制请求。但这防不住 DDoS（DDoS 会消耗配额，导致正常用户也无法访问）。WAF 是在边缘拦截，更适合防 Bot。
    * **结论:** 选 B。利用 CloudFront + WAF 在边缘清洗流量，利用 API Key 做认证。

**3. ✅ 正确选项解析 (选项 B)**
* **WAF Rate-based Rule:** 拦截高频攻击。
* **API Key:** 认证合法请求。
* **CloudFront Custom Header:** 安全地传递 API Key。

**5. 📚 核心考点:** API Gateway 的 DDoS 防护架构。
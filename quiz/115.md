#### 📝 [115/529] VPC Flow Logs 成本分析 (NAT Cost)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现象：** **EC2-Other** 费用高。细查是 **NatGateway-Bytes** (NAT 流量费)。
* **架构：** 大部分应用在私有子网，读写 **Kinesis Data Streams**。
* **原因推测：** 私有子网访问 Kinesis 默认走公网（通过 NAT Gateway）。NAT 处理流量要收费 ($0.045/GB)。大数据量下非常贵。
* **目标：** Reduce cost (降低成本)。

**2. ⚡ 秒杀思路**
* **优化手段：**
    * AWS 服务访问（如 S3, DynamoDB, Kinesis）应该走 **VPC Endpoint**，避开 NAT Gateway。
    * Kinesis 支持 **Interface VPC Endpoint (PrivateLink)**。
* **选项对比：**
    * 选项 A/C (Flow Logs + Athena/Detective): 只是分析，没解决问题。而且原因已经找到了（NAT 流量大）。
    * 选项 B/D: 都是添加 Kinesis Interface VPC Endpoint。
    * **B vs D:**
        * B 说 "Ensure app has correct IAM permissions"。IAM 权限本来就有（否则之前走 NAT 也通不了），Endpoint 不改变 IAM 身份验证逻辑。
        * D 说 "Ensure VPC Endpoint Policy allows traffic from the application"。这是配置 Interface Endpoint 的关键步骤。默认 Policy 是 Allow All，但如果需要限制，必须配置正确。
        * **其实 B 和 D 的核心区别在于后半句的废话程度。** 但 D 的 Endpoint Policy 描述更贴切网络配置。不过，通常添加 Endpoint 只要路由和 DNS 对了就自动生效（PrivateLink DNS）。
        * 让我们再看一眼 **B**。IAM 权限是应用层面的。**D** 的 Endpoint Policy 是资源层面的。
        * **其实最核心的区别是：** B 强调 IAM，D 强调 Endpoint Policy。
        * 让我们看看有没有更致命的错误。B 没啥错。D 也没啥错。
        * **再看 D 的描述：** "Ensure VPC endpoint policy allows traffic..."。
        * **通常**，添加 Interface Endpoint 后，还需要做的是：**更新安全组**（Endpoint 的 SG 要允许来自 App 的入站）。选项里没提 SG。
        * 那么选 B 还是 D？
        * 这是一个典型的"废话选项"题。
        * Kinesis Endpoint 是 Interface 类型。
        * 让我们回看 **Q115** 的题干。应用已经在跑了，所以 IAM 权限（对 Kinesis 的读写）肯定是有的。加了 Endpoint 后，IAM 权限不需要变。
        * 而 **Endpoint Policy** 是一个新的控制点。如果默认是 Full Access，那也无需动。
        * 也许出题人想考察的是：应用不需要改代码，只要启用 Private DNS，流量自动切到 Endpoint。
        * **但是，** 有一个常见的考点：**VPC Endpoint 的成本 vs NAT 成本**。Interface Endpoint 也要钱（处理费 + 小时费）。通常比 NAT 便宜（NAT $0.045, Endpoint $0.01）。
        * **关键点：** 选项 D 的后半句 "Ensure VPC endpoint policy..." 是针对 Endpoint 的配置。选项 B 的后半句 "Ensure app has IAM permissions..." 是针对 App 的。由于 App 没变，IAM 没变。所以 B 的后半句是废话。D 的后半句虽然通常用默认即可，但属于 Endpoint 配置范畴。
        * **更正：** 实际上，很多题目中 **D** 这种"检查 Endpoint Policy"是标准动作。
        * **锁定 D。**

**3. ✅ 正确选项解析 (选项 D)**
* **Interface VPC Endpoint:** 绕过 NAT，流量费更低。
* **Endpoint Policy:** 控制谁能通过该端点访问服务。

**5. 📚 核心考点:** AWS 服务内网访问优化 (VPC Endpoint 替代 NAT)。
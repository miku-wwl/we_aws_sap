#### 📝 [479/529] 票务系统排队模块干扰 (CloudFront Functions)

**1. 🕵️‍♂️ 题眼与约束分析**
* **架构：** CloudFront -> ECS (App + Waiting Room)。
* **机制：** JWT 识别用户。Others -> Waiting Room。
* **问题：** Load on Waiting Room interferes with App availability (排队流量打挂了应用)。
* **原因：** 排队逻辑（重定向/页面）和核心业务逻辑跑在同一个 ECS 集群/服务里，资源争抢。
* **目标：** **Max reliability** for sales transactions。

**2. ⚡ 秒杀思路**
* **解耦与边缘处理：**
    * 排队逻辑（检查 JWT，决定是进应用还是进等候室）应该在**进入后端之前**就处理掉。
    * **CloudFront Functions (C):**
        * 运行在边缘节点（Viewer Request）。
        * 可以检查 JWT。
        * 如果需要排队，直接在边缘返回等候室页面（或重定向），**请求根本不会到达 ECS**。
        * 这样 ECS 只处理合法的交易请求，负载大幅降低，可靠性最大化。
        * 即使 ECS 还要跑等候室服务（作为 Origin），CloudFront 也可以缓存等候室页面，或者将等候室请求路由到单独的 Origin。
    * **选项 C:** "Create CloudFront function to check JWT... forward to ticketing or waiting room service"。这实现了流量的边缘清洗和分流。同时建议将等候室拆分为单独的 ECS 服务（资源隔离）。
* **其他选项：**
    * A (Separate ECS Service): 虽然隔离了资源，但流量还是要进 VPC，还要经过 ALB 分发，压力还在后端。边缘拦截更优。
    * B/D (EKS): 迁移到 K8s 工作量大，且仅仅为了排队模块没必要。
* **锁定 C。**

**3. ✅ 正确选项解析 (选项 C)**
* **CloudFront Functions:** 边缘计算实现访问控制（排队），保护后端计算资源。

**5. 📚 核心考点:** 高并发抢购场景下的边缘排队/限流架构。
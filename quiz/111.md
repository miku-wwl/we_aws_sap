#### 📝 [111/529] Lambda 访问 Aurora 安全加固

**1. 🕵️‍♂️ 题眼与约束分析**
* **场景：** Lambda $→$ Aurora (同一 VPC)。
* **凭证管理：** 环境变量 (不安全)。
* **数据流：** Lambda 聚合数据 $→$ S3 (SSE-KMS)。
* **核心约束：**
    * **No traffic over Internet** (不走公网)。
    * **Minimize impact of compromised credentials** (凭证泄露影响最小化)。
* **目标：** 安全加固。

**2. ⚡ 秒杀思路**
* **凭证安全：**
    * 环境变量存明文密码是反模式。泄露后谁都能连数据库。
    * **Secrets Manager (D)** 和 **Parameter Store (C)** 都可以存密码。但 Secrets Manager 原生支持 **自动轮换 (Rotation)**，这直接满足"最小化泄露影响"（即使泄露了，过几天自动换了就失效了）。
    * 更高级的方案是 **IAM DB Authentication (A/B)**。这完全去除了静态密码，使用临时 IAM Token 登录。这是最安全的，但通常需要修改代码逻辑来获取 Token，且 token 有效期短（15分钟），题目似乎更侧重于"管理凭证"的改进。不过 A/B 没提如何轮换，只是说 IAM Auth。
    * **再读选项：**
        * A: IAM Auth + Gateway Endpoint。
        * B: IAM Auth + HTTPS to S3。
        * C: SSM Parameter Store (Rotation) + Gateway Endpoint。
        * D: Secrets Manager (Rotation) + HTTPS to S3。
* **网络安全：**
    * 必须"不走公网"。Lambda 在 VPC 内，访问 S3 默认走公网（通过 NAT）。要不走公网，必须用 **VPC Endpoint**。
    * **Gateway VPC Endpoint** 是访问 S3 的标准内网方式。 -> **选中 A 或 C**。
    * 选项 B/D 说 "Enforce HTTPS"。这只是加密传输，并没有解决"不走公网"的问题（HTTPS 依然可以走 IGW/NAT）。
* **决战 A vs C:**
    * A 使用 **IAM DB Authentication**。这是完全消除静态凭证的最佳实践。泄露影响极小（Token 15分钟失效，且绑定 IAM Role）。
    * C 使用 **SSM Parameter Store**。SSM 自身**不带**自动轮换逻辑（Secrets Manager 才带）。虽然选项说 "Set up rotation on credentials in Parameter Store"，但这需要额外写 Lambda 来实现，不如 Secrets Manager 原生，也不如 IAM Auth 彻底。
    * **最关键的判据：** 题目要求 **No traffic over Internet**。A 和 C 都用了 Gateway Endpoint，符合要求。B 和 D 没用 Endpoint，Lambda 访问 S3 会走 NAT Gateway（如果配了）或者超时（如果没配 NAT 且没 Endpoint）。所以 B/D 排除。
    * **A vs C 的凭证方案：** IAM Auth (A) vs SSM Rotation (C)。虽然 SSM Rotation 可以做，但 IAM Auth 是更"云原生"的去凭证化方案。且 C 选项描述了两次 "Modify Lambda function..." 有点啰嗦。更重要的是，SSM 标准版没有内置 Rotation，那是 Secrets Manager 的特性。选项 C 描述有点误导。
    * **修正：** 仔细看题目 "Minimize impact if... credentials are compromised"。IAM Auth 的 token 也是一种 credential，但它是临时的。SSM 存的是静态密码（即使轮换也有周期）。IAM Auth 更好。
    * **锁定 A。**

**3. ✅ 正确选项解析 (选项 A)**
* **IAM DB Authentication:** 使用临时令牌替代长期密码，安全性最高。
* **Gateway VPC Endpoint:** 确保 S3 流量完全在 AWS 内网，不经过 NAT/IGW。

**4. ❌ 错误选项排查**
* **选项 C/D:** SSM/Secrets Manager 虽然好，但如果不配合 VPC Endpoint，S3 流量可能会尝试走公网（或不通）。且 SSM 的 Rotation 需要自定义。

**5. 📚 核心考点:** 数据库凭证安全 (IAM Auth) 与 S3 内网访问 (Gateway Endpoint)。
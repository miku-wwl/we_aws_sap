#### 📝 [63/529] Lambda 超时解耦 (SQS/Step Functions)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现状：** S3 Trigger $\rightarrow$ Lambda (Node.js)。
* **故障：** 图片变大，Lambda **Timeout** (超时)。已设为最大值（15分钟），还是超时。
* **目标：** Prevent invocation failures (防止失败) + **Don't want to manage infrastructure** (不想管基建 -> Serverless)。

**2. ⚡ 秒杀思路**
* **问题本质：** 单次 Lambda 执行时间过长（处理大图），超过了 15 分钟硬限制。
* **解决方案方向：**
    1.  **ECS Fargate:** 没有超时限制，且 Serverless。
    2.  **Step Functions:** 编排长任务。
* **选项对比：**
    * 选项 A (Docker + ECR): 只是打包了代码，没说怎么运行。如果还在 Lambda 里跑，一样超时。
    * 选项 C (Step Functions Parallel): 并行状态是为了并发处理多个任务，不能解决"单个任务"超时的问题。Step Functions 调用的 Lambda 依然受 15 分钟限制。
    * 选项 D (ECS EC2): 违反 "Don't want to manage infrastructure"（EC2 需要管）。
    * **选项 B:** 使用 **ECS Fargate** (Serverless 容器)。S3 触发 Lambda，Lambda 只是作为一个"启动器"，调用 Fargate Task 去处理图片（异步）。Fargate 任务可以跑很久。
    * **锁定 B。**
    * **等一下，题目说选两个？**
    * 抱歉，我看错了，题目是 **Select TWO**。
    * 让我们重新审视选项。
    * 选项 B 的描述非常完整：S3 -> Lambda -> ECS Fargate Task。这一条就涵盖了所有逻辑。
    * 难道是要拆分步骤？
    * 让我们看 **A**：构建 Docker 镜像发布到 ECR。这是 B 的**前提条件**（Fargate 需要镜像）。
    * 所以逻辑链条是：**A (准备镜像) + B (配置运行)**。
    * 但是 B 选项里已经包含了 "Configure task definition to use the new image from ECR"。B 已经涵盖了 A 的后半部分。
    * 再看 **C**: 增加 Lambda 并发？没用，单个请求还是超时。
    * 再看 **E**: 用 EFS？没解决计算超时的问题。
    * **复盘 B 选项:** "Create new ECS task definition... Adjust Lambda function to invoke the task". 这是核心逻辑。
    * **复盘 A 选项:** "Modify app deployment by building Docker image... Push to ECR". 这是准备工作。
    * 只有 A + B 组合起来，才能完成从"Lambda 代码包"到"容器化 Fargate 任务"的完整迁移。
    * **锁定 A 和 B。**

**3. ✅ 正确选项解析 (选项 A, B)**
* **A:** 将 Node.js 代码容器化，推送到 ECR。
* **B:** 定义 Fargate 任务，并修改 Lambda 逻辑（从处理图片变为"提交任务"）。这是处理长耗时任务的标准 Serverless 模式。

**5. 📚 核心考点:** Lambda 超时后的架构演进 (Async ECS Fargate)。
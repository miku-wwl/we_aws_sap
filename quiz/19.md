
---

#### ğŸ“ [19/529] Lambda å®‰å…¨éƒ¨ç½² (Canary)

**1. ğŸ•µï¸â€â™‚ï¸ é¢˜çœ¼ä¸çº¦æŸåˆ†æ**
* **å½“å‰ï¼š** æ‰‹åŠ¨è„šæœ¬éƒ¨ç½² Lambdaï¼Œå›æ»šæ…¢ã€‚
* **ç›®æ ‡ï¼š** **Reduce time to deploy** (åŠ å¿«éƒ¨ç½²) + **Reduce time to detect and rollback** (åŠ å¿«å›æ»š)ã€‚
* **æ ¸å¿ƒæŠ€æœ¯ï¼š** **AWS CodeDeploy** + **Canary/Linear Deployment**ã€‚

**2. âš¡ ç§’æ€æ€è·¯**
* **å…³é”®è¯åŒ¹é…ï¼š** "Lambda safe deployment" + "Traffic shifting" (æµé‡åˆ‡æ¢) + "Rollback on error" $\rightarrow$ **AWS CodeDeploy** (é…åˆ SAM)ã€‚
* **ç§’æ€åŠ¨ä½œï¼š**
    * é€‰é¡¹ A (CloudFormation Stack): åµŒå¥—å †æ ˆæ›´æ–°æ…¢ï¼Œä¸”æ²¡æœ‰å†…ç½®çš„â€œæµé‡é€æ­¥åˆ‡æ¢â€åŠŸèƒ½ï¼ˆå®ƒæ˜¯å…¨é‡æ›´æ–°ï¼‰ã€‚
    * é€‰é¡¹ C (CLI è„šæœ¬): é¢˜ç›®å°±æ˜¯è¦æ‘†è„±è„šæœ¬ï¼Œè¿™æ˜¯å€’é€€ã€‚
    * é€‰é¡¹ D (DNS/Origin åˆ‡æ¢): æ‰‹åŠ¨é€ è½®å­ï¼Œå¤æ‚ä¸”å®¹æ˜“å‡ºé”™ã€‚
    * **é€‰é¡¹ B:** SAM (Serverless Application Model) åŸç”Ÿé›†æˆ CodeDeployã€‚åªéœ€åœ¨ YAML é‡Œå†™ `AutoPublishAlias` å’Œ `DeploymentPreference: Canary10Percent10Minutes`ï¼Œå®ƒå°±èƒ½è‡ªåŠ¨åˆ›å»ºåˆ«åã€é€æ­¥åˆ‡æµé‡ã€ç›‘æ§ CloudWatch æŠ¥è­¦ã€è‡ªåŠ¨å›æ»šã€‚å®Œç¾ç¬¦åˆæ‰€æœ‰è¦æ±‚ã€‚
* **é”å®š Bã€‚**

**3. âœ… æ­£ç¡®é€‰é¡¹è§£æ (é€‰é¡¹ B)**
* **CodeDeploy Hooks:** `BeforeAllowTraffic`, `AfterAllowTraffic` å¯ä»¥è¿è¡Œæµ‹è¯• Lambdaã€‚
* **Canary Deployment:** é‡‘ä¸é›€å‘å¸ƒï¼Œå…ˆåˆ‡ 10% æµé‡ï¼Œæ²¡æŠ¥é”™å†å…¨é‡ï¼Œå®‰å…¨æ€§æœ€é«˜ã€‚

**5. ğŸ“š æ ¸å¿ƒè€ƒç‚¹:** Serverless CI/CD æœ€ä½³å®è·µ (SAM + CodeDeploy)ã€‚

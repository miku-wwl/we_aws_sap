#### 📝 [2/529] 无服务器架构（API Gateway + Lambda + DynamoDB）的跨区域故障转移

### 1. 🕵️‍♂️ 题眼与约束分析

* **当前架构**：Serverless 架构，包含 API Gateway、Lambda 和 DynamoDB。
* **关键需求**：**故障转移 (Failover)** 到不同的 AWS 区域。这意味着这是一个灾难恢复 (DR) 场景，通常指的是主-备 (Active-Passive) 或主-主 (Active-Active) 但侧重于在一个区域不可用时切换流量。
* **隐性要求**：
    1.  **计算层冗余**：Lambda 和 API Gateway 是区域性服务，必须在目标区域重新部署一套。
    2.  **数据层同步**：DynamoDB 必须在两个区域间同步数据。
    3.  **流量入口控制**：DNS (Route 53) 需要负责检测故障并切换流量。

### 2. ⚡ 秒杀思路

* 看到 **"Failover to different AWS Region"** (故障转移到不同区域) $\rightarrow$ 必须使用 **Route 53 Failover Routing Policy** (故障转移路由策略)。
* 看到 **"DynamoDB across regions"** (跨区域 DynamoDB) $\rightarrow$ 必须使用 **Global Tables** (全局表) 实现数据多活同步。
* **公式**：Route 53 Failover + Full Stack Replication (API/Lambda) + DynamoDB Global Tables = 标准跨区域 DR。

### 3. ✅ 正确选项解析

**选项 C**

* **部署新的 API Gateway 和 Lambda**：Serverless 资源（API Gateway 和 Lambda）是区域性的 (Regional)。要在新区域接管流量，必须在那里部署一套完全相同的代码和配置。
* **Route 53 更改为 Failover record (故障转移记录)**：这是实现 DR 的核心。Route 53 的故障转移策略允许你定义一个主记录 (Primary) 和一个辅助记录 (Secondary)。配合 **健康检查 (Health Checks)**，当主区域 API 端点不健康时，DNS 会自动将流量解析到辅助区域的 IP。这完美契合题目中“故障转移”的需求。
* **DynamoDB 转换为全局表**：全局表 (Global Tables) 提供了全托管的多区域多活主数据库。它会自动在区域间复制数据，确保故障转移后，新区域的 Lambda 能读写到最新的数据。

### 4. ❌ 错误选项排查

* **选项 A**：
    * **错误点**：API Gateway 不能简单地“将两个区域的 Lambda 作为目标”进行原生负载均衡。API Gateway 是区域级服务，通常需要在每个区域部署一个 API Gateway 实例，然后通过 DNS 或 CloudFront 在前端进行分发。此外，它没有提到 Route 53 的配置更改，无法实现自动流量切换。
* **选项 B**：
    * **错误点**：**Multivalue answer (多值应答)** 路由策略主要用于负载均衡和提高可用性（类似于简单的轮询，但带有健康检查），它会随机返回多个健康的 IP 地址。虽然它能提供一定的容错能力，但在明确要求 **"Failover" (故障转移)** 这种主备切换逻辑时，**Failover Routing Policy** 是更准确、更专业的选择。
    * *干扰点*：多值应答看起来也能“高可用”，但它侧重于 Active-Active 的流量分发，而非严格的主备灾难恢复切换。
* **选项 D**：
    * **错误点**：**"Global Lambda functions" (全局 Lambda 函数)** 这一概念在标准后端 API 场景中是不存在的。Lambda 是区域性资源。虽然有 Lambda@Edge（在 CloudFront 边缘运行），但这通常用于请求处理/转换，而不是作为 API Gateway 后端的完整业务逻辑托管方式（且题目并未提及 CloudFront）。

### 5. 📚 核心考点与延伸 (Bonus)

* **Route 53 路由策略对比**：
    * **Failover (故障转移)**：专为灾难恢复设计 (Active-Passive)。主挂了切备。
    * **Multivalue Answer (多值应答)**：专为高可用性设计 (Active-Active)。随机返回健康 IP，类似于客户端负载均衡。
    * **Latency (延迟)**：基于用户地理位置延迟路由，也常用于 Active-Active 多区域部署。
* **DynamoDB Global Tables**：
    * 实现跨区域数据复制的首选方案。
    * 支持多主 (Multi-master) 写入，解决了跨区域数据一致性和延迟问题。
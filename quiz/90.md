#### 📝 [90/529] NAT Gateway 流量分析 (Flow Logs 排错)

**1. 🕵️‍♂️ 题眼与约束分析**
* **现象：** NAT Gateway 的 Flow Logs 看到来自 `198.51.100.2` (公网 IP) 的 **ACCEPT** 流量，发往私有实例。
* **VPC CIDR:** `203.0.x.x`。
* **疑问：** 这是 **Unsolicited inbound connection** (未经请求的入站连接，即外部主动连内部) 吗？
* **核心原理：** NAT Gateway 是单向的（只出不进）。外部**不可能**主动发起连接穿透 NAT 到私有实例。如果看到流量，那一定是**回包**（Response traffic）。

**2. ⚡ 秒杀思路**
* **NAT GW 流量特征：**
    * 私有实例 $\rightarrow$ NAT GW $\rightarrow$ Internet。
    * Internet $\rightarrow$ NAT GW $\rightarrow$ 私有实例。
* **Flow Logs 记录的是网络接口 (ENI) 上的流量。**
* **分析方向：**
    * 如果看到 `Src: 198.51.100.2` (公网), `Dst: 203.0.x.x` (私有IP) 的包在 NAT GW 的 ENI 上。这意味着公网在发数据给 NAT。
    * 但是，NAT 会做地址转换。
    * **关键判据：** 要判断是不是"未经请求"，得看**有没有对应的出站请求**。
    * Flow Logs 不记录状态，但可以通过**对比发送和接收字节数**来推断，或者看是否有出站记录。
    * **但是题目问的是"如何确定"。**
    * **选项分析：**
        * A/B/C/D 都是用 CloudWatch Logs Insights (查询语法)。
        * **语法逻辑：** 我们要找的是"入站流量"。即 `SrcAddr = Public IP`, `DstAddr = Private IP` (这在 NAT 内部接口是不可能的，NAT 内部接口看来也就是私有 IP)。
        * **NAT 的两张脸：** * 面对公网：有 EIP。
            * 面对内网：有私有 IP。
        * **题目描述：** "Inbound traffic from public IP... destined for private EC2 instance... with action ACCEPT". 这描述的是逻辑流。
        * **真正的测试：** 如果这是**回包**（响应），那么一定有一条**相反方向**的流（私有实例 $\rightarrow$ 公网 IP），且时间在前。
        * **但是选项都在算 "Total bytes" (stats command)。**
        * 让我们看选项 D：`Filter Dst=198.51.100.2, Src=203.0`。这是**出站流量**（私有实例访问公网）。
        * 如果 D (出站) 的流量存在且匹配，那么题目中观察到的"入站流量"就是合法的**响应包**。
        * 如果 D (出站) 不存在，那么入站流量就是"未经请求的"（虽然 NAT 会丢弃它，但日志可能记录了尝试）。
        * **结论：** 要验证"入站"是否合法，必须检查是否有对应的"出站"请求。所以我们要查询的是**相反方向**的流量。
        * 题目看到了 `Src=198..., Dst=203...`。
        * 我们要查 `Src=203... (Private), Dst=198... (Public)`。
        * **锁定 D。** (选项 A/B 是查题目已经看到的那个方向，没意义。C 是查 Src=Private, Dst=Public，和 D 一样，但 C 说用 CloudTrail 控制台查 Flow Logs？错！Flow Logs 是在 CloudWatch 里的。只有 B/D 是用 CloudWatch。B 是查原方向，D 是查反方向)。
        * **终极逻辑：** 1. 工具：CloudWatch (排除 A/C)。
            2. 逻辑：查反向流量以验证请求-响应关系。
            3. 选 D。

**3. ✅ 正确选项解析 (选项 D)**
* **CloudWatch Logs Insights:** 查询 Flow Logs 的标准工具。
* **Traffic Correlation:** 通过查询出站请求（Src=Private, Dst=Public）来证实入站响应的合法性。

**5. 📚 核心考点:** VPC Flow Logs 分析与 NAT 有状态连接原理。